
# Data Flow Analysis Report: Plan Overview Page

This document provides a complete, end-to-end data flow analysis for the `Plan Overview` page of the AI Modernize Migration Platform.

**Analysis Date:** 2024-07-29

**Assumptions:**
*   The analysis is based on the `src/pages/plan/Index.tsx` component.
*   **Crucially, this component is a static placeholder with hard-coded data.** The analysis is based on the intended functionality implied by the UI.
*   The platform operates entirely within a Docker environment.
*   All API calls require authentication and multi-tenant context headers.

---

## 1. Frontend: Components and API Calls

The Plan Overview page is intended to be the central dashboard for the migration planning phase, summarizing wave plans, resource allocation, and target architecture designs.

### Key Components & Hooks
*   **Page Component:** `src/pages/plan/Index.tsx`
*   **Core Logic:** The page currently has **no data fetching hooks**. All data is hard-coded.

### Intended API Call Summary

Based on the UI, the following API calls would be required to power this page:

| # | Method | Endpoint                 | Trigger            | Description                                      |
|---|--------|--------------------------|--------------------|--------------------------------------------------|
| 1 | `GET`  | `/api/v1/plan/summary`   | `useQuery` on load.| Fetches the summary metrics for the planning phase. |
| 2 | `GET`  | `/api/v1/plan/ai-insights` | `useQuery` on load.| Fetches the latest AI-generated planning insights. |

---

## 2. Backend, CrewAI, ORM, and Database Trace (Inferred)

The backend for the Plan Overview would aggregate data from various planning activities.

### API Endpoint: `GET /api/v1/plan/summary` (Inferred)

*   **FastAPI Route:** Located in `backend/app/api/v1/endpoints/plan.py`.
*   **CrewAI Interaction:** Minimal. This endpoint would read data that has already been generated by planning agents.
*   **ORM Layer:**
    *   **Repository:** `PlanSummaryRepository` (or multiple repositories).
    *   **Operation:** This would be a complex query that aggregates data from `wave_plans`, `resource_allocations`, and `target_architectures`.
    *   **Scoping:** Filtered by `engagement_id`.
*   **Database:**
    *   **Tables:** `wave_plans`, `resource_allocations`, `target_architectures`.
    *   **Query:** Would involve `JOIN`s and `COUNT`s across multiple tables to generate the summary metrics.

---

## 3. End-to-End Flow Sequence: Loading the Plan Dashboard (Intended)

1.  **User Navigates:** User loads the Plan Overview page.
2.  **Frontend Hook:** `useQuery` hooks for `plan-summary` and `plan-ai-insights` would be triggered.
3.  **API Call:** A `GET` request is made to `/api/v1/plan/summary`.
4.  **Backend Route:** The FastAPI router directs the request to the `get_plan_summary` function.
5.  **ORM Query:** The repository layer executes a complex query to aggregate data.
6.  **DB Execution:** PostgreSQL executes the query.
7.  **Backend Response:** FastAPI returns the summary data as a JSON object.
8.  **UI Render:** The component renders the summary cards and other dashboard widgets.

---

## 4. Troubleshooting Breakpoints

| Breakpoint                        | Diagnostic Check                                                                        | Platform-Specific Fix                                                                                              |
|-----------------------------------|-----------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------|
| **Page Shows Hard-Coded Data**    | This is the current state. The first step is to implement the real data fetching hooks.   | Create a `usePlanSummary` hook and have it call the `/api/v1/plan/summary` endpoint.                               |
| **API Call Fails (404)**          | If the implemented API call returns a 404, the backend route has not been created yet.      | Create the corresponding route in `backend/app/api/v1/endpoints/plan.py`.                                          |
| **Summary Metrics are Incorrect** | The aggregation query in the `PlanSummaryRepository` is likely incorrect.                 | Debug the SQL query to ensure it's correctly joining and counting the data from the planning tables.              |


