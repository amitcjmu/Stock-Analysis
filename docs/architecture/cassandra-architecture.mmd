graph TB
    subgraph "Frontend Layer"
        UI[React Frontend<br/>SearchHistory Component]
    end

    subgraph "API Layer"
        API[FastAPI Backend<br/>stock_routes.py]
        StockSvc[StockService<br/>Business Logic]
    end

    subgraph "Data Layer"
        PostgreSQL[(PostgreSQL<br/>Stock Data)]
        Cassandra[(Cassandra DB<br/>Search History)]
    end

    subgraph "Cassandra Tables"
        Searches[user_stock_searches<br/>Time-series data]
        Cache[user_search_results<br/>24h TTL cache]
        Analytics[user_search_analytics<br/>Monthly aggregates]
    end

    UI -->|HTTP Request| API
    API -->|search_stocks| StockSvc
    StockSvc -->|Query| PostgreSQL
    StockSvc -->|Log Search| Cassandra
    StockSvc -->|Check Cache| Cassandra

    Cassandra --> Searches
    Cassandra --> Cache
    Cassandra --> Analytics

    API -->|Get History| Cassandra
    Cassandra -->|Return| API
    API -->|JSON Response| UI

    style Cassandra fill:#e1f5ff
    style Searches fill:#fff4e1
    style Cache fill:#fff4e1
    style Analytics fill:#fff4e1
