# Legacy Code Removal Checklist

**Generated by CC on 2025-08-05**

This document provides a comprehensive inventory of ALL legacy code references that need to be cleaned up to ensure the codebase is clean and prevent future confusion.

## CRITICAL (Must Fix) - Active Legacy API Calls

### Frontend API Calls Using Legacy `/api/v1/discovery` Endpoints

#### File: /Users/chocka/CursorProjects/migrate-ui-orchestrator/src/components/FlowCrewAgentMonitor/hooks/useAgentMonitor.ts
**Issue**: Direct legacy API calls to discovery endpoints  
**Line Numbers**: 101, 140  
**Current Code**: 
```typescript
const crewResponse = await fetch(`/api/v1/discovery/flow/crews/monitoring/${flow.flow_id}`, {
```
**Required Change**: Replace with masterFlowService.getFlowStatus() or remove if no longer needed  
**Risk Level**: High  
**Dependencies**: Flow monitoring functionality  

#### File: /Users/chocka/CursorProjects/migrate-ui-orchestrator/src/hooks/useApplication.ts
**Issue**: Legacy discovery API calls for application data  
**Line Numbers**: 34, 64  
**Current Code**: 
```typescript
const response = await apiCall(`/api/v1/discovery/applications/${applicationId}`);
```
**Required Change**: Replace with masterFlowService or unified API  
**Risk Level**: High  
**Dependencies**: Application management features  

#### File: /Users/chocka/CursorProjects/migrate-ui-orchestrator/src/hooks/discovery/useDiscoveryFlowList.ts
**Issue**: Legacy discovery flows API call  
**Line Numbers**: 39, 54, 145  
**Current Code**: 
```typescript
const response = await apiCall('/api/v1/discovery/flows/active', {
```
**Required Change**: Replace with masterFlowService.getActiveFlows()  
**Risk Level**: Critical - Core discovery functionality  
**Dependencies**: Discovery dashboard, flow management  

#### File: /Users/chocka/CursorProjects/migrate-ui-orchestrator/src/hooks/api/useDashboardData.ts
**Issue**: Legacy API call for dashboard data  
**Line Numbers**: 65  
**Current Code**: 
```typescript
apiCall('/api/v1/discovery/flows/active', {
```
**Required Change**: Use masterFlowService.getActiveFlows()  
**Risk Level**: High  
**Dependencies**: Main dashboard functionality  

#### File: /Users/chocka/CursorProjects/migrate-ui-orchestrator/src/examples/api-usage.ts
**Issue**: Example code using legacy API  
**Line Numbers**: 49  
**Current Code**: 
```typescript
`/api/v1/discovery/flows/${flowId}`
```
**Required Change**: Update example to use masterFlowService  
**Risk Level**: Medium  
**Dependencies**: Developer documentation/examples  

#### File: /Users/chocka/CursorProjects/migrate-ui-orchestrator/src/pages/discovery/hooks/useCMDBImport.ts
**Issue**: Legacy discovery API calls  
**Line Numbers**: 158, 166, 196  
**Current Code**: 
```typescript
endpoint: '/api/v1/discovery/flow/run-redesigned',
const response = await apiCall('/api/v1/discovery/flow/run-redesigned', {
`/api/v1/discovery/flow/agentic-analysis/status-public?flow_id=${flowId}`
```
**Required Change**: Replace with masterFlowService methods  
**Risk Level**: Critical - Core CMDB import functionality  
**Dependencies**: Data import workflow  

### Missing Import References

#### File: /Users/chocka/CursorProjects/migrate-ui-orchestrator/src/hooks/__tests__/useAttributeMappingLogic.test.ts
**Issue**: References to non-existent useDiscoveryFlowV2 hook  
**Line Numbers**: 5, 12, 13, 122, 132  
**Current Code**: 
```typescript
import { useDiscoveryFlowV2 } from '../discovery/useDiscoveryFlowV2';
vi.mock('../discovery/useDiscoveryFlowV2', () => ({
  useDiscoveryFlowV2: vi.fn(),
```
**Required Change**: Remove all references to useDiscoveryFlowV2 (file doesn't exist)  
**Risk Level**: High - Test failures  
**Dependencies**: Attribute mapping tests  

## HIGH PRIORITY - Legacy References in Active Code

### V2/V3 Service References

#### File: /Users/chocka/CursorProjects/migrate-ui-orchestrator/src/components/discovery/UploadBlocker.tsx
**Issue**: References to IncompleteFlowV2 type  
**Line Numbers**: 11, 17  
**Current Code**: 
```typescript
import type { IncompleteFlowV2 } from '@/hooks/discovery/useFlowOperations';
incompleteFlows: IncompleteFlowV2[];
```
**Required Change**: Update to use unified flow types  
**Risk Level**: High  
**Dependencies**: Upload blocking functionality  

#### File: /Users/chocka/CursorProjects/migrate-ui-orchestrator/src/hooks/discovery/useFlowOperations.ts
**Issue**: Multiple V2 service exports and deprecated methods  
**Line Numbers**: 12, 27, 126, 187, 192, 226, 232  
**Current Code**: 
```typescript
export interface IncompleteFlowV2 {
export const useIncompleteFlowDetectionV2 = (): unknown => {
export const useFlowResumptionV2 = (): unknown => {
export const useFlowDeletionV2 = (): unknown => {
export const useBulkFlowOperationsV2 = (): unknown => {
```
**Required Change**: Remove all V2 exports, replace with unified service calls  
**Risk Level**: High  
**Dependencies**: Flow management across the application  

#### File: /Users/chocka/CursorProjects/migrate-ui-orchestrator/src/hooks/discovery/useDiscoveryFlowList.ts
**Issue**: V2 alias export  
**Line Numbers**: 131  
**Current Code**: 
```typescript
export { useDiscoveryFlowList as useDiscoveryFlowListV2 };
```
**Required Change**: Remove V2 alias  
**Risk Level**: Medium  
**Dependencies**: Components using V2 alias  

#### File: /Users/chocka/CursorProjects/migrate-ui-orchestrator/src/pages/discovery/CMDBImport/hooks/useCMDBImport.ts
**Issue**: V2 service imports  
**Line Numbers**: 9, 10, 56, 57  
**Current Code**: 
```typescript
useIncompleteFlowDetectionV2,
useFlowResumptionV2
const { data: incompleteFlowsData, isLoading: checkingFlows, refetch: refetchIncompleteFlows } = useIncompleteFlowDetectionV2();
const flowResumption = useFlowResumptionV2();
```
**Required Change**: Replace with unified service calls  
**Risk Level**: High  
**Dependencies**: CMDB import functionality  

#### File: /Users/chocka/CursorProjects/migrate-ui-orchestrator/src/pages/discovery/CMDBImport/hooks/useFlowManagement.ts
**Issue**: V2 service imports and usage  
**Line Numbers**: 5, 6, 7, 20, 21, 38  
**Current Code**: 
```typescript
useIncompleteFlowDetectionV2,
useFlowResumptionV2,
useBulkFlowOperationsV2
```
**Required Change**: Replace with unified service calls  
**Risk Level**: High  
**Dependencies**: Flow management functionality  

#### File: /Users/chocka/CursorProjects/migrate-ui-orchestrator/src/pages/discovery/EnhancedDiscoveryDashboard/index.tsx
**Issue**: V2 service import  
**Line Numbers**: 26, 68  
**Current Code**: 
```typescript
import { useIncompleteFlowDetectionV2 } from '@/hooks/discovery/useFlowOperations';
const { data: incompleteFlowsData } = useIncompleteFlowDetectionV2();
```
**Required Change**: Replace with unified service call  
**Risk Level**: High  
**Dependencies**: Enhanced discovery dashboard  

## MEDIUM PRIORITY - Comments and Documentation

### Configuration Files with Legacy References

#### File: /Users/chocka/CursorProjects/migrate-ui-orchestrator/src/config/api.ts
**Issue**: V2 API endpoint references and legacy cache logic  
**Line Numbers**: 388, 49, 224, 232, 277, 292, 346, 347, 392, 739, 748, 765  
**Current Code**: 
```typescript
if (endpoint.startsWith('/api/v1') || endpoint.startsWith('/api/v2')) {
// Priority 2: Legacy VITE_API_BASE_URL
// Legacy implementation with custom caching
```
**Required Change**: Remove V2 references, clean up legacy cache logic  
**Risk Level**: Medium  
**Dependencies**: API client configuration  

#### File: /Users/chocka/CursorProjects/migrate-ui-orchestrator/src/constants/apiEndpoints.ts
**Issue**: V2 API endpoint constant  
**Line Numbers**: 59  
**Current Code**: 
```typescript
API_V2: '/api/v2',
```
**Required Change**: Remove V2 endpoint constant  
**Risk Level**: Medium  
**Dependencies**: Components referencing API_V2  

### Legacy Service Classes

#### File: /Users/chocka/CursorProjects/migrate-ui-orchestrator/src/services/FlowService.ts
**Issue**: Complete legacy service classes with deprecation warnings  
**Line Numbers**: 312, 314, 322, 327, 332, 340, 348, 353  
**Current Code**: 
```typescript
export class LegacyDiscoveryService {
export class LegacyAssessmentService {
console.warn('LegacyDiscoveryService.createFlow is deprecated. Use FlowService.createDiscoveryFlow instead.');
```
**Required Change**: Remove entire legacy service classes  
**Risk Level**: Medium  
**Dependencies**: Any remaining code using legacy services  

### Deprecated Hook References

#### File: /Users/chocka/CursorProjects/migrate-ui-orchestrator/src/hooks/useFlow.ts
**Issue**: Deprecated hook with legacy FlowService  
**Line Numbers**: 7  
**Current Code**: 
```typescript
* ⚠️ DEPRECATED: This hook uses legacy FlowService and should be migrated
```
**Required Change**: Remove deprecated hook or migrate to masterFlowService  
**Risk Level**: Medium  
**Dependencies**: Components still using useFlow  

### Legacy Type Definitions

#### File: /Users/chocka/CursorProjects/migrate-ui-orchestrator/src/utils/api/apiTypes.ts
**Issue**: Legacy API response types  
**Line Numbers**: 17, 18  
**Current Code**: 
```typescript
// Legacy compatibility - keeping old structure for backward compatibility
export interface LegacyApiResponse<T = unknown> {
```
**Required Change**: Remove legacy types  
**Risk Level**: Medium  
**Dependencies**: Components using LegacyApiResponse  

## LOW PRIORITY - Dead Code and Documentation

### Test Files with Legacy References

#### File: /Users/chocka/CursorProjects/migrate-ui-orchestrator/tests/backend/api/test_discovery_flow_v2_endpoints.py
**Issue**: Test file for V2 endpoints  
**Line Numbers**: Entire file  
**Current Code**: Test file for V2 discovery flow endpoints  
**Required Change**: Remove test file if V2 endpoints no longer exist  
**Risk Level**: Low  
**Dependencies**: Test suite  

### Documentation Files with Legacy API References

Multiple documentation files contain references to `/api/v1/discovery` endpoints that should be updated:

- `docs/API_V3_MIGRATION_GUIDE.md` - Contains migration information but still references old endpoints
- `docs/adr/002-api-consolidation-strategy.md` - References legacy discovery endpoints
- `docs/archive/` - Multiple archived documents with legacy references (can remain for historical purposes)
- `docs/development/` - Several development guides with outdated API examples

**Required Change**: Update active documentation to remove legacy API references  
**Risk Level**: Low  
**Dependencies**: Developer onboarding and documentation accuracy  

## VERIFICATION CHECKLIST

### Before Starting Cleanup:
- [ ] Verify all critical API calls have replacement implementations in masterFlowService
- [ ] Confirm test coverage exists for replacement functionality
- [ ] Backup current working state

### During Cleanup:
- [ ] Replace legacy API calls one file at a time
- [ ] Run tests after each file modification
- [ ] Verify functionality works in development environment
- [ ] Update type definitions as needed

### After Cleanup:
- [ ] Search entire codebase for remaining `/api/v1/discovery` references
- [ ] Search for remaining V2/V3 references
- [ ] Verify all tests pass
- [ ] Update documentation to remove legacy references
- [ ] Perform end-to-end testing of affected workflows

## EXECUTION ORDER

1. **Phase 1 - Critical Fixes** (Must complete first)
   - Fix missing useDiscoveryFlowV2 import references in tests
   - Replace critical API calls in useDiscoveryFlowList, useDashboardData, useCMDBImport

2. **Phase 2 - V2 Service Cleanup**
   - Remove V2 service exports from useFlowOperations
   - Update all components using V2 services
   - Remove V2 type definitions

3. **Phase 3 - Configuration Cleanup**
   - Clean up API configuration legacy references
   - Remove legacy service classes
   - Update constants and types

4. **Phase 4 - Documentation and Dead Code**
   - Update active documentation
   - Remove test files for non-existent endpoints
   - Clean up archived documents if needed

## IMPACT ASSESSMENT

- **High Impact**: Discovery flow functionality, CMDB import, dashboard data
- **Medium Impact**: Flow management operations, API client configuration
- **Low Impact**: Documentation, examples, test files

**Estimated Effort**: 2-3 days for complete cleanup  
**Risk Level**: Medium - Requires careful testing of core functionality  
**Dependencies**: Master Flow Orchestrator must be fully functional before removing legacy calls