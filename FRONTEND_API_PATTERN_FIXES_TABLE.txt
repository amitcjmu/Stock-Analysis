# Frontend API Pattern Violations - Issue #88 Analysis Report

## EXECUTIVE SUMMARY
The frontend codebase contains extensive violations of the Master Flow Orchestrator (MFO) pattern. Instead of using `/api/v1/flows/*` endpoints, the frontend is making calls to legacy `/unified-discovery/*` endpoints and other non-MFO patterns. This causes wrong flow status displays and UI issues.

## CRITICAL VIOLATIONS REQUIRING IMMEDIATE ATTENTION

### 1. DISCOVERY FLOW SERVICE VIOLATIONS
**File: /Users/chocka/CursorProjects/migrate-ui-orchestrator/src/services/api/discoveryFlowService.ts**
- Line 170: `/unified-discovery/flow/${flowId}/status` → Should be `/api/v1/flows/${flowId}/status`
- Line 189: `/unified-discovery/flow/${flowId}/execute` → Should be `/api/v1/flows/${flowId}/execute`
- Line 211: `/unified-discovery/flows/${flowId}/clarifications/submit` → Should be `/api/v1/flows/${flowId}/clarifications`
- Line 233: `/unified-discovery/flow/${flowId}/retry` → Should be `/api/v1/flows/${flowId}/retry`

### 2. MASTER FLOW SERVICE VIOLATIONS
**File: /Users/chocka/CursorProjects/migrate-ui-orchestrator/src/services/api/masterFlowService.ts**
- Line 228: `/unified-discovery/flows/active` → Should be `/api/v1/flows/active`
- Line 283: `/unified-discovery/flow/${flowId}` → Should be `/api/v1/flows/${flowId}`
- Line 292: `/unified-discovery/flow/${flowId}` → Should be `/api/v1/flows/${flowId}`

### 3. DEPENDENCY SERVICE VIOLATIONS
**File: /Users/chocka/CursorProjects/migrate-ui-orchestrator/src/services/dependencyService.ts**
- Line 62: `/unified-discovery/dependencies/analysis` → Should be `/api/v1/flows/{flowId}/dependencies`
- Line 81: `/unified-discovery/dependencies` → Should be `/api/v1/flows/{flowId}/dependencies`
- Line 102: `/unified-discovery/dependencies/applications` → Should be `/api/v1/flows/{flowId}/applications`
- Line 118: `/unified-discovery/dependencies/servers` → Should be `/api/v1/flows/{flowId}/servers`

### 4. DISCOVERY HOOKS VIOLATIONS
**File: /Users/chocka/CursorProjects/migrate-ui-orchestrator/src/hooks/discovery/useDiscoveryFlowList.ts**
- Line 39: `/api/v1/unified-discovery/flows/active` → Should be `/api/v1/flows/active?type=discovery`
- Line 145: `/api/v1/unified-discovery/flows/active` → Should be `/api/v1/flows/active?type=discovery`

### 5. DASHBOARD SERVICE VIOLATIONS
**File: /Users/chocka/CursorProjects/migrate-ui-orchestrator/src/pages/discovery/EnhancedDiscoveryDashboard/services/dashboardService.ts**
- Line 155: `/api/v1/unified-discovery/flows/active` → Should be `/api/v1/flows/active?type=discovery`
- Line 289: `/api/v1/unified-discovery/flow/${dataImport.id}/status` → Should be `/api/v1/flows/${dataImport.id}/status`

### 6. API CONFIGURATION VIOLATIONS
**File: /Users/chocka/CursorProjects/migrate-ui-orchestrator/src/config/api.ts**
Multiple endpoints configured with `/unified-discovery/` prefix (Lines 104-140):
- PROCESS_CMDB, CMDB_TEMPLATES, CMDB_FEEDBACK, ASSETS, ASSETS_BULK, ASSETS_CLEANUP
- APPLICATIONS, APP_MAPPINGS, DISCOVERY_METRICS, APPLICATION_LANDSCAPE
- INFRASTRUCTURE_LANDSCAPE, AGENT_CLARIFICATION, AGENTIC_ANALYSIS_STATUS
- APPLICATION_PORTFOLIO, APPLICATION_VALIDATION, READINESS_ASSESSMENT
- ASSESSMENT_READINESS, STAKEHOLDER_SIGNOFF_PACKAGE, STAKEHOLDER_SIGNOFF_FEEDBACK
- TECH_DEBT_ANALYSIS, TECH_DEBT_FEEDBACK, DEPENDENCY_ANALYSIS, DEPENDENCY_FEEDBACK
- DEPENDENCIES, EXPORT_VISUALIZATION, DATA_CLEANUP_ANALYZE, DATA_CLEANUP_PROCESS

### 7. COMPONENT VIOLATIONS
**File: /Users/chocka/CursorProjects/migrate-ui-orchestrator/src/components/FlowCrewAgentMonitor/hooks/useAgentMonitor.ts**
- Line 101: `/api/v1/unified-discovery/flow/crews/monitoring/${flow.flow_id}` → Should be `/api/v1/flows/${flow.flow_id}/monitoring`
- Line 140: Same violation as above

**File: /Users/chocka/CursorProjects/migrate-ui-orchestrator/src/hooks/discovery/attribute-mapping/useAttributeMappingActions.ts**
- Line 131: `/unified-discovery/flow/${flowId}/execute` → Should be `/api/v1/flows/${flowId}/execute`

**File: /Users/chocka/CursorProjects/migrate-ui-orchestrator/src/hooks/discovery/useDependencyLogic.ts**
- Line 188: `/unified-discovery/dependencies/analysis` → Should be `/api/v1/flows/{flowId}/dependencies`

**File: /Users/chocka/CursorProjects/migrate-ui-orchestrator/src/pages/discovery/hooks/useCMDBImport.ts**
- Line 158: `/api/v1/unified-discovery/flow/run-redesigned` → Should be `/api/v1/flows/create`
- Line 166: Same violation as above
- Line 196: `/api/v1/unified-discovery/flow/agentic-analysis/status-public` → Should be `/api/v1/flows/{flowId}/status`

**File: /Users/chocka/CursorProjects/migrate-ui-orchestrator/src/hooks/api/useDashboardData.ts**
- Line 65: `/api/v1/unified-discovery/flows/active` → Should be `/api/v1/flows/active?type=discovery`

**File: /Users/chocka/CursorProjects/migrate-ui-orchestrator/src/hooks/useApplication.ts**
- Line 34: `/api/v1/unified-discovery/applications/${applicationId}` → Should be `/api/v1/flows/{flowId}/applications/${applicationId}`
- Line 64: Same violation as above

## ROOT CAUSE ANALYSIS

### Primary Issues:
1. **Legacy Endpoint Usage**: Frontend is using `/unified-discovery/*` endpoints instead of standardized `/api/v1/flows/*`
2. **Inconsistent Status Retrieval**: Multiple services fetching flow status from different endpoints
3. **Missing Flow Context**: Many operations not associating with a specific flow ID
4. **Configuration-Based Violations**: API_CONFIG.ENDPOINTS contains legacy endpoint configurations

### Impact on User Experience:
1. **Wrong Flow Status Display**: Different endpoints returning different status information
2. **Inconsistent UI State**: Components showing stale or incorrect flow states
3. **Failed Operations**: Some operations failing due to endpoint mismatches
4. **Poor User Experience**: Users seeing inconsistent information across the interface

## RECOMMENDED SOLUTION APPROACH

### Phase 1: Service Layer Standardization
1. Update `discoveryFlowService.ts` to use MFO endpoints
2. Fix `masterFlowService.ts` unified-discovery calls
3. Refactor `dependencyService.ts` to be flow-context aware

### Phase 2: Hook Layer Fixes
1. Update `useDiscoveryFlowList` to use standard `/api/v1/flows/active`
2. Fix dashboard hooks to use proper MFO endpoints
3. Update attribute mapping and import hooks

### Phase 3: Configuration Cleanup
1. Replace all `/unified-discovery/*` endpoints in `api.ts`
2. Standardize on `/api/v1/flows/*` pattern
3. Remove legacy endpoint configurations

### Phase 4: Component Updates
1. Update monitoring components to use MFO endpoints
2. Fix import and analysis components
3. Ensure all flow operations go through MFO

### Phase 5: Caching and State Management
1. Implement consistent flow status caching
2. Add proper cache invalidation strategies
2. Ensure real-time status updates use WebSocket connections to MFO endpoints

## COMPLIANCE WITH MFO PATTERN

### Correct Patterns:
- Flow Creation: `POST /api/v1/flows`
- Flow Status: `GET /api/v1/flows/{flowId}/status`
- Flow Execution: `POST /api/v1/flows/{flowId}/execute`
- Flow List: `GET /api/v1/flows/active?type={flowType}`
- Flow Deletion: `DELETE /api/v1/flows/{flowId}`

### Anti-Patterns to Remove:
- Any `/unified-discovery/*` endpoints
- Direct service-specific endpoints bypassing MFO
- Status checks not going through flow orchestrator
- Operations not associated with a flow context

## VALIDATION CRITERIA

Post-fix validation should verify:
1. All flow operations use `/api/v1/flows/*` endpoints
2. Flow status is consistent across all UI components
3. No direct calls to legacy discovery endpoints
4. All operations properly associate with flow context
5. Real-time updates work correctly through MFO WebSocket connections

## ESTIMATED IMPACT

- **Files to Modify**: 15+ service/hook/component files
- **Lines of Code**: 50+ endpoint URLs to change
- **Configuration Changes**: Complete API_CONFIG.ENDPOINTS.DISCOVERY overhaul
- **Testing Required**: Full regression testing of discovery flow functionality
- **User Impact**: Significantly improved flow status consistency and UI reliability

---
Report Generated: 2025-08-13
Issue: #88 Frontend API Pattern Violations
Priority: HIGH - Affects core flow functionality and user experience
