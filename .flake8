[flake8]
# Flake8 Configuration - Secure and maintainable code standards

# Line length settings - reasonable balance between readability and practicality
max-line-length = 120
max-doc-length = 120

# Error codes to ignore - only the most necessary exceptions
# E203: whitespace before ':' (conflicts with black formatting)
# W503: line break before binary operator (conflicts with black formatting)
ignore = E203,W503

# Per-file ignores for specific patterns - minimal exceptions only
per-file-ignores =
    # Migration files may have conditional imports and complex upgrade functions
    */alembic/versions/*.py:E402,C901
    # Backup migration files
    */alembic/versions_backup_pre_fix/*.py:E402,C901,E501
    # Main application file may have imports for registration
    main.py:E402
    # Test files that require sys.path manipulation before local imports
    test_*.py:E402
    # Analysis and migration utility scripts may have complex functions
    backend/analyze_migrations.py:C901
    backend/fix_migrations_auto.py:F401,F541
    backend/fix_remaining_migrations.py:F401,E501
    # Flow analysis scripts may have complex analysis functions
    backend/flow_analysis_and_resume.py:C901
    backend/simple_flow_analysis.py:C901
    # Admin handlers may have complex CRUD operations
    backend/app/api/v1/admin/client_management_handlers/client_crud_handler.py:C901
    # Discovery utilities may have complex assessment logic
    backend/app/api/v1/discovery/utils.py:C901
    backend/app/api/v1/discovery/asset_handlers/asset_crud.py:C901
    backend/app/api/v1/discovery/asset_handlers/asset_utils.py:C901
    # Collection applications endpoint has complex update logic
    backend/app/api/v1/endpoints/collection_applications.py:C901,E501
    backend/app/api/v1/endpoints/collection_phase_progression.py:F401
    # Collection CRUD questionnaires has complex query logic
    backend/app/api/v1/endpoints/collection_crud_questionnaires/queries.py:C901
    # Context establishment may have complex client logic
    backend/app/api/v1/endpoints/context_establishment.py:C901
    # Data import processing has complex asset determination
    backend/app/api/v1/endpoints/data_import/asset_processing.py:C901
    backend/app/api/v1/endpoints/data_import/critical_attributes.py:C901
    backend/app/api/v1/endpoints/data_import/field_mapping/services/mapping_service.py:C901
    backend/app/api/v1/endpoints/data_import/field_mapping/utils/mapping_generator.py:C901
    backend/app/api/v1/endpoints/data_import/field_mapping/utils/mapping_helpers.py:C901
    backend/app/api/v1/endpoints/data_import/field_mapping/validators/mapping_validators.py:C901
    # Script files may have complex main functions
    backend/scripts/deployment/railway_migration_check.py:C901
    backend/scripts/diagnose_railway_db.py:C901
    backend/scripts/force_railway_migration.py:C901
    backend/scripts/investigate_discovery_flow.py:C901
    backend/scripts/post_deploy_fix.py:C901
    backend/scripts/test_collection_phase_progression.py:F401,F541,E402
    backend/scripts/test_railway_connection.py:C901
    backend/scripts/unified_model_planning.py:C901
    backend/scripts/validate_flow_relationships.py:C901
    # Service files may have complex business logic
    backend/app/api/v1/endpoints/sixr_analysis_modular/services/analysis_service.py:C901
    backend/app/constants/cache_keys.py:C901
    backend/app/core/flow_state_validator.py:C901
    backend/app/docs/api/examples/data_import_examples.py:C901
    backend/app/models/collected_data_inventory.py:F401
    backend/app/services/adapters/aws_adapter/storage_services.py:C901
    backend/app/services/adapters/gcp_adapter/metrics.py:C901
    backend/app/services/adapters/onpremises_adapter/protocol_collectors.py:C901
    backend/app/services/agentic_intelligence/modernization_agent.py:C901
    backend/app/services/agents/gap_prioritization_agent_crewai.py:C901
    backend/app/services/collected_data_inventory_service.py:F401
    backend/app/services/collection_phase_progression_service.py:F401
    backend/app/services/crewai_flows/crews/dependency_analysis_crew/crew.py:C901
    backend/app/services/crewai_flows/crews/tech_debt_analysis_crew.py:C901
    backend/app/services/crewai_flows/crews/tech_debt_analysis_crew/tools.py:C901
    backend/app/services/crewai_flows/event_listeners/discovery_flow_listener.py:C901
    backend/app/services/crewai_flows/flow_state_bridge.py:C901
    backend/app/services/crewai_flows/handlers/phase_executors/asset_inventory_executor.py:C901
    backend/app/services/crewai_flows/handlers/phase_executors/base_phase_executor.py:C901
    backend/app/services/crewai_flows/persistence/state_recovery.py:C901
    backend/app/services/crewai_flows/unified_discovery_flow_crewai.py:C901
    backend/app/services/crewai_flows/tools/task_completion_tools.py:C901
    backend/app/services/crewai_flows/unified_collection_flow_modules/phase_handlers/automated_collection_handler.py:E501,F541
    backend/app/services/crewai_flows/unified_collection_flow_modules/phase_handlers/gap_analysis_handler.py:C901,E501
    backend/app/services/crewai_flows/unified_collection_flow_modules/phase_handlers/manual_collection_handler.py:E501,F541
    backend/app/services/crewai_flows/unified_discovery_flow/base_flow.py:C901
    backend/app/services/deepinfra_response_fixer.py:C901
    backend/app/services/flow_configs/assessment_validators.py:C901
    backend/app/services/flow_configs/discovery_validators.py:C901
    backend/app/services/flow_orchestration/field_mapping_logic.py:C901
    backend/app/services/gap_analysis_summary_service.py:F401
    backend/app/services/handler_registry.py:C901
    backend/app/services/manual_collection/progress_tracking_service.py:C901
    backend/app/services/persistent_agents/agent_pool_constants.py:E501
    backend/app/services/persistent_agents/flow_initialization.py:C901
    backend/app/services/rbac_handlers/admin_operations_handler.py:C901
    backend/app/services/rbac_handlers/user_management_handler.py:C901
    backend/app/services/recovery/error_recovery_system.py:C901
    backend/app/services/tools/asset_intelligence_tools.py:C901
    backend/app/services/tools/sixr_tools_modular.py:C901
    backend/app/services/validator_registry.py:C901
    backend/app/services/workflow_orchestration/tier_routing_service/environment_analyzer.py:C901
    backend/app/utils/flow_constants/performance_thresholds.py:C901
    # Backup and utility files
    backend/backups/alembic_versions_backup/railway_safe_schema_sync.py:C901
    backend/fix_migrations.py:F401,F841

# Exclude directories and file patterns
exclude =
    .git,
    __pycache__,
    .venv,
    venv,
    .env,
    env,
    migrations,
    .mypy_cache,
    .pytest_cache,
    build,
    dist,
    *.egg-info,
    node_modules,
    .tox,
    .coverage,
    htmlcov,
    docs/_build,
    backend/venv,
    backend/.venv,
    **/migrations/**,
    **/alembic/env.py,
    scripts/archive/**

# Enable specific warning categories
enable-extensions =
    # Enable comprehensions check
    C90

# Statistics and formatting
statistics = True
count = True
show-source = True
show-pep8 = True

# Import ordering (basic check)
import-order-style = google
application-import-names = app,backend

# Complexity settings - reasonable for maintainable code
# Keep complexity manageable for code quality
max-complexity = 15
max-cognitive-complexity = 15

# Documentation requirements
docstring-convention = google
require-return-annotation = False
require-parameter-annotation = False

# McCabe complexity plugin settings
max-mccabe-complexity = 15
