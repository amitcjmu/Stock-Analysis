/**
 * Engagement Management Core Types
 *
 * Core data models and type definitions for engagement management.
 * Defines engagement entities, clients, teams, users, and related core types.
 *
 * Generated by CC (Claude Code) - Modularized from engagement-management.ts
 */

// Status and Type Enums
export type EngagementStatus = 'draft' | 'active' | 'on_hold' | 'completed' | 'cancelled';
export type EngagementType = 'discovery' | 'assessment' | 'migration' | 'optimization' | 'support' | 'training';
export type PhaseStatus = 'not_started' | 'in_progress' | 'on_hold' | 'completed' | 'cancelled';
export type DeliverableType = 'document' | 'presentation' | 'code' | 'design' | 'analysis' | 'report';
export type DeliverableStatus = 'not_started' | 'in_progress' | 'review' | 'approved' | 'delivered';
export type MilestoneStatus = 'pending' | 'achieved' | 'missed' | 'cancelled';
export type CompanySize = 'startup' | 'small' | 'medium' | 'large' | 'enterprise';
export type ClientStatus = 'prospect' | 'active' | 'inactive' | 'former';
export type UserStatus = 'active' | 'inactive' | 'pending' | 'blocked';
export type RiskSeverity = 'low' | 'medium' | 'high' | 'critical';
export type RiskStatus = 'open' | 'mitigating' | 'closed' | 'accepted';
export type IssuePriority = 'low' | 'medium' | 'high' | 'urgent';
export type IssueStatus = 'open' | 'in_progress' | 'resolved' | 'closed';

// Core Engagement Entity
export interface Engagement {
  id: string;
  name: string;
  description?: string;
  type: EngagementType;
  status: EngagementStatus;
  clientId: string;
  client: Client;
  startDate: string;
  endDate?: string;
  estimatedEndDate?: string;
  budget?: number;
  currency?: string;
  teamLead: User;
  teamMembers: TeamMember[];
  phases: EngagementPhase[];
  deliverables: Deliverable[];
  milestones: Milestone[];
  risks: Risk[];
  issues: Issue[];
  artifacts: Artifact[];
  progress: number;
  createdAt: string;
  updatedAt: string;
  createdBy: string;
  tags?: string[];
  metadata?: Record<string, string | number | boolean | null>;
}

// Client Management Types
export interface Client {
  id: string;
  name: string;
  description?: string;
  industry: string;
  size: CompanySize;
  status: ClientStatus;
  primaryContact: ClientContact;
  additionalContacts: ClientContact[];
  address: ClientAddress;
  website?: string;
  logoUrl?: string;
  createdAt: string;
  updatedAt: string;
  tags?: string[];
  metadata?: Record<string, string | number | boolean | null>;
}

export interface ClientContact {
  id: string;
  name: string;
  email: string;
  phone?: string;
  title: string;
  department?: string;
  isPrimary: boolean;
  isActive: boolean;
}

export interface ClientAddress {
  street1: string;
  street2?: string;
  city: string;
  state: string;
  postalCode: string;
  country: string;
}

// Team Management Types
export interface Team {
  id: string;
  name: string;
  description?: string;
  teamLead: User;
  members: TeamMember[];
  skills: string[];
  capacity: number;
  utilization: number;
  isActive: boolean;
  createdAt: string;
  updatedAt: string;
}

export interface TeamMember {
  id: string;
  userId: string;
  user: User;
  role: string;
  responsibilities: string[];
  allocation: number; // Percentage allocation to this engagement
  startDate: string;
  endDate?: string;
  billableRate?: number;
  skills: string[];
  isLead: boolean;
  isActive: boolean;
}

export interface User {
  id: string;
  firstName: string;
  lastName: string;
  email: string;
  phone?: string;
  title: string;
  department: string;
  manager?: User;
  skills: string[];
  certifications: string[];
  status: UserStatus;
  avatarUrl?: string;
  timezone: string;
  startDate: string;
  endDate?: string;
  billableRate?: number;
  utilization: number;
  capacity: number;
  createdAt: string;
  updatedAt: string;
}

// Phase Management Types
export interface EngagementPhase {
  id: string;
  name: string;
  description?: string;
  order: number;
  status: PhaseStatus;
  startDate: string;
  endDate?: string;
  estimatedEndDate: string;
  duration: number; // in days
  budget?: number;
  actualCost?: number;
  progress: number;
  deliverables: Deliverable[];
  milestones: Milestone[];
  dependencies: string[]; // IDs of dependent phases
  prerequisites: string[];
  team: TeamMember[];
  risks: Risk[];
  issues: Issue[];
  artifacts: Artifact[];
  createdAt: string;
  updatedAt: string;
  metadata?: Record<string, string | number | boolean | null>;
}

// Deliverable Management Types
export interface Deliverable {
  id: string;
  name: string;
  description?: string;
  type: DeliverableType;
  status: DeliverableStatus;
  phaseId: string;
  phase: EngagementPhase;
  dueDate: string;
  completedDate?: string;
  owner: User;
  reviewers: User[];
  approvers: User[];
  dependencies: string[];
  template?: string;
  fileUrl?: string;
  version: string;
  size?: number;
  format?: string;
  progress: number;
  qualityScore?: number;
  reviewComments: ReviewComment[];
  createdAt: string;
  updatedAt: string;
  metadata?: Record<string, string | number | boolean | null>;
}

export interface ReviewComment {
  id: string;
  comment: string;
  author: User;
  status: 'pending' | 'addressed' | 'resolved' | 'rejected';
  priority: 'low' | 'medium' | 'high';
  createdAt: string;
  updatedAt: string;
  resolvedAt?: string;
  resolvedBy?: User;
}

// Milestone Management Types
export interface Milestone {
  id: string;
  name: string;
  description?: string;
  type: 'phase_gate' | 'delivery' | 'approval' | 'go_live' | 'review' | 'custom';
  status: MilestoneStatus;
  dueDate: string;
  achievedDate?: string;
  phaseId?: string;
  phase?: EngagementPhase;
  criteria: MilestoneCriteria[];
  dependencies: string[];
  deliverables: string[];
  approvers: User[];
  owner: User;
  progress: number;
  isGate: boolean; // If true, blocks phase progression
  isCritical: boolean;
  weight: number; // Relative importance
  createdAt: string;
  updatedAt: string;
  metadata?: Record<string, string | number | boolean | null>;
}

export interface MilestoneCriteria {
  id: string;
  description: string;
  weight: number;
  isMandatory: boolean;
  status: 'pending' | 'met' | 'failed' | 'waived';
  evidence?: string;
  evaluatedBy?: User;
  evaluatedAt?: string;
  comments?: string;
}

// Risk Management Types
export interface Risk {
  id: string;
  title: string;
  description: string;
  category: 'technical' | 'business' | 'resource' | 'schedule' | 'budget' | 'external';
  severity: RiskSeverity;
  probability: 'very_low' | 'low' | 'medium' | 'high' | 'very_high';
  impact: 'very_low' | 'low' | 'medium' | 'high' | 'very_high';
  riskScore: number; // Calculated from probability * impact
  status: RiskStatus;
  owner: User;
  identifiedBy: User;
  identifiedDate: string;
  mitigationPlan?: string;
  mitigationActions: RiskMitigationAction[];
  contingencyPlan?: string;
  reviewDate: string;
  lastReviewDate?: string;
  closedDate?: string;
  phaseId?: string;
  deliverableId?: string;
  tags: string[];
  createdAt: string;
  updatedAt: string;
}

export interface RiskMitigationAction {
  id: string;
  action: string;
  owner: User;
  dueDate: string;
  status: 'planned' | 'in_progress' | 'completed' | 'cancelled';
  completedDate?: string;
  effectiveness?: 'low' | 'medium' | 'high';
  cost?: number;
  comments?: string;
}

// Issue Management Types
export interface Issue {
  id: string;
  title: string;
  description: string;
  type: 'bug' | 'enhancement' | 'task' | 'question' | 'blocker' | 'change_request';
  priority: IssuePriority;
  severity: 'low' | 'medium' | 'high' | 'critical';
  status: IssueStatus;
  reporter: User;
  assignee: User;
  watchers: User[];
  reportedDate: string;
  assignedDate?: string;
  resolvedDate?: string;
  closedDate?: string;
  estimatedEffort?: number; // in hours
  actualEffort?: number; // in hours
  phaseId?: string;
  deliverableId?: string;
  milestoneId?: string;
  relatedIssues: string[];
  attachments: IssueAttachment[];
  comments: IssueComment[];
  workLog: IssueWorkLog[];
  labels: string[];
  customFields: Record<string, string | number | boolean | null>;
  createdAt: string;
  updatedAt: string;
}

export interface IssueAttachment {
  id: string;
  filename: string;
  size: number;
  mimeType: string;
  url: string;
  uploadedBy: User;
  uploadedAt: string;
}

export interface IssueComment {
  id: string;
  comment: string;
  author: User;
  isInternal: boolean;
  createdAt: string;
  updatedAt: string;
  editedBy?: User;
  reactions: CommentReaction[];
}

export interface CommentReaction {
  emoji: string;
  users: User[];
  count: number;
}

export interface IssueWorkLog {
  id: string;
  description: string;
  timeSpent: number; // in minutes
  dateWorked: string;
  worker: User;
  billable: boolean;
  createdAt: string;
}

// Artifact Management Types
export interface Artifact {
  id: string;
  name: string;
  description?: string;
  type: 'document' | 'code' | 'design' | 'data' | 'configuration' | 'media' | 'other';
  category: string;
  url: string;
  size: number;
  mimeType: string;
  version: string;
  isLatest: boolean;
  checksum?: string;
  phaseId?: string;
  deliverableId?: string;
  milestoneId?: string;
  uploadedBy: User;
  uploadedAt: string;
  lastModified: string;
  lastModifiedBy: User;
  access: 'public' | 'team' | 'restricted' | 'confidential';
  permissions: ArtifactPermission[];
  tags: string[];
  metadata: Record<string, string | number | boolean | null>;
  versionHistory: ArtifactVersion[];
}

export interface ArtifactPermission {
  userId: string;
  user: User;
  permission: 'read' | 'write' | 'admin';
  grantedBy: User;
  grantedAt: string;
}

export interface ArtifactVersion {
  version: string;
  size: number;
  checksum?: string;
  uploadedBy: User;
  uploadedAt: string;
  comments?: string;
  url: string;
}

// Template Types for Creation
export interface EngagementTemplate {
  id: string;
  name: string;
  description?: string;
  type: EngagementType;
  isDefault: boolean;
  isPublic: boolean;
  phases: EngagementPhaseTemplate[];
  deliverables: DeliverableTemplate[];
  milestones: MilestoneTemplate[];
  documents: DocumentTemplate[];
  fields: EngagementField[];
  estimatedDuration: number;
  estimatedBudget?: number;
  requiredSkills: string[];
  createdBy: User;
  createdAt: string;
  updatedAt: string;
  usageCount: number;
  tags: string[];
  metadata?: Record<string, string | number | boolean | null>;
}

export interface EngagementPhaseTemplate {
  id: string;
  name: string;
  description?: string;
  order: number;
  estimatedDuration: number;
  estimatedBudget?: number;
  deliverables: DeliverableTemplate[];
  milestones: MilestoneTemplate[];
  requiredSkills: string[];
  dependencies: string[];
  prerequisites: string[];
  isOptional: boolean;
  metadata?: Record<string, string | number | boolean | null>;
}

export interface DeliverableTemplate {
  id: string;
  name: string;
  description?: string;
  type: DeliverableType;
  template?: string;
  estimatedEffort: number;
  requiredSkills: string[];
  dependencies: string[];
  reviewRequired: boolean;
  approvalRequired: boolean;
  isOptional: boolean;
  qualityGates: string[];
  metadata?: Record<string, string | number | boolean | null>;
}

export interface MilestoneTemplate {
  id: string;
  name: string;
  description?: string;
  type: 'phase_gate' | 'delivery' | 'approval' | 'go_live' | 'review' | 'custom';
  criteria: MilestoneCriteriaTemplate[];
  dependencies: string[];
  deliverables: string[];
  isGate: boolean;
  isCritical: boolean;
  weight: number;
  estimatedDaysFromStart: number;
  metadata?: Record<string, string | number | boolean | null>;
}

export interface MilestoneCriteriaTemplate {
  description: string;
  weight: number;
  isMandatory: boolean;
  evaluationMethod?: string;
}

export interface DocumentTemplate {
  id: string;
  name: string;
  description?: string;
  type: DeliverableType;
  template: string;
  version: string;
  isActive: boolean;
  category: string;
  requiredFields: string[];
  optionalFields: string[];
  createdBy: User;
  createdAt: string;
  updatedAt: string;
}

// Custom Field Types
export interface EngagementField {
  id: string;
  name: string;
  label: string;
  type: 'text' | 'number' | 'date' | 'boolean' | 'select' | 'multiselect' | 'textarea' | 'file';
  required: boolean;
  defaultValue?: unknown;
  options?: FieldOption[];
  validation?: ValidationRule;
  dependencies?: FieldDependency[];
  section: string;
  order: number;
  isActive: boolean;
  metadata?: Record<string, string | number | boolean | null>;
}

export interface FieldOption {
  label: string;
  value: unknown;
  isDefault?: boolean;
  isActive?: boolean;
  order?: number;
}

export interface FieldDependency {
  field: string;
  condition: string;
  action: 'show' | 'hide' | 'enable' | 'disable' | 'require';
}

export interface ValidationRule {
  type: 'required' | 'minLength' | 'maxLength' | 'pattern' | 'range' | 'custom';
  value?: unknown;
  message?: string;
  customValidator?: string;
}

// Audit and History Types
export interface EngagementAuditLog {
  id: string;
  engagementId: string;
  action: 'created' | 'updated' | 'deleted' | 'status_changed' | 'phase_started' | 'phase_completed' | 'milestone_achieved';
  entity: 'engagement' | 'phase' | 'deliverable' | 'milestone' | 'risk' | 'issue' | 'artifact';
  entityId: string;
  changes: FieldChange[];
  user: User;
  timestamp: string;
  metadata?: Record<string, string | number | boolean | null>;
}

export interface FieldChange {
  field: string;
  oldValue: unknown;
  newValue: unknown;
  dataType: string;
}

// Summary and Statistics Types
export interface EngagementSummary {
  id: string;
  name: string;
  type: EngagementType;
  status: EngagementStatus;
  client: string;
  startDate: string;
  endDate?: string;
  progress: number;
  budget?: number;
  actualCost?: number;
  teamSize: number;
  phaseCount: number;
  completedPhases: number;
  deliverableCount: number;
  completedDeliverables: number;
  milestoneCount: number;
  achievedMilestones: number;
  activeRisks: number;
  openIssues: number;
  healthScore: number;
  isOnTrack: boolean;
  daysRemaining?: number;
}

export interface EngagementMetrics {
  totalEngagements: number;
  activeEngagements: number;
  completedEngagements: number;
  averageDuration: number;
  averageBudget: number;
  averageTeamSize: number;
  onTimeDeliveryRate: number;
  budgetVarianceRate: number;
  clientSatisfactionScore: number;
  teamUtilization: number;
  riskDistribution: Record<RiskSeverity, number>;
  typeDistribution: Record<EngagementType, number>;
  statusDistribution: Record<EngagementStatus, number>;
}
