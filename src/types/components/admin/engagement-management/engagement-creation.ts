/**
 * Engagement Creation Component Types
 * 
 * Type definitions for engagement creation workflows, templates,
 * validation, and multi-step form management.
 * 
 * Generated by CC (Claude Code) - Modularized from engagement-management.ts
 */

import { ReactNode } from 'react';
import { BaseComponentProps } from '../../shared';
import { 
  Engagement, 
  EngagementType, 
  Client, 
  Team, 
  User, 
  EngagementTemplate,
  EngagementField,
  ValidationRule
} from './core-types';

// Main Engagement Creation Component
export interface EngagementCreationProps extends BaseComponentProps {
  onSubmit: (engagement: CreateEngagementRequest) => void | Promise<void>;
  onCancel?: () => void;
  clients?: Client[];
  templates?: EngagementTemplate[];
  teams?: Team[];
  users?: User[];
  loading?: boolean;
  error?: string | null;
  mode?: 'create' | 'clone' | 'template';
  sourceEngagement?: Engagement;
  sourceTemplate?: EngagementTemplate;
  steps?: EngagementCreationStep[];
  currentStep?: number;
  onStepChange?: (step: number) => void;
  validation?: EngagementValidationConfig;
  autoSave?: boolean;
  autoSaveInterval?: number;
  onAutoSave?: (data: Partial<CreateEngagementRequest>) => void;
  renderStep?: (step: EngagementCreationStep, data: Partial<CreateEngagementRequest>) => ReactNode;
  renderNavigation?: (currentStep: number, totalSteps: number) => ReactNode;
  renderActions?: (currentStep: number, totalSteps: number, canProceed: boolean) => ReactNode;
  size?: 'xs' | 'sm' | 'md' | 'lg' | 'xl' | 'full';
  layout?: 'vertical' | 'horizontal' | 'wizard';
  showProgress?: boolean;
  showValidation?: boolean;
  allowSkipSteps?: boolean;
  allowBackNavigation?: boolean;
}

// Custom field types
export type CustomFieldValue = string | number | boolean | Date | string[] | number[];

// Creation Request Data
export interface CreateEngagementRequest {
  name: string;
  description?: string;
  type: EngagementType;
  clientId: string;
  startDate: string;
  estimatedEndDate: string;
  budget?: number;
  currency?: string;
  teamLeadId: string;
  teamMemberIds: string[];
  templateId?: string;
  phases: CreateEngagementPhase[];
  deliverables: CreateDeliverable[];
  milestones: CreateMilestone[];
  customFields?: Record<string, CustomFieldValue>;
  tags?: string[];
  metadata?: Record<string, string | number | boolean>;
}

// Phase Creation Data
export interface CreateEngagementPhase {
  name: string;
  description?: string;
  order: number;
  estimatedStartDate: string;
  estimatedEndDate: string;
  estimatedBudget?: number;
  deliverableIds?: string[];
  milestoneIds?: string[];
  teamMemberIds?: string[];
  dependencies?: string[];
  prerequisites?: string[];
  templateId?: string;
  customFields?: Record<string, CustomFieldValue>;
  metadata?: Record<string, string | number | boolean>;
}

// Deliverable Creation Data
export interface CreateDeliverable {
  name: string;
  description?: string;
  type: string;
  phaseId?: string;
  dueDate: string;
  ownerId: string;
  reviewerIds?: string[];
  approverIds?: string[];
  dependencies?: string[];
  templateId?: string;
  customFields?: Record<string, CustomFieldValue>;
  metadata?: Record<string, string | number | boolean>;
}

// Milestone Creation Data
export interface CreateMilestone {
  name: string;
  description?: string;
  type: 'phase_gate' | 'delivery' | 'approval' | 'go_live' | 'review' | 'custom';
  dueDate: string;
  phaseId?: string;
  criteria: CreateMilestoneCriteria[];
  dependencies?: string[];
  deliverableIds?: string[];
  approverIds?: string[];
  ownerId: string;
  isGate?: boolean;
  isCritical?: boolean;
  weight?: number;
  templateId?: string;
  customFields?: Record<string, CustomFieldValue>;
  metadata?: Record<string, string | number | boolean>;
}

export interface CreateMilestoneCriteria {
  description: string;
  weight: number;
  isMandatory: boolean;
  evaluationMethod?: string;
}

// Creation Workflow Steps
export interface EngagementCreationStep {
  id: string;
  title: string;
  description?: string;
  icon?: string;
  order: number;
  isRequired: boolean;
  isCompleted?: boolean;
  isSkippable?: boolean;
  fields: EngagementCreationField[];
  validation: StepValidationRule[];
  dependencies?: string[];
  estimatedTime?: number;
  helpText?: string;
  sections?: EngagementCreationSection[];
}

export interface EngagementCreationField extends EngagementField {
  step: string;
  section?: string;
  autoFill?: AutoFillConfig;
  conditional?: ConditionalConfig;
}

export interface EngagementCreationSection {
  id: string;
  title: string;
  description?: string;
  order: number;
  collapsible?: boolean;
  defaultCollapsed?: boolean;
  fields: string[];
}

export interface AutoFillConfig {
  source: 'template' | 'client' | 'user' | 'previous_engagement' | 'calculation';
  sourceId?: string;
  mapping?: FieldMapping[];
  conditions?: AutoFillCondition[];
}

export interface FieldMapping {
  sourceField: string;
  targetField: string;
  transform?: FieldTransform;
}

export interface FieldTransform {
  type: 'uppercase' | 'lowercase' | 'capitalize' | 'format_date' | 'calculate' | 'lookup' | 'custom';
  parameters?: Record<string, string | number | boolean>;
  customFunction?: string;
}

export interface AutoFillCondition {
  field: string;
  operator: 'equals' | 'not_equals' | 'contains' | 'not_contains' | 'greater' | 'less';
  value: unknown;
}

export interface ConditionalConfig {
  showWhen?: FieldCondition[];
  hideWhen?: FieldCondition[];
  enableWhen?: FieldCondition[];
  disableWhen?: FieldCondition[];
  requireWhen?: FieldCondition[];
}

export interface FieldCondition {
  field: string;
  operator: 'equals' | 'not_equals' | 'contains' | 'not_contains' | 'greater' | 'less' | 'in' | 'not_in';
  value: unknown;
  logicalOperator?: 'and' | 'or';
}

// Validation Configuration
export interface EngagementValidationConfig {
  validateOnBlur?: boolean;
  validateOnChange?: boolean;
  validateOnSubmit?: boolean;
  showValidationSummary?: boolean;
  stopOnFirstError?: boolean;
  customValidators?: CustomValidator[];
  businessRules?: BusinessRule[];
}

export interface StepValidationRule {
  field?: string;
  type: 'required' | 'format' | 'range' | 'dependency' | 'business_rule' | 'custom';
  message: string;
  parameters?: Record<string, string | number | boolean | RegExp>;
  severity?: 'error' | 'warning' | 'info';
  validator?: string;
  async?: boolean;
}

export interface CustomValidator {
  name: string;
  validator: (value: unknown, field: EngagementCreationField, data: Partial<CreateEngagementRequest>) => boolean | string | Promise<boolean | string>;
  async?: boolean;
  debounce?: number;
}

export interface BusinessRule {
  id: string;
  name: string;
  description: string;
  condition: (data: Partial<CreateEngagementRequest>) => boolean;
  action: 'prevent' | 'warn' | 'suggest' | 'auto_correct';
  message: string;
  suggestion?: string;
  autoCorrection?: (data: Partial<CreateEngagementRequest>) => Partial<CreateEngagementRequest>;
}

// Template Selection and Management
export interface TemplateSelectionProps extends BaseComponentProps {
  templates: EngagementTemplate[];
  selectedTemplate?: EngagementTemplate;
  onTemplateSelect: (template: EngagementTemplate | null) => void;
  onTemplatePreview?: (template: EngagementTemplate) => void;
  onTemplateEdit?: (template: EngagementTemplate) => void;
  showPreview?: boolean;
  showEdit?: boolean;
  allowNone?: boolean;
  filterByType?: EngagementType[];
  groupBy?: 'type' | 'author' | 'usage' | 'date';
  sortBy?: 'name' | 'type' | 'usage' | 'date';
  size?: 'xs' | 'sm' | 'md' | 'lg';
  variant?: 'grid' | 'list' | 'dropdown';
}

export interface TemplatePreviewProps extends BaseComponentProps {
  template: EngagementTemplate;
  onClose: () => void;
  onSelect?: (template: EngagementTemplate) => void;
  onEdit?: (template: EngagementTemplate) => void;
  showActions?: boolean;
  size?: 'sm' | 'md' | 'lg' | 'xl' | 'full';
}

// Client Selection
export interface ClientSelectionProps extends BaseComponentProps {
  clients: Client[];
  selectedClient?: Client;
  onClientSelect: (client: Client | null) => void;
  onClientCreate?: () => void;
  onClientEdit?: (client: Client) => void;
  searchable?: boolean;
  showCreate?: boolean;
  showEdit?: boolean;
  showDetails?: boolean;
  filterByStatus?: boolean;
  sortBy?: 'name' | 'size' | 'industry' | 'status';
  size?: 'xs' | 'sm' | 'md' | 'lg';
  variant?: 'dropdown' | 'list' | 'card';
}

// Team Assignment
export interface TeamAssignmentProps extends BaseComponentProps {
  teams: Team[];
  users: User[];
  selectedTeamLead?: User;
  selectedTeamMembers?: User[];
  onTeamLeadSelect: (user: User | null) => void;
  onTeamMembersSelect: (users: User[]) => void;
  requiredSkills?: string[];
  estimatedEffort?: number;
  budget?: number;
  showSkillMatch?: boolean;
  showAvailability?: boolean;
  showRates?: boolean;
  allowExternal?: boolean;
  maxTeamSize?: number;
  minTeamSize?: number;
  recommendedTeamSize?: number;
  onTeamOptimize?: () => void;
  size?: 'sm' | 'md' | 'lg';
}

// Phase Management During Creation
export interface PhaseCreationProps extends BaseComponentProps {
  phases: CreateEngagementPhase[];
  onPhasesChange: (phases: CreateEngagementPhase[]) => void;
  templates?: EngagementTemplate[];
  users?: User[];
  showTemplate?: boolean;
  allowReorder?: boolean;
  allowDelete?: boolean;
  maxPhases?: number;
  minPhases?: number;
  validation?: PhaseValidationConfig;
  size?: 'sm' | 'md' | 'lg';
}

export interface PhaseValidationConfig {
  validateOverlap?: boolean;
  validateDependencies?: boolean;
  validateDuration?: boolean;
  validateBudget?: boolean;
  minDuration?: number;
  maxDuration?: number;
  allowWeekends?: boolean;
  allowHolidays?: boolean;
}

// Deliverable and Milestone Creation
export interface DeliverableCreationProps extends BaseComponentProps {
  deliverables: CreateDeliverable[];
  phases: CreateEngagementPhase[];
  onDeliverablesChange: (deliverables: CreateDeliverable[]) => void;
  templates?: EngagementTemplate[];
  users?: User[];
  showTemplate?: boolean;
  allowBulkCreate?: boolean;
  size?: 'sm' | 'md' | 'lg';
}

export interface MilestoneCreationProps extends BaseComponentProps {
  milestones: CreateMilestone[];
  phases: CreateEngagementPhase[];
  onMilestonesChange: (milestones: CreateMilestone[]) => void;
  templates?: EngagementTemplate[];
  users?: User[];
  showTemplate?: boolean;
  allowBulkCreate?: boolean;
  showCriteria?: boolean;
  size?: 'sm' | 'md' | 'lg';
}

// Form State Management
export interface EngagementFormState {
  data: Partial<CreateEngagementRequest>;
  errors: Record<string, string[]>;
  touched: Record<string, boolean>;
  isValid: boolean;
  isSubmitting: boolean;
  isDirty: boolean;
  currentStep: number;
  completedSteps: number[];
  autoSaveData?: Partial<CreateEngagementRequest>;
  lastAutoSave?: string;
}

export interface EngagementFormActions {
  updateField: (field: string, value: unknown) => void;
  updateFields: (updates: Record<string, CustomFieldValue>) => void;
  validateField: (field: string) => Promise<boolean>;
  validateStep: (step: number) => Promise<boolean>;
  validateAll: () => Promise<boolean>;
  clearErrors: (fields?: string[]) => void;
  markTouched: (fields: string[]) => void;
  goToStep: (step: number) => void;
  nextStep: () => void;
  previousStep: () => void;
  reset: () => void;
  submit: () => Promise<boolean>;
  autoSave: () => void;
}

// Wizard Navigation
export interface EngagementWizardNavigation {
  currentStep: number;
  totalSteps: number;
  canGoNext: boolean;
  canGoPrevious: boolean;
  canSkip: boolean;
  isFirstStep: boolean;
  isLastStep: boolean;
  completedSteps: number[];
  skippedSteps: number[];
}

// Form Helpers and Utilities
export interface EngagementFormHelpers {
  getFieldValue: (field: string) => unknown;
  setFieldValue: (field: string, value: unknown) => void;
  getFieldError: (field: string) => string | undefined;
  hasFieldError: (field: string) => boolean;
  isFieldTouched: (field: string) => boolean;
  isFieldValid: (field: string) => boolean;
  getStepData: (step: number) => Record<string, CustomFieldValue>;
  getStepProgress: (step: number) => number;
  calculateTotalProgress: () => number;
  getFormSummary: () => EngagementFormSummary;
}

export interface EngagementFormSummary {
  totalFields: number;
  completedFields: number;
  requiredFields: number;
  completedRequiredFields: number;
  errorCount: number;
  warningCount: number;
  progress: number;
  estimatedTimeRemaining: number;
  isComplete: boolean;
  isValid: boolean;
}

// Form Persistence
export interface FormPersistence {
  save: (data: Partial<CreateEngagementRequest>) => void;
  load: () => Partial<CreateEngagementRequest> | null;
  clear: () => void;
  exists: () => boolean;
  getTimestamp: () => string | null;
}

// Quick Actions and Shortcuts
export interface EngagementCreationQuickActions {
  saveAsDraft: () => void;
  saveAsTemplate: () => void;
  loadFromTemplate: (templateId: string) => void;
  cloneFromEngagement: (engagementId: string) => void;
  importFromFile: (file: File) => void;
  exportAsFile: (format: 'json' | 'csv' | 'xlsx') => void;
  previewEngagement: () => void;
  validateAll: () => void;
  resetForm: () => void;
}

// Progress Tracking
export interface CreationProgress {
  overall: number;
  byStep: Record<string, number>;
  estimatedCompletion: string;
  timeSpent: number;
  timeRemaining: number;
  blockers: ProgressBlocker[];
  suggestions: ProgressSuggestion[];
}

export interface ProgressBlocker {
  step: string;
  field?: string;
  message: string;
  severity: 'error' | 'warning';
  suggestion?: string;
}

export interface ProgressSuggestion {
  type: 'template' | 'team' | 'timeline' | 'budget';
  message: string;
  action?: string;
  benefit?: string;
}