/**
 * FinOps Governance Types
 * 
 * Type definitions for financial governance policies, compliance validation, and enforcement.
 * Covers policy management, compliance monitoring, and governance enforcement mechanisms.
 * 
 * Generated by CC (Claude Code) - Modularized from finops.ts
 */

import {
  BaseApiRequest,
  BaseApiResponse,
  MultiTenantContext,
  CreateRequest,
  CreateResponse
} from '../shared';

// Financial Governance APIs
export interface CreateCostGovernancePolicyRequest extends CreateRequest<CostGovernancePolicyData> {
  flowId: string;
  data: CostGovernancePolicyData;
  policyType: 'budget' | 'spending' | 'resource' | 'approval' | 'tagging';
  scope: GovernanceScope;
  rules: GovernanceRule[];
  enforcement: PolicyEnforcement;
  exceptions: PolicyException[];
}

export interface CreateCostGovernancePolicyResponse extends CreateResponse<CostGovernancePolicy> {
  data: CostGovernancePolicy;
  policyId: string;
  enforcementPlan: EnforcementPlan;
  complianceChecks: ComplianceCheck[];
  auditTrail: AuditTrail;
}

export interface ValidateCostGovernanceRequest extends BaseApiRequest {
  flowId: string;
  policyIds?: string[];
  validationType: 'realtime' | 'scheduled' | 'on_demand';
  scope: ValidationScope;
  includeRemediation?: boolean;
  context: MultiTenantContext;
}

export interface ValidateCostGovernanceResponse extends BaseApiResponse<GovernanceValidationResult> {
  data: GovernanceValidationResult;
  validationId: string;
  complianceScore: number;
  violations: PolicyViolation[];
  recommendations: ComplianceRecommendation[];
  remediationPlan: RemediationPlan;
}

export interface EnforceCostGovernanceRequest extends BaseApiRequest {
  policyId: string;
  enforcementAction: 'notify' | 'restrict' | 'terminate' | 'escalate';
  violationIds?: string[];
  overrideApproval?: string;
  gracePeriod?: number;
  context: MultiTenantContext;
}

export interface EnforceCostGovernanceResponse extends BaseApiResponse<EnforcementResult> {
  data: EnforcementResult;
  enforcementId: string;
  actionsExecuted: EnforcementAction[];
  exceptions: EnforcementException[];
  notifications: EnforcementNotification[];
}

// Supporting Data Types
export interface CostGovernancePolicyData {
  id: string;
  flowId: string;
  name: string;
  description: string;
  policyType: string;
  version: string;
  scope: GovernanceScope;
  rules: GovernanceRule[];
  enforcement: PolicyEnforcement;
  exceptions: PolicyException[];
  stakeholders: PolicyStakeholder[];
  effectiveDate: string;
  expirationDate?: string;
  tags: Record<string, string>;
  metadata: Record<string, any>;
}

export interface CostGovernancePolicy {
  id: string;
  flowId: string;
  name: string;
  description: string;
  policyType: string;
  version: string;
  scope: GovernanceScope;
  rules: GovernanceRule[];
  enforcement: PolicyEnforcement;
  exceptions: PolicyException[];
  stakeholders: PolicyStakeholder[];
  effectiveDate: string;
  expirationDate?: string;
  tags: Record<string, string>;
  metadata: Record<string, any>;
  policyId: string;
  status: 'draft' | 'active' | 'inactive' | 'deprecated' | 'expired';
  approvals: PolicyApproval[];
  compliance: PolicyCompliance;
  enforcementStatus: PolicyEnforcementStatus;
  auditTrail: AuditTrail;
  createdAt: string;
  updatedAt: string;
  createdBy: string;
  lastModifiedBy: string;
}

export interface GovernanceScope {
  organizationLevel: 'global' | 'division' | 'department' | 'project' | 'team';
  accounts: string[];
  services: string[];
  resources: string[];
  regions: string[];
  environments: string[];
  costCenters: string[];
  projects: string[];
  users: string[];
  roles: string[];
  tags: Record<string, string>;
  exclusions: ScopeExclusion[];
}

export interface ScopeExclusion {
  type: 'account' | 'service' | 'resource' | 'region' | 'tag';
  values: string[];
  reason: string;
  temporary: boolean;
  expirationDate?: string;
}

export interface GovernanceRule {
  id: string;
  name: string;
  description: string;
  type: 'budget_limit' | 'spending_threshold' | 'resource_quota' | 'approval_required' | 'tagging_required';
  condition: RuleCondition;
  action: RuleAction;
  priority: number;
  enabled: boolean;
  exceptions: RuleException[];
  metadata: Record<string, any>;
}

export interface RuleCondition {
  operator: 'equals' | 'not_equals' | 'greater_than' | 'less_than' | 'contains' | 'not_contains' | 'in' | 'not_in';
  field: string;
  value: any;
  threshold?: number;
  timeWindow?: string;
  aggregation?: 'sum' | 'avg' | 'max' | 'min' | 'count';
}

export interface RuleAction {
  type: 'alert' | 'block' | 'approve' | 'tag' | 'escalate' | 'audit';
  parameters: Record<string, any>;
  automatic: boolean;
  notifications: ActionNotification[];
  escalation?: EscalationRule;
}

export interface ActionNotification {
  method: 'email' | 'slack' | 'webhook' | 'dashboard' | 'sms';
  recipients: string[];
  template: string;
  frequency: 'immediate' | 'daily' | 'weekly' | 'monthly';
  severity: 'info' | 'warning' | 'error' | 'critical';
}

export interface EscalationRule {
  levels: EscalationLevel[];
  timeout: string;
  finalAction: string;
}

export interface EscalationLevel {
  level: number;
  escalateTo: string[];
  timeout: string;
  actions: string[];
}

export interface RuleException {
  id: string;
  type: 'permanent' | 'temporary' | 'conditional';
  scope: ExceptionScope;
  reason: string;
  approvedBy: string;
  approvedAt: string;
  expirationDate?: string;
  conditions?: string[];
}

export interface ExceptionScope {
  accounts?: string[];
  services?: string[];
  resources?: string[];
  users?: string[];
  projects?: string[];
  tags?: Record<string, string>;
}

export interface PolicyEnforcement {
  mode: 'monitoring' | 'advisory' | 'preventive' | 'corrective';
  strictness: 'lenient' | 'moderate' | 'strict' | 'rigid';
  automation: EnforcementAutomation;
  notifications: EnforcementNotification[];
  escalation: EnforcementEscalation;
  exceptions: EnforcementException[];
}

export interface EnforcementAutomation {
  enabled: boolean;
  triggers: AutomationTrigger[];
  actions: AutomationAction[];
  safeguards: AutomationSafeguard[];
  rollback: AutomationRollback;
}

export interface AutomationTrigger {
  event: string;
  condition: string;
  threshold?: any;
  frequency?: string;
}

export interface AutomationAction {
  type: string;
  parameters: Record<string, any>;
  prerequisites: string[];
  validation: string[];
}

export interface AutomationSafeguard {
  type: 'rate_limiting' | 'approval_required' | 'testing_required' | 'rollback_plan';
  configuration: Record<string, any>;
  override: boolean;
}

export interface AutomationRollback {
  enabled: boolean;
  triggers: string[];
  procedures: string[];
  timeLimit: string;
}

export interface EnforcementNotification {
  trigger: 'violation' | 'warning' | 'compliance' | 'exception';
  recipients: NotificationRecipient[];
  channels: NotificationChannel[];
  templates: NotificationTemplate[];
  frequency: string;
}

export interface NotificationRecipient {
  type: 'user' | 'role' | 'group' | 'external';
  identifier: string;
  escalation: boolean;
}

export interface NotificationChannel {
  type: 'email' | 'slack' | 'webhook' | 'dashboard' | 'ticket';
  configuration: Record<string, any>;
  priority: number;
}

export interface NotificationTemplate {
  type: string;
  content: string;
  variables: string[];
  localization: Record<string, string>;
}

export interface EnforcementEscalation {
  enabled: boolean;
  levels: EscalationLevel[];
  timeouts: string[];
  finalActions: string[];
}

export interface PolicyException {
  id: string;
  type: 'account' | 'service' | 'resource' | 'user' | 'project' | 'temporary';
  scope: ExceptionScope;
  reason: string;
  justification: string;
  approver: string;
  approvedAt: string;
  effectiveDate: string;
  expirationDate?: string;
  conditions: ExceptionCondition[];
  monitoring: ExceptionMonitoring;
}

export interface ExceptionCondition {
  type: 'time_based' | 'value_based' | 'event_based' | 'approval_based';
  condition: string;
  value?: any;
  monitoring: boolean;
}

export interface ExceptionMonitoring {
  enabled: boolean;
  metrics: string[];
  thresholds: Record<string, any>;
  reporting: string[];
}

export interface PolicyStakeholder {
  userId: string;
  role: 'owner' | 'approver' | 'reviewer' | 'enforcer' | 'auditor';
  responsibilities: string[];
  notifications: boolean;
}

export interface PolicyApproval {
  id: string;
  type: 'creation' | 'modification' | 'activation' | 'deactivation';
  status: 'pending' | 'approved' | 'rejected' | 'expired';
  approver: string;
  requestedAt: string;
  approvedAt?: string;
  rejectedAt?: string;
  reason?: string;
  conditions?: string[];
}

export interface PolicyCompliance {
  overallScore: number;
  lastAssessment: string;
  violations: ComplianceViolation[];
  trends: ComplianceTrend[];
  metrics: ComplianceMetric[];
  status: 'compliant' | 'non_compliant' | 'partially_compliant' | 'unknown';
}

export interface ComplianceViolation {
  id: string;
  ruleId: string;
  severity: 'low' | 'medium' | 'high' | 'critical';
  description: string;
  detectedAt: string;
  status: 'open' | 'investigating' | 'resolved' | 'accepted';
  impact: ViolationImpact;
  remediation: ViolationRemediation;
}

export interface ViolationImpact {
  financial: number;
  operational: string;
  security: string;
  compliance: string;
}

export interface ViolationRemediation {
  required: boolean;
  automated: boolean;
  steps: string[];
  timeline: string;
  cost: number;
}

export interface ComplianceTrend {
  metric: string;
  direction: 'improving' | 'degrading' | 'stable';
  rate: number;
  timeframe: string;
  significance: 'low' | 'medium' | 'high';
}

export interface ComplianceMetric {
  name: string;
  value: number;
  target: number;
  unit: string;
  trend: 'improving' | 'degrading' | 'stable';
  lastUpdated: string;
}

export interface PolicyEnforcementStatus {
  enabled: boolean;
  mode: string;
  lastEnforcement: string;
  statistics: EnforcementStatistics;
  issues: EnforcementIssue[];
}

export interface EnforcementStatistics {
  totalActions: number;
  successfulActions: number;
  failedActions: number;
  violationsDetected: number;
  violationsResolved: number;
  averageResolutionTime: string;
}

export interface EnforcementIssue {
  id: string;
  type: 'configuration' | 'technical' | 'approval' | 'exception';
  description: string;
  severity: 'low' | 'medium' | 'high' | 'critical';
  status: 'open' | 'investigating' | 'resolved';
  createdAt: string;
  resolvedAt?: string;
}

export interface AuditTrail {
  entries: AuditEntry[];
  retention: string;
  compliance: AuditCompliance;
}

export interface AuditEntry {
  id: string;
  timestamp: string;
  user: string;
  action: string;
  resource: string;
  details: Record<string, any>;
  outcome: 'success' | 'failure' | 'partial';
  impact: string;
}

export interface AuditCompliance {
  standards: string[];
  requirements: string[];
  certifications: string[];
  reports: AuditReport[];
}

export interface AuditReport {
  id: string;
  type: string;
  period: string;
  status: string;
  findings: string[];
  recommendations: string[];
  generatedAt: string;
}

export interface ValidationScope {
  policies: string[];
  accounts: string[];
  services: string[];
  timeRange: {
    start: string;
    end: string;
  };
  depth: 'surface' | 'detailed' | 'comprehensive';
}

export interface GovernanceValidationResult {
  id: string;
  scope: ValidationScope;
  complianceScore: number;
  status: 'compliant' | 'non_compliant' | 'partially_compliant';
  summary: ValidationSummary;
  violations: PolicyViolation[];
  recommendations: ComplianceRecommendation[];
  remediationPlan: RemediationPlan;
  generatedAt: string;
}

export interface ValidationSummary {
  policiesChecked: number;
  rulesEvaluated: number;
  violationsFound: number;
  complianceRate: number;
  riskLevel: 'low' | 'medium' | 'high' | 'critical';
  categories: CategorySummary[];
}

export interface CategorySummary {
  category: string;
  compliance: number;
  violations: number;
  risk: 'low' | 'medium' | 'high' | 'critical';
}

export interface PolicyViolation {
  id: string;
  policyId: string;
  ruleId: string;
  severity: 'low' | 'medium' | 'high' | 'critical';
  type: string;
  description: string;
  resource: ViolationResource;
  detectedAt: string;
  impact: ViolationImpact;
  evidence: ViolationEvidence;
  context: ViolationContext;
  recommendations: string[];
}

export interface ViolationResource {
  id: string;
  type: string;
  name: string;
  account: string;
  region: string;
  tags: Record<string, string>;
}

export interface ViolationEvidence {
  metrics: Record<string, any>;
  logs: string[];
  screenshots?: string[];
  configurations: Record<string, any>;
}

export interface ViolationContext {
  user: string;
  project: string;
  environment: string;
  costCenter: string;
  businessJustification?: string;
}

export interface ComplianceRecommendation {
  id: string;
  type: 'immediate' | 'short_term' | 'long_term' | 'strategic';
  priority: 'low' | 'medium' | 'high' | 'critical';
  title: string;
  description: string;
  impact: RecommendationImpact;
  effort: 'low' | 'medium' | 'high';
  cost: number;
  timeline: string;
  dependencies: string[];
  alternatives: string[];
}

export interface RecommendationImpact {
  compliance: number;
  cost: number;
  risk: number;
  operational: string;
}

export interface RemediationPlan {
  id: string;
  violations: string[];
  strategy: RemediationStrategy;
  actions: RemediationAction[];
  timeline: RemediationTimeline;
  resources: RemediationResource[];
  risks: RemediationRisk[];
  monitoring: RemediationMonitoring;
}

export interface RemediationStrategy {
  approach: 'automated' | 'manual' | 'hybrid';
  priority: 'immediate' | 'scheduled' | 'planned';
  coordination: 'centralized' | 'distributed';
  rollback: boolean;
}

export interface RemediationAction {
  id: string;
  type: 'configure' | 'deploy' | 'remove' | 'approve' | 'escalate';
  description: string;
  automated: boolean;
  prerequisites: string[];
  steps: string[];
  validation: string[];
  rollback?: string[];
}

export interface RemediationTimeline {
  phases: RemediationPhase[];
  milestones: RemediationMilestone[];
  dependencies: RemediationDependency[];
  criticalPath: string[];
}

export interface RemediationPhase {
  id: string;
  name: string;
  actions: string[];
  duration: string;
  dependencies: string[];
  success_criteria: string[];
}

export interface RemediationMilestone {
  id: string;
  name: string;
  date: string;
  deliverables: string[];
  approval_required: boolean;
}

export interface RemediationDependency {
  id: string;
  type: 'technical' | 'approval' | 'resource' | 'external';
  description: string;
  blocker: boolean;
  estimated_resolution: string;
}

export interface RemediationResource {
  type: 'human' | 'technical' | 'financial';
  description: string;
  quantity: number;
  cost: number;
  availability: string;
}

export interface RemediationRisk {
  type: 'technical' | 'operational' | 'financial' | 'compliance';
  description: string;
  likelihood: 'low' | 'medium' | 'high';
  impact: 'low' | 'medium' | 'high';
  mitigation: string;
}

export interface RemediationMonitoring {
  metrics: string[];
  dashboards: string[];
  alerts: string[];
  reporting: MonitoringReporting;
}

export interface MonitoringReporting {
  frequency: string;
  recipients: string[];
  format: string;
  automation: boolean;
}

export interface EnforcementResult {
  id: string;
  policyId: string;
  action: string;
  status: 'success' | 'failure' | 'partial';
  summary: EnforcementSummary;
  actionsExecuted: EnforcementAction[];
  exceptions: EnforcementException[];
  notifications: EnforcementNotification[];
  auditTrail: string[];
  timestamp: string;
}

export interface EnforcementSummary {
  violationsAddressed: number;
  actionsExecuted: number;
  exceptionsGranted: number;
  compliance_improvement: number;
  cost_impact: number;
}

export interface EnforcementAction {
  id: string;
  type: 'block' | 'modify' | 'approve' | 'escalate' | 'notify';
  target: string;
  description: string;
  automated: boolean;
  status: 'success' | 'failure' | 'pending';
  timestamp: string;
  details: Record<string, any>;
}

export interface EnforcementException {
  id: string;
  reason: string;
  type: 'temporary' | 'permanent' | 'conditional';
  approver: string;
  conditions: string[];
  expiration?: string;
  monitoring: boolean;
}

export interface EnforcementPlan {
  strategy: EnforcementStrategy;
  phases: EnforcementPhase[];
  automation: EnforcementAutomation;
  monitoring: EnforcementMonitoring;
  escalation: EnforcementEscalation;
}

export interface EnforcementStrategy {
  approach: 'gradual' | 'immediate' | 'phased';
  scope: 'full' | 'pilot' | 'targeted';
  communication: CommunicationStrategy;
  training: TrainingStrategy;
}

export interface CommunicationStrategy {
  channels: string[];
  frequency: string;
  stakeholders: string[];
  messaging: string[];
}

export interface TrainingStrategy {
  required: boolean;
  modules: string[];
  delivery: string[];
  assessment: boolean;
}

export interface EnforcementPhase {
  id: string;
  name: string;
  scope: string[];
  duration: string;
  success_criteria: string[];
  rollback_triggers: string[];
}

export interface EnforcementMonitoring {
  metrics: string[];
  dashboards: string[];
  alerts: string[];
  reporting: string[];
}

export interface ComplianceCheck {
  id: string;
  name: string;
  type: 'automated' | 'manual' | 'hybrid';
  frequency: string;
  scope: string[];
  criteria: CheckCriteria[];
  remediation: CheckRemediation;
}

export interface CheckCriteria {
  rule: string;
  threshold: any;
  operator: string;
  tolerance: number;
}

export interface CheckRemediation {
  automated: boolean;
  actions: string[];
  approval_required: boolean;
  escalation: string[];
}