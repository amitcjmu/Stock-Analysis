/**
 * Policy Management Types
 * 
 * Financial governance policy creation, management, and lifecycle.
 * 
 * Generated by CC - Claude Code
 */

import type { BaseMetadata, AuditableMetadata } from '../../../shared/metadata-types';
import type { ConfigurationValue } from '../../../shared/config-types';
import type {
  BaseApiRequest,
  BaseApiResponse,
  MultiTenantContext,
  CreateRequest,
  CreateResponse
} from '../../shared';

// Policy Management APIs
export interface CreateCostGovernancePolicyRequest extends CreateRequest<CostGovernancePolicyData> {
  flowId: string;
  data: CostGovernancePolicyData;
  policyType: 'budget' | 'spending' | 'resource' | 'approval' | 'tagging';
  scope: GovernanceScope;
  rules: GovernanceRule[];
  enforcement: PolicyEnforcement;
  exceptions: PolicyException[];
}

export interface CreateCostGovernancePolicyResponse extends CreateResponse<CostGovernancePolicy> {
  data: CostGovernancePolicy;
  policyId: string;
  enforcementPlan: EnforcementPlan;
  complianceChecks: ComplianceCheck[];
  auditTrail: AuditTrail;
}

// Core Policy Types
export interface CostGovernancePolicyData {
  id: string;
  flowId: string;
  name: string;
  description: string;
  policyType: string;
  version: string;
  scope: GovernanceScope;
  rules: GovernanceRule[];
  enforcement: PolicyEnforcement;
  exceptions: PolicyException[];
  stakeholders: PolicyStakeholder[];
  effectiveDate: string;
  expirationDate?: string;
  tags: Record<string, string>;
  metadata: AuditableMetadata;
}

export interface CostGovernancePolicy {
  id: string;
  flowId: string;
  name: string;
  description: string;
  policyType: string;
  version: string;
  scope: GovernanceScope;
  rules: GovernanceRule[];
  enforcement: PolicyEnforcement;
  exceptions: PolicyException[];
  stakeholders: PolicyStakeholder[];
  effectiveDate: string;
  expirationDate?: string;
  tags: Record<string, string>;
  metadata: AuditableMetadata;
  policyId: string;
  status: 'draft' | 'active' | 'inactive' | 'deprecated' | 'expired';
  approvals: PolicyApproval[];
  compliance: PolicyCompliance;
  enforcementStatus: PolicyEnforcementStatus;
  auditTrail: AuditTrail;
  createdAt: string;
  updatedAt: string;
  createdBy: string;
  lastModifiedBy: string;
}

export interface GovernanceScope {
  organizationLevel: 'global' | 'division' | 'department' | 'project' | 'team';
  accounts: string[];
  services: string[];
  resources: string[];
  regions: string[];
  environments: string[];
  costCenters: string[];
  projects: string[];
  users: string[];
  roles: string[];
  tags: Record<string, string>;
  exclusions: ScopeExclusion[];
}

export interface ScopeExclusion {
  type: 'account' | 'service' | 'resource' | 'region' | 'tag';
  values: string[];
  reason: string;
  temporary: boolean;
  expirationDate?: string;
}

export interface GovernanceRule {
  id: string;
  name: string;
  description: string;
  type: 'budget_limit' | 'spending_threshold' | 'resource_quota' | 'approval_required' | 'tagging_required';
  condition: RuleCondition;
  action: RuleAction;
  priority: number;
  enabled: boolean;
  exceptions: RuleException[];
  metadata: BaseMetadata;
}

export interface RuleCondition {
  operator: 'equals' | 'not_equals' | 'greater_than' | 'less_than' | 'contains' | 'not_contains' | 'in' | 'not_in';
  field: string;
  value: ConfigurationValue;
  threshold?: number;
  timeWindow?: string;
  aggregation?: 'sum' | 'avg' | 'max' | 'min' | 'count';
}

export interface RuleAction {
  type: 'alert' | 'block' | 'approve' | 'tag' | 'escalate' | 'audit';
  parameters: BaseMetadata;
  automatic: boolean;
  notifications: ActionNotification[];
  escalation?: EscalationRule;
}

export interface ActionNotification {
  method: 'email' | 'slack' | 'webhook' | 'dashboard' | 'sms';
  recipients: string[];
  template: string;
  frequency: 'immediate' | 'daily' | 'weekly' | 'monthly';
  severity: 'info' | 'warning' | 'error' | 'critical';
}

export interface EscalationRule {
  levels: EscalationLevel[];
  timeout: string;
  finalAction: string;
}

export interface EscalationLevel {
  level: number;
  escalateTo: string[];
  timeout: string;
  actions: string[];
}

export interface RuleException {
  id: string;
  type: 'permanent' | 'temporary' | 'conditional';
  scope: ExceptionScope;
  reason: string;
  approvedBy: string;
  approvedAt: string;
  expirationDate?: string;
  conditions?: string[];
}

export interface ExceptionScope {
  accounts?: string[];
  services?: string[];
  resources?: string[];
  users?: string[];
  projects?: string[];
  tags?: Record<string, string>;
}

export interface PolicyException {
  id: string;
  type: 'account' | 'service' | 'resource' | 'user' | 'project' | 'temporary';
  scope: ExceptionScope;
  reason: string;
  justification: string;
  approver: string;
  approvedAt: string;
  effectiveDate: string;
  expirationDate?: string;
  conditions: ExceptionCondition[];
  monitoring: ExceptionMonitoring;
}

export interface ExceptionCondition {
  type: 'time_based' | 'value_based' | 'event_based' | 'approval_based';
  condition: string;
  value?: ConfigurationValue;
  monitoring: boolean;
}

export interface ExceptionMonitoring {
  enabled: boolean;
  metrics: string[];
  thresholds: BaseMetadata;
  reporting: string[];
}

export interface PolicyStakeholder {
  userId: string;
  role: 'owner' | 'approver' | 'reviewer' | 'enforcer' | 'auditor';
  responsibilities: string[];
  notifications: boolean;
}

export interface PolicyApproval {
  id: string;
  type: 'creation' | 'modification' | 'activation' | 'deactivation';
  status: 'pending' | 'approved' | 'rejected' | 'expired';
  approver: string;
  requestedAt: string;
  approvedAt?: string;
  rejectedAt?: string;
  reason?: string;
  conditions?: string[];
}

export interface PolicyCompliance {
  overallScore: number;
  lastAssessment: string;
  violations: ComplianceViolation[];
  trends: ComplianceTrend[];
  metrics: ComplianceMetric[];
  status: 'compliant' | 'non_compliant' | 'partially_compliant' | 'unknown';
}

export interface ComplianceViolation {
  id: string;
  ruleId: string;
  severity: 'low' | 'medium' | 'high' | 'critical';
  description: string;
  detectedAt: string;
  status: 'open' | 'investigating' | 'resolved' | 'accepted';
  impact: ViolationImpact;
  remediation: ViolationRemediation;
}

export interface ViolationImpact {
  financial: number;
  operational: string;
  security: string;
  compliance: string;
}

export interface ViolationRemediation {
  required: boolean;
  automated: boolean;
  steps: string[];
  timeline: string;
  cost: number;
}

export interface ComplianceTrend {
  metric: string;
  direction: 'improving' | 'degrading' | 'stable';
  rate: number;
  timeframe: string;
  significance: 'low' | 'medium' | 'high';
}

export interface ComplianceMetric {
  name: string;
  value: number;
  target: number;
  unit: string;
  trend: 'improving' | 'degrading' | 'stable';
  lastUpdated: string;
}

export interface PolicyEnforcementStatus {
  enabled: boolean;
  mode: string;
  lastEnforcement: string;
  statistics: EnforcementStatistics;
  issues: EnforcementIssue[];
}

export interface EnforcementStatistics {
  totalActions: number;
  successfulActions: number;
  failedActions: number;
  violationsDetected: number;
  violationsResolved: number;
  averageResolutionTime: string;
}

export interface EnforcementIssue {
  id: string;
  type: 'configuration' | 'technical' | 'approval' | 'exception';
  description: string;
  severity: 'low' | 'medium' | 'high' | 'critical';
  status: 'open' | 'investigating' | 'resolved';
  createdAt: string;
  resolvedAt?: string;
}

// Forward declarations for types defined in other modules
export interface PolicyEnforcement {
  mode: 'monitoring' | 'advisory' | 'preventive' | 'corrective';
  strictness: 'lenient' | 'moderate' | 'strict' | 'rigid';
  automation: PolicyAutomation;
  notifications: PolicyNotification[];
  escalation: PolicyEscalation;
  exceptions: PolicyEnforcementException[];
}

export interface PolicyAutomation {
  enabled: boolean;
  triggers: string[];
  actions: string[];
  conditions: string[];
}

export interface PolicyNotification {
  type: string;
  recipients: string[];
  frequency: string;
  template: string;
}

export interface PolicyEscalation {
  enabled: boolean;
  levels: string[];
  timeouts: string[];
}

export interface PolicyEnforcementException {
  id: string;
  type: string;
  scope: string[];
  reason: string;
}

export interface EnforcementPlan {
  strategy: unknown;
  phases: unknown[];
  automation: unknown;
  monitoring: unknown;
  escalation: unknown;
}

export interface ComplianceCheck {
  id: string;
  name: string;
  type: 'automated' | 'manual' | 'hybrid';
  frequency: string;
  scope: string[];
  criteria: unknown[];
  remediation: unknown;
}

export interface AuditTrail {
  entries: unknown[];
  retention: string;
  compliance: unknown;
}