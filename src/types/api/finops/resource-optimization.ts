/**
 * FinOps Resource Optimization Types
 * 
 * Type definitions for resource utilization analysis, allocation optimization, and rightsizing.
 * Covers resource performance monitoring, utilization tracking, and optimization recommendations.
 * 
 * Generated by CC (Claude Code) - Modularized from finops.ts
 */

import {
  BaseApiRequest,
  BaseApiResponse,
  MultiTenantContext
} from '../shared';
import { CostAmount } from './cost-analysis';

// Resource Optimization APIs
export interface AnalyzeResourceUtilizationRequest extends BaseApiRequest {
  flowId: string;
  resourceTypes: ResourceType[];
  timeRange: {
    start: string;
    end: string;
  };
  metrics: UtilizationMetric[];
  thresholds: UtilizationThreshold[];
  includeRecommendations?: boolean;
  context: MultiTenantContext;
}

export interface AnalyzeResourceUtilizationResponse extends BaseApiResponse<ResourceUtilizationAnalysis> {
  data: ResourceUtilizationAnalysis;
  analysisId: string;
  utilizationSummary: UtilizationSummary;
  underutilizedResources: UnderutilizedResource[];
  overutilizedResources: OverutilizedResource[];
  recommendations: ResourceRecommendation[];
}

export interface OptimizeResourceAllocationRequest extends BaseApiRequest {
  analysisId: string;
  optimizationStrategy: ResourceOptimizationStrategy;
  constraints: ResourceConstraint[];
  objectives: ResourceObjective[];
  simulateOnly?: boolean;
  context: MultiTenantContext;
}

export interface OptimizeResourceAllocationResponse extends BaseApiResponse<ResourceOptimization> {
  data: ResourceOptimization;
  optimizationId: string;
  currentAllocation: ResourceAllocation;
  optimizedAllocation: ResourceAllocation;
  projectedSavings: CostAmount;
  implementationPlan: ResourceImplementationPlan;
}

export interface RightsizeResourcesRequest extends BaseApiRequest {
  flowId: string;
  resourceIds: string[];
  rightsizingStrategy: RightsizingStrategy;
  performanceRequirements: PerformanceRequirement[];
  costThresholds: CostThreshold[];
  dryRun?: boolean;
  context: MultiTenantContext;
}

export interface RightsizeResourcesResponse extends BaseApiResponse<RightsizingResult> {
  data: RightsizingResult;
  rightsizingId: string;
  recommendations: RightsizingRecommendation[];
  projectedSavings: CostAmount;
  performanceImpact: RightsizingPerformanceImpact;
  implementationPlan: RightsizingImplementationPlan;
}

// Supporting Data Types
export interface ResourceType {
  type: 'compute' | 'storage' | 'network' | 'database' | 'container' | 'serverless';
  subType?: string;
  provider: string;
  region?: string;
  family?: string;
}

export interface UtilizationMetric {
  name: string;
  type: 'cpu' | 'memory' | 'disk' | 'network' | 'iops' | 'bandwidth' | 'custom';
  aggregation: 'avg' | 'max' | 'min' | 'p95' | 'p99';
  unit: string;
  target?: number;
}

export interface UtilizationThreshold {
  metric: string;
  underutilized: number;
  overutilized: number;
  optimal: {
    min: number;
    max: number;
  };
  critical?: number;
}

export interface ResourceUtilizationAnalysis {
  id: string;
  flowId: string;
  analysisType: 'current' | 'historical' | 'trending';
  timeRange: {
    start: string;
    end: string;
  };
  scope: ResourceAnalysisScope;
  summary: UtilizationSummary;
  resourceAnalysis: ResourceAnalysisDetail[];
  recommendations: ResourceRecommendation[];
  trends: UtilizationTrend[];
  anomalies: UtilizationAnomaly[];
  generatedAt: string;
}

export interface ResourceAnalysisScope {
  resourceTypes: ResourceType[];
  accounts: string[];
  regions: string[];
  projects: string[];
  environments: string[];
  tags: Record<string, string>;
}

export interface UtilizationSummary {
  totalResources: number;
  underutilizedCount: number;
  overutilizedCount: number;
  optimalCount: number;
  averageUtilization: Record<string, number>;
  totalCost: CostAmount;
  potentialSavings: CostAmount;
  efficiency: ResourceEfficiency;
}

export interface ResourceEfficiency {
  overall: number;
  byType: Record<string, number>;
  byRegion: Record<string, number>;
  byProject: Record<string, number>;
  trend: 'improving' | 'degrading' | 'stable';
}

export interface ResourceAnalysisDetail {
  resourceId: string;
  resourceType: ResourceType;
  name: string;
  cost: CostAmount;
  utilization: ResourceUtilization;
  performance: ResourcePerformance;
  recommendations: ResourceSpecificRecommendation[];
  tags: Record<string, string>;
}

export interface ResourceUtilization {
  metrics: UtilizationMetricValue[];
  overallScore: number;
  category: 'underutilized' | 'optimal' | 'overutilized' | 'unknown';
  patterns: UtilizationPattern[];
  peaks: UtilizationPeak[];
}

export interface UtilizationMetricValue {
  metric: string;
  current: number;
  average: number;
  peak: number;
  minimum: number;
  trend: 'increasing' | 'decreasing' | 'stable';
  threshold: UtilizationThreshold;
}

export interface UtilizationPattern {
  type: 'daily' | 'weekly' | 'monthly' | 'seasonal' | 'irregular';
  description: string;
  confidence: number;
  predictability: number;
}

export interface UtilizationPeak {
  timestamp: string;
  duration: string;
  metrics: Record<string, number>;
  trigger: string;
  frequency: 'rare' | 'occasional' | 'regular' | 'constant';
}

export interface ResourcePerformance {
  latency: PerformanceMetric;
  throughput: PerformanceMetric;
  availability: PerformanceMetric;
  errorRate: PerformanceMetric;
  customMetrics: PerformanceMetric[];
  slaCompliance: SLACompliance;
}

export interface PerformanceMetric {
  name: string;
  current: number;
  baseline: number;
  target: number;
  unit: string;
  trend: 'improving' | 'degrading' | 'stable';
  status: 'meeting' | 'below' | 'above' | 'unknown';
}

export interface SLACompliance {
  overall: number;
  metrics: SLAMetricCompliance[];
  violations: SLAViolation[];
  riskLevel: 'low' | 'medium' | 'high';
}

export interface SLAMetricCompliance {
  metric: string;
  target: number;
  actual: number;
  compliance: number;
  status: 'compliant' | 'at_risk' | 'violated';
}

export interface SLAViolation {
  metric: string;
  timestamp: string;
  duration: string;
  severity: 'minor' | 'major' | 'critical';
  impact: string;
}

export interface UnderutilizedResource {
  resourceId: string;
  name: string;
  type: ResourceType;
  cost: CostAmount;
  utilizationScore: number;
  wastedCapacity: Record<string, number>;
  potentialSavings: CostAmount;
  rightsizingOptions: RightsizingOption[];
  shutdownCandidate: boolean;
}

export interface OverutilizedResource {
  resourceId: string;
  name: string;
  type: ResourceType;
  cost: CostAmount;
  utilizationScore: number;
  constrainedMetrics: string[];
  performanceImpact: string;
  scalingOptions: ScalingOption[];
  urgency: 'low' | 'medium' | 'high' | 'critical';
}

export interface RightsizingOption {
  targetSize: string;
  estimatedSavings: CostAmount;
  performanceImpact: string;
  risk: 'low' | 'medium' | 'high';
  effort: 'low' | 'medium' | 'high';
}

export interface ScalingOption {
  type: 'vertical' | 'horizontal';
  recommendation: string;
  estimatedCost: CostAmount;
  performanceGain: string;
  complexity: 'low' | 'medium' | 'high';
}

export interface ResourceRecommendation {
  id: string;
  resourceId: string;
  type: 'rightsize' | 'shutdown' | 'upgrade' | 'migrate' | 'optimize';
  priority: 'low' | 'medium' | 'high' | 'critical';
  title: string;
  description: string;
  currentConfiguration: ResourceConfiguration;
  recommendedConfiguration: ResourceConfiguration;
  estimatedSavings: CostAmount;
  performanceImpact: string;
  implementationComplexity: 'low' | 'medium' | 'high';
  risk: 'low' | 'medium' | 'high';
  timeline: string;
  prerequisites: string[];
  validationSteps: string[];
}

export interface ResourceSpecificRecommendation extends ResourceRecommendation {
  confidence: number;
  basedOnPeriod: string;
  assumptions: string[];
  alternatives: AlternativeRecommendation[];
}

export interface AlternativeRecommendation {
  description: string;
  savings: CostAmount;
  risk: 'low' | 'medium' | 'high';
  effort: 'low' | 'medium' | 'high';
}

export interface ResourceConfiguration {
  instanceType?: string;
  size?: string;
  cpu?: number;
  memory?: number;
  storage?: StorageConfiguration[];
  network?: NetworkConfiguration;
  tags: Record<string, string>;
  customProperties: Record<string, any>;
}

export interface StorageConfiguration {
  type: string;
  size: number;
  iops?: number;
  throughput?: number;
  encryption?: boolean;
}

export interface NetworkConfiguration {
  bandwidth: number;
  type: string;
  redundancy: boolean;
  encryption?: boolean;
}

export interface UtilizationTrend {
  resourceId: string;
  metric: string;
  direction: 'increasing' | 'decreasing' | 'stable' | 'cyclical';
  rate: number;
  confidence: number;
  timeframe: string;
  projectedImpact: string;
}

export interface UtilizationAnomaly {
  resourceId: string;
  metric: string;
  timestamp: string;
  type: 'spike' | 'drop' | 'pattern_change' | 'outlier';
  severity: 'low' | 'medium' | 'high';
  deviation: number;
  possibleCauses: string[];
  impact: string;
}

export interface ResourceOptimizationStrategy {
  objective: 'cost' | 'performance' | 'balanced' | 'sustainability';
  approach: 'conservative' | 'moderate' | 'aggressive';
  constraints: OptimizationConstraint[];
  priorities: OptimizationPriority[];
  timeframe: string;
}

export interface OptimizationConstraint {
  type: 'budget' | 'performance' | 'availability' | 'compliance';
  value: any;
  mandatory: boolean;
  description: string;
}

export interface OptimizationPriority {
  dimension: string;
  weight: number;
  direction: 'minimize' | 'maximize';
}

export interface ResourceConstraint {
  type: 'capacity' | 'performance' | 'location' | 'compliance' | 'budget';
  description: string;
  value: any;
  flexibility: 'none' | 'low' | 'medium' | 'high';
}

export interface ResourceObjective {
  type: 'cost_reduction' | 'performance_improvement' | 'capacity_optimization';
  target: number;
  unit: string;
  timeframe: string;
  priority: number;
}

export interface ResourceOptimization {
  id: string;
  strategy: ResourceOptimizationStrategy;
  currentState: ResourceState;
  optimizedState: ResourceState;
  changes: ResourceChange[];
  impact: OptimizationImpact;
  implementation: ResourceImplementationPlan;
  validation: OptimizationValidation;
}

export interface ResourceState {
  resources: ResourceStateDetail[];
  totalCost: CostAmount;
  totalCapacity: Record<string, number>;
  utilization: Record<string, number>;
  performance: Record<string, number>;
}

export interface ResourceStateDetail {
  resourceId: string;
  configuration: ResourceConfiguration;
  cost: CostAmount;
  utilization: Record<string, number>;
  performance: Record<string, number>;
}

export interface ResourceChange {
  resourceId: string;
  type: 'resize' | 'terminate' | 'migrate' | 'reconfigure';
  from: ResourceConfiguration;
  to: ResourceConfiguration;
  impact: ChangeImpact;
  complexity: 'low' | 'medium' | 'high';
  risk: 'low' | 'medium' | 'high';
}

export interface ChangeImpact {
  cost: CostAmount;
  performance: Record<string, number>;
  availability: string;
  dependencies: string[];
}

export interface OptimizationImpact {
  costSavings: CostAmount;
  performanceChange: Record<string, number>;
  capacityChange: Record<string, number>;
  utilizationImprovement: Record<string, number>;
  riskAssessment: RiskAssessment;
}

export interface RiskAssessment {
  overallRisk: 'low' | 'medium' | 'high';
  risks: Risk[];
  mitigations: Mitigation[];
}

export interface Risk {
  type: 'performance' | 'availability' | 'cost' | 'operational';
  description: string;
  likelihood: 'low' | 'medium' | 'high';
  impact: 'low' | 'medium' | 'high';
}

export interface Mitigation {
  risk: string;
  strategy: string;
  cost: CostAmount;
  effectiveness: number;
}

export interface ResourceAllocation {
  resources: AllocationDetail[];
  totalCost: CostAmount;
  efficiency: number;
  utilization: Record<string, number>;
  constraints: ConstraintStatus[];
}

export interface AllocationDetail {
  resourceId: string;
  allocation: ResourceConfiguration;
  cost: CostAmount;
  utilization: Record<string, number>;
  efficiency: number;
}

export interface ConstraintStatus {
  constraint: string;
  status: 'satisfied' | 'violated' | 'at_risk';
  value: any;
  limit: any;
}

export interface ResourceImplementationPlan {
  phases: ImplementationPhase[];
  timeline: string;
  dependencies: Dependency[];
  validationChecks: ValidationCheck[];
  rollbackPlan: RollbackPlan;
}

export interface ImplementationPhase {
  id: string;
  name: string;
  description: string;
  tasks: ImplementationTask[];
  duration: string;
  prerequisites: string[];
  deliverables: string[];
}

export interface ImplementationTask {
  id: string;
  name: string;
  type: 'automated' | 'manual' | 'approval';
  description: string;
  assignee: string;
  duration: string;
  dependencies: string[];
  validation: string[];
}

export interface Dependency {
  id: string;
  type: 'resource' | 'approval' | 'external';
  description: string;
  status: 'pending' | 'available' | 'blocked';
}

export interface ValidationCheck {
  id: string;
  name: string;
  type: 'pre' | 'post' | 'continuous';
  criteria: string[];
  automated: boolean;
  frequency?: string;
}

export interface RollbackPlan {
  triggers: string[];
  procedures: RollbackProcedure[];
  timeline: string;
  dataBackup: string[];
}

export interface RollbackProcedure {
  step: number;
  description: string;
  automated: boolean;
  validation: string;
}

export interface RightsizingStrategy {
  approach: 'conservative' | 'moderate' | 'aggressive';
  criteria: RightsizingCriteria;
  constraints: RightsizingConstraint[];
  optimization: RightsizingOptimization;
}

export interface RightsizingCriteria {
  utilizationThreshold: number;
  observationPeriod: string;
  performanceBuffer: number;
  costThreshold: number;
  excludeRecent: boolean;
}

export interface RightsizingConstraint {
  type: 'minimum_size' | 'family_restriction' | 'feature_requirement';
  value: any;
  description: string;
}

export interface RightsizingOptimization {
  objective: 'cost' | 'performance' | 'balanced';
  aggressiveness: number;
  includeFamily: boolean;
  includeGeneration: boolean;
}

export interface PerformanceRequirement {
  metric: string;
  minimum: number;
  target: number;
  unit: string;
  critical: boolean;
}

export interface CostThreshold {
  type: 'absolute' | 'percentage';
  value: number;
  description: string;
  enforcement: 'hard' | 'soft';
}

export interface RightsizingResult {
  id: string;
  strategy: RightsizingStrategy;
  analysis: RightsizingAnalysis;
  recommendations: RightsizingRecommendation[];
  summary: RightsizingSummary;
  validation: RightsizingValidation;
}

export interface RightsizingAnalysis {
  resourcesAnalyzed: number;
  candidatesIdentified: number;
  utilizationPatterns: UtilizationPattern[];
  performanceBaseline: Record<string, number>;
  costBaseline: CostAmount;
}

export interface RightsizingRecommendation {
  resourceId: string;
  currentSize: string;
  recommendedSize: string;
  confidence: number;
  savings: CostAmount;
  performanceImpact: RightsizingPerformanceImpact;
  implementation: RightsizingImplementation;
  risk: 'low' | 'medium' | 'high';
}

export interface RightsizingPerformanceImpact {
  metrics: Record<string, number>;
  slaRisk: boolean;
  degradationRisk: 'none' | 'minimal' | 'moderate' | 'significant';
  mitigations: string[];
}

export interface RightsizingImplementation {
  method: 'resize' | 'replace' | 'migrate';
  downtime: string;
  complexity: 'low' | 'medium' | 'high';
  prerequisites: string[];
  steps: string[];
  validation: string[];
}

export interface RightsizingSummary {
  totalSavings: CostAmount;
  savingsPercentage: number;
  resourcesOptimized: number;
  averageReduction: number;
  riskDistribution: Record<string, number>;
}

export interface RightsizingValidation {
  preChecks: ValidationResult[];
  postChecks: ValidationResult[];
  performanceValidation: PerformanceValidationResult;
  costValidation: CostValidationResult;
}

export interface ValidationResult {
  check: string;
  status: 'passed' | 'failed' | 'warning';
  details: string;
  timestamp: string;
}

export interface PerformanceValidationResult {
  baselineComparison: Record<string, number>;
  slaCompliance: boolean;
  degradationDetected: boolean;
  issues: string[];
}

export interface CostValidationResult {
  expectedSavings: CostAmount;
  actualSavings: CostAmount;
  variance: number;
  realizationRate: number;
}

export interface RightsizingImplementationPlan {
  phases: RightsizingPhase[];
  timeline: string;
  rollback: RightsizingRollback;
  monitoring: RightsizingMonitoring;
}

export interface RightsizingPhase {
  id: string;
  name: string;
  resources: string[];
  order: 'sequential' | 'parallel';
  duration: string;
  validation: string[];
}

export interface RightsizingRollback {
  enabled: boolean;
  triggers: string[];
  procedures: string[];
  timeLimit: string;
}

export interface RightsizingMonitoring {
  metrics: string[];
  duration: string;
  alerts: string[];
  reporting: string;
}

export interface OptimizationValidation {
  status: 'passed' | 'failed' | 'partial';
  checks: ValidationResult[];
  score: number;
  issues: string[];
}