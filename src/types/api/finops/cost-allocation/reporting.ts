/**
 * Reporting and Analytics Types
 * 
 * Types for chargeback reporting, analytics, distribution, and chargeback data structures.
 * Covers reports, summaries, trends, utilization analytics, and payment details.
 * 
 * Generated by CC (Claude Code) - Modularized from cost-allocation.ts
 */

import { CostAmount } from '../cost-analysis';
import { BaseApiRequest, BaseApiResponse, MultiTenantContext } from '../../shared';

// Report Request/Response Types
export interface GetChargebackReportRequest extends BaseApiRequest {
  flowId: string;
  period: {
    start: string;
    end: string;
  };
  recipients?: string[];
  costCategories?: string[];
  includeDetails?: boolean;
  format?: 'summary' | 'detailed' | 'itemized';
  context: MultiTenantContext;
}

export interface GetChargebackReportResponse extends BaseApiResponse<ChargebackReport> {
  data: ChargebackReport;
  reportId: string;
  chargebacks: ChargebackDetail[];
  summary: ChargebackSummary;
  approvals: ChargebackApproval[];
}

// Allocation Reporting Configuration
export interface AllocationReporting {
  reports: AllocationReport[];
  dashboards: string[];
  exports: ReportExport[];
  distribution: ReportDistribution;
}

export interface AllocationReport {
  type: 'summary' | 'detailed' | 'variance' | 'audit';
  frequency: string;
  recipients: string[];
  format: string;
  customizations: Record<string, string | number | boolean | null>;
}

export interface ReportExport {
  format: 'csv' | 'excel' | 'pdf' | 'json' | 'xml';
  schedule: string;
  destination: string;
  encryption: boolean;
}

export interface ReportDistribution {
  internal: DistributionConfig;
  external: DistributionConfig;
  compliance: DistributionConfig;
}

export interface DistributionConfig {
  enabled: boolean;
  recipients: string[];
  schedule: string;
  security: string;
}

// Chargeback Report Types
export interface ChargebackReport {
  id: string;
  flowId: string;
  period: string;
  type: 'summary' | 'detailed' | 'itemized' | 'variance';
  scope: ChargebackReportScope;
  summary: ChargebackSummary;
  details: ChargebackDetail[];
  analytics: ChargebackAnalytics;
  generatedAt: string;
}

export interface ChargebackReportScope {
  targets: string[];
  services: string[];
  cost_categories: string[];
  period: string;
  currency: string;
}

export interface ChargebackSummary {
  totalAmount: CostAmount;
  totalTargets: number;
  totalItems: number;
  averageChargeback: CostAmount;
  topChargebacks: TopChargeback[];
  trends: ChargebackTrend[];
}

export interface TopChargeback {
  target: string;
  amount: CostAmount;
  percentage: number;
  items: number;
}

export interface ChargebackTrend {
  metric: string;
  direction: 'increasing' | 'decreasing' | 'stable';
  rate: number;
  significance: 'low' | 'medium' | 'high';
}

// Chargeback Details and Items
export interface ChargebackDetail {
  target: ChargebackTarget;
  totalAmount: CostAmount;
  items: ChargebackItem[];
  adjustments: ChargebackItemAdjustment[];
  payment: PaymentDetail;
  dispute?: DisputeDetail;
}

export interface ChargebackTarget {
  type: 'cost_center' | 'project' | 'department' | 'external';
  identifier: string;
  name: string;
  contact: string;
  billing_address: BillingAddress;
}

export interface BillingAddress {
  name: string;
  address: string[];
  city: string;
  state: string;
  country: string;
  postal_code: string;
}

export interface ChargebackItem {
  id: string;
  service: string;
  description: string;
  quantity: number;
  unit: string;
  rate: number;
  amount: CostAmount;
  period: string;
  tags: Record<string, string>;
}

export interface ChargebackItemAdjustment {
  type: 'discount' | 'credit' | 'tax' | 'fee';
  description: string;
  amount: CostAmount;
  rate?: number;
  basis?: string;
}

export interface PaymentDetail {
  status: string;
  method: string;
  dueDate: string;
  paidDate?: string;
  amount: CostAmount;
  fees: CostAmount;
}

export interface DisputeDetail {
  id: string;
  reason: string;
  amount: CostAmount;
  status: string;
  submittedAt: string;
  resolvedAt?: string;
  resolution: string;
}

// Analytics Types
export interface ChargebackAnalytics {
  utilization: UtilizationAnalytics;
  trends: TrendAnalytics;
  efficiency: EfficiencyAnalytics;
  satisfaction: SatisfactionAnalytics;
}

export interface UtilizationAnalytics {
  byService: ServiceUtilization[];
  byTarget: TargetUtilization[];
  patterns: UsagePattern[];
}

export interface ServiceUtilization {
  service: string;
  usage: number;
  cost: CostAmount;
  efficiency: number;
  trend: string;
}

export interface TargetUtilization {
  target: string;
  usage: number;
  cost: CostAmount;
  budget: CostAmount;
  variance: number;
}

export interface UsagePattern {
  type: 'seasonal' | 'growth' | 'cyclical' | 'irregular';
  description: string;
  confidence: number;
  impact: string;
}

export interface TrendAnalytics {
  cost: CostTrendAnalytics;
  usage: UsageTrendAnalytics;
  efficiency: EfficiencyTrendAnalytics;
}

export interface CostTrendAnalytics {
  direction: string;
  rate: number;
  forecast: CostAmount;
  drivers: string[];
}

export interface UsageTrendAnalytics {
  direction: string;
  rate: number;
  forecast: number;
  patterns: string[];
}

export interface EfficiencyTrendAnalytics {
  direction: string;
  rate: number;
  benchmark: number;
  opportunities: string[];
}

export interface EfficiencyAnalytics {
  overall: number;
  byService: Record<string, number>;
  byTarget: Record<string, number>;
  benchmarks: Record<string, number>;
}

export interface SatisfactionAnalytics {
  overall: number;
  byTarget: Record<string, number>;
  feedback: FeedbackSummary[];
  improvements: string[];
}

export interface FeedbackSummary {
  category: string;
  rating: number;
  comments: string[];
  trends: string;
}

// Chargeback and Status Types
export interface Chargeback {
  id: string;
  target: ChargebackTarget;
  period: string;
  amount: CostAmount;
  items: ChargebackItem[];
  adjustments: ChargebackItemAdjustment[];
  billing: ChargebackBilling;
  status: ChargebackStatus;
}

export interface ChargebackBilling {
  cycle: 'monthly' | 'quarterly' | 'annually';
  timing: 'advance' | 'arrears';
  aggregation: BillingAggregation;
  format: BillingFormat;
  delivery: BillingDelivery;
  payment: BillingPayment;
}

export interface BillingAggregation {
  level: 'account' | 'project' | 'department' | 'cost_center';
  rollup: boolean;
  consolidation: string[];
  splitting: SplittingRule[];
}

export interface SplittingRule {
  condition: string;
  method: 'proportional' | 'equal' | 'weighted';
  targets: string[];
}

export interface BillingFormat {
  template: string;
  currency: string;
  precision: number;
  language: string;
  customizations: Record<string, string | number | boolean | null>;
}

export interface BillingDelivery {
  method: 'email' | 'portal' | 'api' | 'file_transfer';
  recipients: BillingRecipient[];
  schedule: BillingSchedule;
  notifications: BillingNotification[];
}

export interface BillingRecipient {
  type: 'primary' | 'cc' | 'approver' | 'finance';
  contact: string;
  format: string;
  customizations: Record<string, string | number | boolean | null>;
}

export interface BillingSchedule {
  day: number;
  time: string;
  timezone: string;
  advance_notice: number;
  retry_policy: RetryPolicy;
}

export interface RetryPolicy {
  attempts: number;
  interval: string;
  escalation: string[];
}

export interface BillingNotification {
  event: 'generated' | 'sent' | 'viewed' | 'paid' | 'overdue';
  recipients: string[];
  template: string;
  delay: string;
}

export interface BillingPayment {
  terms: string;
  methods: string[];
  automation: boolean;
  tracking: boolean;
  reconciliation: PaymentReconciliation;
}

export interface PaymentReconciliation {
  automated: boolean;
  tolerance: number;
  frequency: string;
  escalation: string[];
}

export interface ChargebackStatus {
  billing: 'draft' | 'generated' | 'sent' | 'disputed' | 'paid' | 'overdue';
  approval: 'pending' | 'approved' | 'rejected' | 'conditional';
  payment: 'pending' | 'processing' | 'paid' | 'failed' | 'disputed';
  collection: 'current' | 'overdue' | 'collections' | 'written_off';
}

export interface ChargebackApproval {
  id: string;
  chargebackId: string;
  type: 'amount' | 'allocation' | 'adjustment' | 'dispute';
  status: 'pending' | 'approved' | 'rejected' | 'conditional';
  approver: string;
  requestedAt: string;
  approvedAt?: string;
  rejectedAt?: string;
  amount?: CostAmount;
  conditions: string[];
  justification: string;
}