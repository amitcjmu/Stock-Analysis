/**
 * Execution and Validation Types
 *
 * Types for allocation execution, validation, performance tracking, and results processing.
 * Covers execution summaries, validation checks, performance metrics, and allocation results.
 *
 * Generated by CC (Claude Code) - Modularized from cost-allocation.ts
 */

import type { CostAmount } from '../cost-analysis';

// Validation Types
export interface AllocationValidation {
  checks: AllocationValidationCheck[];
  tolerance: number;
  reconciliation: boolean;
  certification: ValidationCertification;
}

export interface AllocationValidationCheck {
  name: string;
  type: 'mathematical' | 'business' | 'compliance' | 'technical';
  enabled: boolean;
  tolerance: number;
  action: 'warning' | 'error' | 'block';
}

export interface ValidationCertification {
  required: boolean;
  certifier: string;
  frequency: string;
  documentation: string[];
}

export interface AllocationValidationResult {
  check: string;
  status: 'passed' | 'failed' | 'warning';
  result: ValidationResult;
  details: string;
  recommendation: string;
}

export interface ValidationResult {
  expected: number;
  actual: number;
  variance: number;
  tolerance: number;
  significance: 'low' | 'medium' | 'high';
}

// Execution Types
export interface AllocationExecutionSummary {
  executionId: string;
  period: string;
  status: 'success' | 'failure' | 'partial';
  duration: string;
  recordsProcessed: number;
  totalAllocated: CostAmount;
  issues: ExecutionIssue[];
}

export interface ExecutionIssue {
  type: 'validation' | 'data' | 'calculation' | 'system';
  severity: 'low' | 'medium' | 'high' | 'critical';
  description: string;
  resolution: string;
}

export interface CostAllocationExecution {
  id: string;
  allocationId: string;
  period: string;
  status: 'running' | 'completed' | 'failed' | 'cancelled';
  startedAt: string;
  completedAt?: string;
  summary: ExecutionSummary;
  results: ExecutionResult[];
  issues: ExecutionIssue[];
  validation: ExecutionValidation;
}

export interface ExecutionSummary {
  totalAmount: CostAmount;
  allocatedAmount: CostAmount;
  unallocatedAmount: CostAmount;
  targetsProcessed: number;
  rulesApplied: number;
  exceptions: number;
}

export interface ExecutionResult {
  ruleId: string;
  source: string;
  targets: AllocationResultTarget[];
  totalAllocated: CostAmount;
  variance: number;
  issues: string[];
}

export interface AllocationResultTarget {
  targetId: string;
  name: string;
  allocatedAmount: CostAmount;
  percentage: number;
  basis: string;
  calculation: string;
}

export interface ExecutionValidation {
  overall: 'passed' | 'failed' | 'warning';
  checks: ExecutionValidationCheck[];
  reconciliation: ReconciliationResult;
  certification: CertificationResult;
}

export interface ExecutionValidationCheck {
  name: string;
  status: 'passed' | 'failed' | 'warning';
  expected: number;
  actual: number;
  variance: number;
  acceptable: boolean;
}

export interface ReconciliationResult {
  status: 'balanced' | 'unbalanced' | 'under_tolerance';
  variance: CostAmount;
  tolerance: number;
  adjustments: ReconciliationAdjustment[];
}

export interface ReconciliationAdjustment {
  type: 'rounding' | 'residual' | 'correction';
  amount: CostAmount;
  target: string;
  reason: string;
}

export interface CertificationResult {
  required: boolean;
  status: 'certified' | 'pending' | 'rejected';
  certifier: string;
  certifiedAt?: string;
  conditions: string[];
}

// Performance Tracking
export interface AllocationPerformance {
  executionTime: PerformanceMetric;
  dataQuality: QualityMetric;
  accuracy: AccuracyMetric;
  efficiency: EfficiencyMetric;
}

export interface PerformanceMetric {
  average: number;
  trend: 'improving' | 'stable' | 'degrading';
  target: number;
  unit: string;
}

export interface QualityMetric {
  completeness: number;
  accuracy: number;
  consistency: number;
  timeliness: number;
}

export interface AccuracyMetric {
  reconciliation: number;
  variance: number;
  corrections: number;
  confidence: number;
}

export interface EfficiencyMetric {
  automation: number;
  manual_effort: number;
  cost_per_allocation: number;
  processing_rate: number;
}

// Allocated Cost Types
export interface AllocatedCost {
  id: string;
  source: CostSource;
  target: CostTarget;
  amount: CostAmount;
  allocation: AllocationDetail;
  period: string;
  validation: AllocationValidation;
}

export interface CostSource {
  type: 'service' | 'resource' | 'pool' | 'account';
  identifier: string;
  name: string;
  originalAmount: CostAmount;
  tags: Record<string, string>;
}

export interface CostTarget {
  type: 'cost_center' | 'project' | 'department' | 'business_unit';
  identifier: string;
  name: string;
  allocation_basis: string;
  tags: Record<string, string>;
}

export interface AllocationDetail {
  method: string;
  basis: string;
  percentage: number;
  driver_value: number;
  calculation: string;
  overrides: string[];
}
