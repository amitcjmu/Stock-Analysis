/**
 * FinOps Cost Analysis Types
 * 
 * Type definitions for cost analysis, comparison, and insights functionality.
 * Covers cost breakdown, trend analysis, anomaly detection, and cost comparisons.
 * 
 * Generated by CC (Claude Code) - Modularized from finops.ts
 */

import type { BaseMetadata, AuditableMetadata } from '../../shared/metadata-types';
import type {
  BaseApiRequest,
  BaseApiResponse,
  MultiTenantContext,
  CreateRequest,
  CreateResponse,
  GetRequest,
  GetResponse
} from '../shared';

// Cost Analysis APIs
export interface AnalyzeCostsRequest extends CreateRequest<CostAnalysisData> {
  flowId: string;
  data: CostAnalysisData;
  analysisType: 'current' | 'historical' | 'projected' | 'comparative';
  timeRange: {
    start: string;
    end: string;
  };
  granularity: 'hour' | 'day' | 'week' | 'month' | 'quarter' | 'year';
  dimensions: CostDimension[];
  filters: CostFilter[];
  includeBreakdown?: boolean;
  includeTrends?: boolean;
  includeAnomalies?: boolean;
}

export interface AnalyzeCostsResponse extends CreateResponse<CostAnalysisResult> {
  data: CostAnalysisResult;
  analysisId: string;
  totalCost: CostAmount;
  breakdown: CostBreakdown;
  trends: CostTrend[];
  anomalies: CostAnomaly[];
  insights: CostInsight[];
}

export interface GetCostAnalysisRequest extends GetRequest {
  analysisId: string;
  includeBreakdown?: boolean;
  includeTrends?: boolean;
  includeAnomalies?: boolean;
  includeComparisons?: boolean;
  includeRecommendations?: boolean;
  currency?: string;
}

export interface GetCostAnalysisResponse extends GetResponse<CostAnalysisResult> {
  data: CostAnalysisResult;
  detailedBreakdown: DetailedCostBreakdown;
  comparisons: CostComparison[];
  recommendations: CostRecommendation[];
  benchmarks: CostBenchmark[];
}

export interface CompareCostsRequest extends BaseApiRequest {
  analysisIds: string[];
  comparisonType: 'period_over_period' | 'budget_vs_actual' | 'plan_vs_actual' | 'benchmark';
  dimensions: CostDimension[];
  normalization?: CostNormalization;
  includeVariance?: boolean;
  context: MultiTenantContext;
}

export interface CompareCostsResponse extends BaseApiResponse<CostComparison> {
  data: CostComparison;
  comparisonId: string;
  variance: CostVariance;
  insights: ComparisonInsight[];
  recommendations: ComparisonRecommendation[];
}

// Supporting Data Types
export interface CostAnalysisData {
  id: string;
  flowId: string;
  analysisName: string;
  analysisType: string;
  scope: CostAnalysisScope;
  timeRange: {
    start: string;
    end: string;
  };
  granularity: string;
  dimensions: CostDimension[];
  filters: CostFilter[];
  configuration: CostAnalysisConfiguration;
  metadata: AuditableMetadata;
}

export interface CostAnalysisScope {
  accounts: string[];
  services: string[];
  resources: string[];
  regions: string[];
  costCenters: string[];
  projects: string[];
  environments: string[];
  tags: Record<string, string>;
}

export interface CostDimension {
  name: string;
  type: 'service' | 'resource' | 'region' | 'account' | 'project' | 'tag';
  values?: string[];
  aggregation: 'sum' | 'avg' | 'min' | 'max' | 'count';
}

export interface CostFilter {
  dimension: string;
  operator: 'equals' | 'not_equals' | 'contains' | 'not_contains' | 'in' | 'not_in';
  values: string[];
}

export interface CostAnalysisConfiguration {
  currency: string;
  includeDiscounts: boolean;
  includeCredits: boolean;
  includeTaxes: boolean;
  includeRefunds: boolean;
  exchangeRateDate?: string;
  customizations: BaseMetadata;
}

export interface CostAnalysisResult {
  id: string;
  analysisId: string;
  totalCost: CostAmount;
  breakdown: CostBreakdown;
  trends: CostTrend[];
  anomalies: CostAnomaly[];
  insights: CostInsight[];
  metadata: CostAnalysisMetadata;
  generatedAt: string;
}

export interface CostAmount {
  amount: number;
  currency: string;
  unblendedAmount?: number;
  blendedAmount?: number;
  netAmount?: number;
  amortizedAmount?: number;
}

export interface CostBreakdown {
  byService: ServiceCostBreakdown[];
  byResource: ResourceCostBreakdown[];
  byRegion: RegionCostBreakdown[];
  byAccount: AccountCostBreakdown[];
  byProject: ProjectCostBreakdown[];
  byTag: TagCostBreakdown[];
  byTimeframe: TimeframeCostBreakdown[];
}

export interface DetailedCostBreakdown extends CostBreakdown {
  byUsageType: UsageTypeCostBreakdown[];
  byOperation: OperationCostBreakdown[];
  byAvailabilityZone: AvailabilityZoneCostBreakdown[];
  byInstanceType: InstanceTypeCostBreakdown[];
}

export interface ServiceCostBreakdown {
  service: string;
  cost: CostAmount;
  percentage: number;
  change: CostChange;
  resources: number;
}

export interface ResourceCostBreakdown {
  resourceId: string;
  resourceType: string;
  service: string;
  cost: CostAmount;
  percentage: number;
  utilization?: number;
}

export interface RegionCostBreakdown {
  region: string;
  cost: CostAmount;
  percentage: number;
  services: number;
}

export interface AccountCostBreakdown {
  accountId: string;
  accountName: string;
  cost: CostAmount;
  percentage: number;
  services: number;
}

export interface ProjectCostBreakdown {
  projectId: string;
  projectName: string;
  cost: CostAmount;
  percentage: number;
  resources: number;
}

export interface TagCostBreakdown {
  tagKey: string;
  tagValue: string;
  cost: CostAmount;
  percentage: number;
  resources: number;
}

export interface TimeframeCostBreakdown {
  period: string;
  cost: CostAmount;
  change: CostChange;
  forecast?: CostAmount;
}

export interface UsageTypeCostBreakdown {
  usageType: string;
  cost: CostAmount;
  quantity: number;
  unit: string;
}

export interface OperationCostBreakdown {
  operation: string;
  cost: CostAmount;
  quantity: number;
  percentage: number;
}

export interface AvailabilityZoneCostBreakdown {
  availabilityZone: string;
  cost: CostAmount;
  percentage: number;
  resources: number;
}

export interface InstanceTypeCostBreakdown {
  instanceType: string;
  cost: CostAmount;
  quantity: number;
  averageUtilization: number;
}

export interface CostTrend {
  dimension: string;
  timeframe: string;
  direction: 'increasing' | 'decreasing' | 'stable';
  magnitude: number;
  significance: 'low' | 'medium' | 'high';
  drivers: string[];
}

export interface CostAnomaly {
  id: string;
  dimension: string;
  timeframe: string;
  type: 'spike' | 'drop' | 'pattern_change';
  severity: 'low' | 'medium' | 'high' | 'critical';
  impact: CostAmount;
  confidence: number;
  causes: string[];
  recommendations: string[];
}

export interface CostInsight {
  id: string;
  type: 'optimization' | 'trend' | 'anomaly' | 'recommendation';
  title: string;
  description: string;
  impact: CostAmount;
  confidence: number;
  actionable: boolean;
  actions: InsightAction[];
}

export interface CostAnalysisMetadata {
  dataSource: string;
  dataFreshness: string;
  coverage: number;
  accuracy: number;
  limitations: string[];
  assumptions: string[];
}

export interface CostChange {
  amount: CostAmount;
  percentage: number;
  direction: 'increase' | 'decrease' | 'no_change';
}

export interface CostComparison {
  id: string;
  comparisonType: string;
  baseline: CostAnalysisResult;
  target: CostAnalysisResult;
  variance: CostVariance;
  insights: ComparisonInsight[];
  recommendations: ComparisonRecommendation[];
}

export interface CostVariance {
  absolute: CostAmount;
  percentage: number;
  direction: 'favorable' | 'unfavorable' | 'neutral';
  significance: 'low' | 'medium' | 'high';
  breakdown: VarianceBreakdown;
}

export interface VarianceBreakdown {
  byService: ServiceVariance[];
  byResource: ResourceVariance[];
  byRegion: RegionVariance[];
  byTimeframe: TimeframeVariance[];
}

export interface ServiceVariance {
  service: string;
  variance: CostAmount;
  percentage: number;
  significance: 'low' | 'medium' | 'high';
}

export interface ResourceVariance {
  resourceId: string;
  variance: CostAmount;
  percentage: number;
  reason: string;
}

export interface RegionVariance {
  region: string;
  variance: CostAmount;
  percentage: number;
  drivers: string[];
}

export interface TimeframeVariance {
  period: string;
  variance: CostAmount;
  percentage: number;
  seasonality: boolean;
}

export interface ComparisonInsight {
  type: 'variance' | 'trend' | 'pattern';
  title: string;
  description: string;
  impact: CostAmount;
  actionable: boolean;
}

export interface ComparisonRecommendation {
  type: 'optimization' | 'investigation' | 'monitoring';
  priority: 'low' | 'medium' | 'high';
  title: string;
  description: string;
  estimatedSavings?: CostAmount;
  effort: 'low' | 'medium' | 'high';
}

export interface CostRecommendation {
  id: string;
  type: 'rightsizing' | 'scheduling' | 'purchasing' | 'cleanup';
  priority: 'low' | 'medium' | 'high';
  title: string;
  description: string;
  estimatedSavings: CostAmount;
  effort: 'low' | 'medium' | 'high';
  risk: 'low' | 'medium' | 'high';
  implementation: RecommendationImplementation;
}

export interface CostBenchmark {
  type: 'industry' | 'peer' | 'historical' | 'best_practice';
  metric: string;
  value: number;
  percentile: number;
  comparison: 'above' | 'below' | 'within_range';
}

export interface CostNormalization {
  method: 'per_unit' | 'per_user' | 'per_transaction' | 'per_hour';
  unit: string;
  baseline: number;
}

export interface InsightAction {
  type: 'investigate' | 'optimize' | 'monitor' | 'alert';
  description: string;
  urgency: 'low' | 'medium' | 'high';
  estimatedTime: string;
}

export interface RecommendationImplementation {
  steps: string[];
  prerequisites: string[];
  tools: string[];
  documentation: string;
  rollbackPlan: string;
}