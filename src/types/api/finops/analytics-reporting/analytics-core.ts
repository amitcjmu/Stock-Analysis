/**
 * FinOps Analytics Core Types
 * 
 * Core analytics types including metrics, dimensions, aggregations,
 * and basic analytical data structures.
 * 
 * Generated by CC (Claude Code) - Modularized from analytics-reporting.ts
 */

import {
  BaseApiRequest,
  BaseApiResponse,
  MultiTenantContext
} from '../../shared';
import { CostAmount } from '../shared';

// Core Analytics API Types
export interface GetFinOpsAnalyticsRequest extends BaseApiRequest {
  flowId?: string;
  timeRange?: {
    start: string;
    end: string;
  };
  metrics?: string[];
  dimensions?: string[];
  aggregation?: 'sum' | 'avg' | 'min' | 'max' | 'count';
  currency?: string;
  includeForecasts?: boolean;
  context: MultiTenantContext;
}

export interface GetFinOpsAnalyticsResponse extends BaseApiResponse<FinOpsAnalytics> {
  data: FinOpsAnalytics;
  insights: FinOpsInsight[];
  trends: FinOpsTrend[];
  benchmarks: FinOpsBenchmark[];
  forecasts: FinOpsForecast[];
  kpis: FinOpsKPI[];
}

// Core Analytics Data Types
export interface FinOpsAnalytics {
  id: string;
  flowId: string;
  timeRange: {
    start: string;
    end: string;
  };
  scope: AnalyticsScope;
  summary: AnalyticsSummary;
  metrics: AnalyticsMetric[];
  dimensions: AnalyticsDimension[];
  trends: AnalyticsTrend[];
  forecasts: AnalyticsForecast[];
  comparisons: AnalyticsComparison[];
  insights: AnalyticsInsight[];
  generatedAt: string;
}

export interface AnalyticsScope {
  accounts: string[];
  services: string[];
  regions: string[];
  projects: string[];
  costCenters: string[];
  environments: string[];
  tags: Record<string, string>;
}

export interface AnalyticsSummary {
  totalCost: CostAmount;
  totalBudget: CostAmount;
  totalSavings: CostAmount;
  utilizationRate: number;
  complianceScore: number;
  optimizationOpportunities: number;
  activeAlerts: number;
  kpiStatus: KPIStatus;
}

export interface KPIStatus {
  meeting: number;
  atRisk: number;
  missing: number;
  total: number;
  overallHealth: 'healthy' | 'warning' | 'critical';
}

// Metrics and Measurements
export interface AnalyticsMetric {
  name: string;
  category: 'cost' | 'budget' | 'utilization' | 'performance' | 'compliance';
  value: number;
  unit: string;
  target?: number;
  threshold?: MetricThreshold;
  trend: MetricTrend;
  significance: 'low' | 'medium' | 'high';
  context: MetricContext;
}

export interface MetricThreshold {
  warning: number;
  critical: number;
  target: number;
}

export interface MetricTrend {
  direction: 'increasing' | 'decreasing' | 'stable';
  rate: number;
  confidence: number;
  timeframe: string;
}

export interface MetricContext {
  baseline: number;
  benchmark: number;
  percentile: number;
  comparison: 'above' | 'below' | 'within_range';
}

// Dimensions and Analysis
export interface AnalyticsDimension {
  name: string;
  type: 'categorical' | 'numerical' | 'temporal';
  values: DimensionValue[];
  aggregations: DimensionAggregation[];
  insights: DimensionInsight[];
}

export interface DimensionValue {
  value: string;
  count: number;
  cost: CostAmount;
  percentage: number;
  trend: 'increasing' | 'decreasing' | 'stable';
}

export interface DimensionAggregation {
  function: 'sum' | 'avg' | 'min' | 'max' | 'count' | 'median';
  result: number;
  unit: string;
}

export interface DimensionInsight {
  type: 'outlier' | 'pattern' | 'correlation' | 'anomaly';
  description: string;
  significance: number;
  actionable: boolean;
}

// Comparisons and Analysis
export interface AnalyticsComparison {
  type: 'period_over_period' | 'budget_vs_actual' | 'forecast_vs_actual' | 'peer_benchmark';
  baseline: ComparisonBaseline;
  target: ComparisonTarget;
  variance: ComparisonVariance;
  insights: ComparisonInsight[];
  significance: 'low' | 'medium' | 'high';
}

export interface ComparisonBaseline {
  period: string;
  metrics: Record<string, number>;
  context: string;
}

export interface ComparisonTarget {
  period: string;
  metrics: Record<string, number>;
  context: string;
}

export interface ComparisonVariance {
  absolute: Record<string, number>;
  percentage: Record<string, number>;
  direction: Record<string, 'positive' | 'negative' | 'neutral'>;
  significance: Record<string, 'low' | 'medium' | 'high'>;
}

export interface ComparisonInsight {
  metric: string;
  type: 'improvement' | 'degradation' | 'anomaly' | 'pattern';
  description: string;
  impact: number;
  recommendations: string[];
}

// Base Analytics Insights
export interface AnalyticsInsight {
  id: string;
  type: 'cost_optimization' | 'budget_variance' | 'trend_analysis' | 'anomaly_detection' | 'performance_insight';
  category: 'financial' | 'operational' | 'strategic' | 'tactical';
  title: string;
  description: string;
  confidence: number;
  impact: InsightImpact;
  urgency: 'low' | 'medium' | 'high' | 'immediate';
  actionable: boolean;
  recommendations: InsightRecommendation[];
  supporting_data: InsightData[];
}

export interface InsightImpact {
  financial: CostAmount;
  operational: string;
  strategic: string;
  risk: 'low' | 'medium' | 'high';
}

export interface InsightRecommendation {
  action: string;
  priority: 'low' | 'medium' | 'high';
  effort: 'low' | 'medium' | 'high';
  timeline: string;
  expectedImpact: string;
}

export interface InsightData {
  metric: string;
  value: number;
  context: string;
  relevance: number;
}

// Forward declarations for types defined in other modules
export interface FinOpsInsight extends AnalyticsInsight {
  flowId: string;
  source: 'automated' | 'manual' | 'ml_generated';
  tags: string[];
  lifecycle: InsightLifecycle;
}

export interface InsightLifecycle {
  status: 'new' | 'reviewed' | 'actionable' | 'implemented' | 'resolved' | 'dismissed';
  createdAt: string;
  reviewedAt?: string;
  implementedAt?: string;
  resolvedAt?: string;
  dismissedAt?: string;
  assignee?: string;
}

// Trend types (basic definition - detailed types in trends-forecasts.ts)
export interface AnalyticsTrend {
  metric: string;
  timeframe: string;
  direction: 'increasing' | 'decreasing' | 'stable' | 'cyclical';
  magnitude: number;
  acceleration: number;
  seasonality: SeasonalityPattern;
  projections: TrendProjection[];
  drivers: TrendDriver[];
}

export interface SeasonalityPattern {
  detected: boolean;
  pattern: 'daily' | 'weekly' | 'monthly' | 'quarterly' | 'yearly';
  strength: number;
  confidence: number;
}

export interface TrendProjection {
  horizon: string;
  value: number;
  confidence: number;
  scenario: 'optimistic' | 'realistic' | 'pessimistic';
}

export interface TrendDriver {
  factor: string;
  contribution: number;
  type: 'internal' | 'external' | 'seasonal' | 'structural';
  controllable: boolean;
}

// Forecast types (basic definition - detailed types in trends-forecasts.ts)
export interface AnalyticsForecast {
  metric: string;
  method: 'linear' | 'exponential' | 'arima' | 'ml_ensemble';
  horizon: string;
  predictions: ForecastPrediction[];
  accuracy: ForecastAccuracy;
  assumptions: ForecastAssumption[];
  scenarios: ForecastScenario[];
}

export interface ForecastPrediction {
  period: string;
  value: number;
  confidence: ForecastConfidence;
  factors: string[];
}

export interface ForecastConfidence {
  level: number;
  upperBound: number;
  lowerBound: number;
  interval: string;
}

export interface ForecastAccuracy {
  mae: number; // Mean Absolute Error
  mape: number; // Mean Absolute Percentage Error
  rmse: number; // Root Mean Square Error
  r2: number; // R-squared
  historicalAccuracy: number;
}

export interface ForecastAssumption {
  category: 'business' | 'technical' | 'economic' | 'regulatory';
  description: string;
  impact: 'low' | 'medium' | 'high';
  probability: number;
}

export interface ForecastScenario {
  name: string;
  type: 'base' | 'optimistic' | 'pessimistic' | 'stress';
  probability: number;
  assumptions: string[];
  predictions: ForecastPrediction[];
  impact: ScenarioImpact;
}

export interface ScenarioImpact {
  cost: CostAmount;
  budget: CostAmount;
  variance: number;
  riskLevel: 'low' | 'medium' | 'high' | 'critical';
}

// Forward declarations for KPIs and Benchmarks (detailed in kpis-benchmarks.ts)
export interface FinOpsBenchmark {
  id: string;
  name: string;
  type: 'industry' | 'peer' | 'internal' | 'best_practice';
  category: 'cost_efficiency' | 'optimization_maturity' | 'governance_compliance';
  metric: string;
  value: number;
  unit: string;
  percentile: number;
}

export interface FinOpsKPI {
  id: string;
  name: string;
  category: 'cost' | 'budget' | 'optimization' | 'governance' | 'efficiency';
  type: 'absolute' | 'ratio' | 'percentage' | 'index';
  value: number;
  unit: string;
}

export interface FinOpsTrend extends AnalyticsTrend {
  flowId: string;
  category: 'cost' | 'budget' | 'optimization' | 'governance' | 'utilization';
}

export interface FinOpsForecast extends AnalyticsForecast {
  flowId: string;
  category: 'cost' | 'budget' | 'savings' | 'utilization';
}