/**
 * FinOps Shared Execution and Workflow Types
 * 
 * Common type definitions for execution workflows, implementation plans,
 * rollback strategies, and monitoring across FinOps modules.
 * 
 * Generated by CC (Claude Code) - FinOps Type Modularization
 */

import { CostAmount } from '../cost-analysis';
import { 
  ValidationResult, 
  ImplementationTask, 
  Dependency, 
  MonitoringAlert,
  ExecutionStatus,
  ValidationStatus,
  RiskLevel 
} from './base-types';
import type { ConfigurationValue, TypedConstraint } from '../../../shared/config-types';

// Execution Plan Types
export interface ExecutionPlan {
  id: string;
  name: string;
  description: string;
  phases: ExecutionPhase[];
  timeline: ExecutionTimeline;
  dependencies: Dependency[];
  validations: ValidationPlan;
  rollback: RollbackPlan;
  monitoring: MonitoringPlan;
  resources: ResourceRequirement[];
  approvals: ApprovalRequirement[];
}

export interface ExecutionPhase {
  id: string;
  name: string;
  description: string;
  tasks: ImplementationTask[];
  startConditions: string[];
  exitCriteria: string[];
  rollbackTriggers: string[];
  estimatedDuration: string;
  parallelExecution: boolean;
  dependencies: string[];
}

export interface ExecutionTimeline {
  startDate: string;
  endDate: string;
  totalDuration: string;
  phases: PhaseTimeline[];
  milestones: ExecutionMilestone[];
  criticalPath: string[];
  bufferTime: string;
}

export interface PhaseTimeline {
  phaseId: string;
  name: string;
  startDate: string;
  endDate: string;
  duration: string;
  tasks: TaskTimeline[];
  dependencies: string[];
}

export interface TaskTimeline {
  taskId: string;
  name: string;
  startDate: string;
  endDate: string;
  duration: string;
  assignee: string;
  dependencies: string[];
  criticalPath: boolean;
}

export interface ExecutionMilestone {
  id: string;
  name: string;
  date: string;
  type: 'phase_start' | 'phase_completion' | 'approval' | 'validation' | 'rollback_point';
  criteria: string[];
  deliverables: string[];
}

// Validation and Quality Gates
export interface ValidationPlan {
  preExecution: ValidationGroup[];
  duringExecution: ValidationGroup[];
  postExecution: ValidationGroup[];
  continuous: ValidationGroup[];
  qualityGates: QualityGate[];
}

export interface ValidationGroup {
  id: string;
  name: string;
  description: string;
  validations: ValidationCheck[];
  required: boolean;
  parallelExecution: boolean;
}

export interface ValidationCheck {
  id: string;
  name: string;
  type: 'automated' | 'manual' | 'hybrid';
  description: string;
  criteria: ValidationCriteria[];
  timeout?: string;
  retryPolicy?: RetryPolicy;
  escalation?: EscalationPolicy;
}

export interface ValidationCriteria {
  metric: string;
  operator: string;
  value: ConfigurationValue;
  tolerance?: number;
  unit?: string;
  critical: boolean;
}

export interface QualityGate {
  id: string;
  name: string;
  phase: string;
  criteria: QualityGateCriteria[];
  action: 'continue' | 'pause' | 'rollback' | 'escalate';
  required: boolean;
}

export interface QualityGateCriteria {
  metric: string;
  threshold: number;
  operator: string;
  weight: number;
  critical: boolean;
}

// Rollback and Recovery Types
export interface RollbackPlan {
  enabled: boolean;
  strategy: 'automatic' | 'manual' | 'hybrid';
  triggers: RollbackTrigger[];
  procedures: RollbackProcedure[];
  timeline: string;
  dataBackup: BackupStrategy[];
  validation: RollbackValidation;
  communication: CommunicationPlan;
}

export interface RollbackTrigger {
  id: string;
  type: 'performance_degradation' | 'cost_increase' | 'availability_impact' | 'manual' | 'quality_gate_failure';
  condition: string;
  threshold?: unknown;
  automated: boolean;
  description: string;
  priority: 'low' | 'medium' | 'high' | 'critical';
}

export interface RollbackProcedure {
  step: number;
  name: string;
  description: string;
  type: 'automated' | 'manual';
  commands?: string[];
  validation: string;
  rollbackTime: string;
  dependencies: string[];
  risks: RollbackRisk[];
}

export interface RollbackRisk {
  type: string;
  description: string;
  likelihood: 'low' | 'medium' | 'high';
  impact: 'low' | 'medium' | 'high';
  mitigation: string;
}

export interface BackupStrategy {
  type: 'data' | 'configuration' | 'state' | 'full_system';
  schedule: string;
  retention: string;
  location: string;
  encryption: boolean;
  verification: boolean;
}

export interface RollbackValidation {
  checks: ValidationCheck[];
  criteria: string[];
  timeout: string;
  failureAction: 'escalate' | 'manual_intervention' | 'abort';
}

// Monitoring and Observability Types
export interface MonitoringPlan {
  enabled: boolean;
  scope: MonitoringScope;
  metrics: MonitoringMetric[];
  alerts: MonitoringAlert[];
  dashboards: MonitoringDashboard[];
  logging: LoggingConfiguration;
  reporting: MonitoringReporting;
}

export interface MonitoringScope {
  resources: string[];
  metrics: string[];
  timeRange: {
    start: string;
    end: string;
  };
  granularity: string;
  retention: string;
}

export interface MonitoringMetric {
  name: string;
  type: 'counter' | 'gauge' | 'histogram' | 'summary';
  unit: string;
  collection: MetricCollection;
  thresholds: MetricThreshold[];
  aggregation: MetricAggregation;
}

export interface MetricCollection {
  interval: string;
  method: 'pull' | 'push' | 'stream';
  timeout: string;
  retries: number;
}

export interface MetricThreshold {
  level: 'info' | 'warning' | 'error' | 'critical';
  operator: string;
  value: number;
  duration?: string;
  hysteresis?: number;
}

export interface MetricAggregation {
  function: 'sum' | 'avg' | 'min' | 'max' | 'count' | 'p95' | 'p99';
  interval: string;
  retention: string;
}

export interface MonitoringDashboard {
  id: string;
  name: string;
  description: string;
  panels: DashboardPanel[];
  refresh: string;
  timeRange: string;
  variables: DashboardVariable[];
}

export interface DashboardPanel {
  id: string;
  type: 'graph' | 'table' | 'stat' | 'gauge' | 'heatmap';
  title: string;
  queries: PanelQuery[];
  visualization: PanelVisualization;
  position: PanelPosition;
}

export interface PanelQuery {
  metric: string;
  filters: Record<string, string | number | boolean | null>;
  aggregation: string;
  timeRange?: string;
}

export interface PanelVisualization {
  type: string;
  options: Record<string, string | number | boolean | null>;
  thresholds?: VisualizationThreshold[];
}

export interface VisualizationThreshold {
  value: number;
  color: string;
  operator: string;
}

export interface PanelPosition {
  x: number;
  y: number;
  width: number;
  height: number;
}

export interface DashboardVariable {
  name: string;
  type: 'query' | 'interval' | 'datasource' | 'custom';
  query?: string;
  options?: string[];
  default?: string;
  multi?: boolean;
}

export interface LoggingConfiguration {
  enabled: boolean;
  level: 'debug' | 'info' | 'warn' | 'error';
  destinations: LoggingDestination[];
  format: string;
  retention: string;
  sampling?: LoggingSampling;
}

export interface LoggingDestination {
  type: 'file' | 'console' | 'syslog' | 'elasticsearch' | 'cloudwatch';
  configuration: Record<string, string | number | boolean | null>;
  filters: LoggingFilter[];
}

export interface LoggingFilter {
  field: string;
  operator: string;
  value: unknown;
  action: 'include' | 'exclude';
}

export interface LoggingSampling {
  rate: number;
  strategy: 'random' | 'deterministic';
  preserveErrors: boolean;
}

export interface MonitoringReporting {
  frequency: string;
  recipients: string[];
  format: 'email' | 'slack' | 'webhook';
  content: ReportContent[];
  conditions: ReportCondition[];
}

export interface ReportContent {
  type: 'summary' | 'metrics' | 'alerts' | 'trends';
  configuration: Record<string, string | number | boolean | null>;
}

export interface ReportCondition {
  metric: string;
  operator: string;
  value: unknown;
  action: 'include' | 'highlight' | 'escalate';
}

// Resource and Approval Management
export interface ResourceRequirement {
  type: 'compute' | 'storage' | 'network' | 'human' | 'license';
  name: string;
  quantity: number;
  unit: string;
  duration: string;
  cost?: CostAmount;
  availability: ResourceAvailability;
  constraints: ResourceConstraint[];
}

export interface ResourceAvailability {
  startDate: string;
  endDate: string;
  schedule?: string;
  exclusions?: string[];
}

export interface ResourceConstraint extends Omit<TypedConstraint, 'type' | 'impact'> {
  type: 'capacity' | 'performance' | 'location' | 'compliance' | 'cost';
  mandatory: boolean;
}

export interface ApprovalRequirement {
  id: string;
  type: 'plan' | 'execution' | 'change' | 'budget' | 'compliance';
  name: string;
  description: string;
  approvers: Approver[];
  criteria: ApprovalCriteria[];
  workflow: ApprovalWorkflow;
  timeout: string;
  escalation: ApprovalEscalation;
}

export interface Approver {
  id: string;
  type: 'user' | 'role' | 'group';
  required: boolean;
  order: number;
  delegation?: ApprovalDelegation;
}

export interface ApprovalDelegation {
  enabled: boolean;
  delegates: string[];
  conditions: string[];
  duration: string;
}

export interface ApprovalCriteria {
  name: string;
  description: string;
  type: 'automatic' | 'manual';
  condition?: string;
  weight: number;
}

export interface ApprovalWorkflow {
  type: 'sequential' | 'parallel' | 'majority' | 'unanimous';
  steps: ApprovalStep[];
  routing: WorkflowRouting[];
  conditions: WorkflowCondition[];
}

export interface ApprovalStep {
  id: string;
  name: string;
  approvers: string[];
  required: number;
  timeout: string;
  conditions: string[];
}

export interface WorkflowRouting {
  condition: string;
  destination: string;
  action: 'route' | 'skip' | 'escalate';
}

export interface WorkflowCondition {
  field: string;
  operator: string;
  value: unknown;
  action: string;
}

export interface ApprovalEscalation {
  enabled: boolean;
  levels: EscalationLevel[];
  timeout: string;
  finalAction: 'approve' | 'reject' | 'escalate_external';
}

export interface EscalationLevel {
  level: number;
  escalateTo: string[];
  timeout: string;
  conditions: string[];
  actions: string[];
}

// Error Handling and Retry Policies
export interface RetryPolicy {
  enabled: boolean;
  maxRetries: number;
  backoff: BackoffStrategy;
  conditions: RetryCondition[];
  timeout: string;
}

export interface BackoffStrategy {
  type: 'fixed' | 'linear' | 'exponential' | 'custom';
  initialDelay: string;
  maxDelay: string;
  multiplier?: number;
  jitter?: boolean;
}

export interface RetryCondition {
  errorType: string;
  errorCode?: string;
  retryable: boolean;
  maxRetries?: number;
}

export interface EscalationPolicy {
  enabled: boolean;
  levels: EscalationLevel[];
  timeout: string;
  finalAction: string;
}

// Communication and Notification
export interface CommunicationPlan {
  stakeholders: Stakeholder[];
  channels: CommunicationChannel[];
  templates: CommunicationTemplate[];
  schedules: CommunicationSchedule[];
  escalation: CommunicationEscalation[];
}

export interface Stakeholder {
  id: string;
  name: string;
  role: string;
  type: 'internal' | 'external';
  contactInfo: ContactInfo;
  preferences: CommunicationPreferences;
}

export interface ContactInfo {
  email?: string;
  phone?: string;
  slack?: string;
  teams?: string;
  webhook?: string;
}

export interface CommunicationPreferences {
  channels: string[];
  frequency: string;
  urgency: string[];
  timezone: string;
  quietHours?: QuietHours;
}

export interface QuietHours {
  enabled: boolean;
  start: string;
  end: string;
  timezone: string;
  exceptions: string[];
}

export interface CommunicationChannel {
  type: 'email' | 'slack' | 'webhook' | 'sms' | 'phone';
  configuration: Record<string, string | number | boolean | null>;
  rateLimiting: RateLimiting;
  failover: ChannelFailover[];
}

export interface RateLimiting {
  enabled: boolean;
  maxMessages: number;
  timeWindow: string;
  action: 'queue' | 'drop' | 'failover';
}

export interface ChannelFailover {
  condition: string;
  channel: string;
  delay: string;
}

export interface CommunicationTemplate {
  id: string;
  name: string;
  type: 'start' | 'progress' | 'completion' | 'error' | 'rollback';
  subject: string;
  body: string;
  variables: TemplateVariable[];
}

export interface TemplateVariable {
  name: string;
  type: 'string' | 'number' | 'date' | 'object';
  required: boolean;
  default?: unknown;
}

export interface CommunicationSchedule {
  event: string;
  delay: string;
  recipients: string[];
  template: string;
  channel: string[];
  conditions: string[];
}

export interface CommunicationEscalation {
  trigger: string;
  delay: string;
  recipients: string[];
  template: string;
  channels: string[];
}