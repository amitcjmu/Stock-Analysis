/**
 * FinOps Cost Optimization Planning Types
 *
 * Type definitions focused on cost optimization identification,
 * strategy planning, and execution planning.
 *
 * Generated by CC (Claude Code) - Modularized from cost-optimization.ts
 */

import type { BaseMetadata, AuditableMetadata } from '../../../shared/metadata-types';
import type { ConfigurationValue } from '../../../shared/config-types';
import type {
  BaseApiRequest,
  BaseApiResponse,
  MultiTenantContext,
  CreateRequest,
  CreateResponse
} from '../../shared';
import type { CostAmount } from '../cost-analysis';
import type { FinOpsScope, TimeRange , OptimizationConstraint, OptimizationTarget} from '../shared'
import { RiskAssessment } from '../shared'
import type { ConfigurationValue } from '../../../shared/config-types';

// Cost Optimization Planning APIs
export interface IdentifyOptimizationsRequest extends BaseApiRequest {
  flowId: string;
  optimizationTypes: OptimizationType[];
  scope: FinOpsScope;
  constraints: OptimizationConstraint[];
  targets: OptimizationTarget[];
  riskTolerance: 'low' | 'medium' | 'high';
  includeAutomated?: boolean;
  context: MultiTenantContext;
}

export interface IdentifyOptimizationsResponse extends BaseApiResponse<OptimizationOpportunity[]> {
  data: OptimizationOpportunity[];
  totalPotentialSavings: CostAmount;
  highImpactOpportunities: OptimizationOpportunity[];
  quickWins: OptimizationOpportunity[];
  riskAssessment: OptimizationRiskAssessment;
}

export interface CreateOptimizationPlanRequest extends CreateRequest<OptimizationPlanData> {
  flowId: string;
  data: OptimizationPlanData;
  opportunities: string[];
  prioritization: OptimizationPrioritization;
  timeline: OptimizationTimeline;
  approvals: OptimizationApproval[];
  rollbackPlan?: RollbackPlan;
}

export interface CreateOptimizationPlanResponse extends CreateResponse<OptimizationPlan> {
  data: OptimizationPlan;
  planId: string;
  executionPlan: OptimizationExecutionPlan;
  riskMitigation: RiskMitigationPlan;
  approvalWorkflow: ApprovalWorkflow;
}

// Core Types
export type OptimizationType =
  | 'rightsizing' | 'scheduling' | 'purchasing_options' | 'architecture'
  | 'resource_cleanup' | 'storage_optimization' | 'network_optimization';

export interface OptimizationOpportunity {
  id: string;
  type: OptimizationType;
  name: string;
  description: string;
  scope: FinOpsScope;
  estimatedSavings: CostAmount;
  confidence: number;
  effort: 'low' | 'medium' | 'high';
  risk: 'low' | 'medium' | 'high';
  timeToValue: string;
  prerequisites: string[];
  implementation: OptimizationImplementation;
  validation: OptimizationValidationCriteria;
  metadata: BaseMetadata;
}

export interface OptimizationImplementation {
  method: 'manual' | 'automated' | 'hybrid';
  tools: string[];
  scripts: string[];
  documentation: string;
  rollbackProcedure: string;
  validationSteps: string[];
}

export interface OptimizationValidationCriteria {
  preExecution: string[];
  postExecution: string[];
  continuous: string[];
  rollbackTriggers: string[];
}

// Risk Assessment Types
export interface OptimizationRiskAssessment {
  overallRisk: 'low' | 'medium' | 'high' | 'critical';
  riskFactors: RiskFactor[];
  mitigationStrategies: MitigationStrategy[];
  rollbackComplexity: 'simple' | 'moderate' | 'complex';
  impactAssessment: ImpactAssessment;
}

export interface RiskFactor {
  type: 'performance' | 'availability' | 'security' | 'operational' | 'financial';
  description: string;
  likelihood: 'low' | 'medium' | 'high';
  impact: 'low' | 'medium' | 'high';
  mitigation: string;
}

export interface MitigationStrategy {
  risk: string;
  strategy: string;
  cost: CostAmount;
  timeline: string;
  effectiveness: number;
}

export interface ImpactAssessment {
  performance: PerformanceImpact;
  availability: AvailabilityImpact;
  security: SecurityImpact;
  operational: OperationalImpact;
  financial: FinancialImpact;
}

export interface PerformanceImpact {
  level: 'none' | 'minimal' | 'moderate' | 'significant';
  description: string;
  metrics: string[];
  baseline: Record<string, number>;
  projected: Record<string, number>;
}

export interface AvailabilityImpact {
  level: 'none' | 'minimal' | 'moderate' | 'significant';
  description: string;
  slaImpact: boolean;
  downtimeRisk: string;
  mitigations: string[];
}

export interface SecurityImpact {
  level: 'none' | 'minimal' | 'moderate' | 'significant';
  description: string;
  securityRisks: string[];
  complianceImpact: string[];
  mitigations: string[];
}

export interface OperationalImpact {
  level: 'none' | 'minimal' | 'moderate' | 'significant';
  description: string;
  processChanges: string[];
  skillRequirements: string[];
  toolingChanges: string[];
}

export interface FinancialImpact {
  savings: CostAmount;
  costs: CostAmount;
  netBenefit: CostAmount;
  roi: number;
  paybackPeriod: string;
  cashFlowImpact: CashFlowImpact[];
}

export interface CashFlowImpact {
  period: string;
  inflow: CostAmount;
  outflow: CostAmount;
  net: CostAmount;
}

// Plan Management Types
export interface OptimizationPlanData {
  id: string;
  flowId: string;
  name: string;
  description: string;
  objectives: string[];
  opportunities: string[];
  prioritization: OptimizationPrioritization;
  timeline: OptimizationTimeline;
  budget: CostAmount;
  approvals: OptimizationApproval[];
  rollbackPlan: RollbackPlan;
  metadata: AuditableMetadata;
}

export interface OptimizationPlan extends OptimizationPlanData {
  planId: string;
  status: 'draft' | 'review' | 'approved' | 'executing' | 'completed' | 'failed' | 'cancelled';
  totalEstimatedSavings: CostAmount;
  totalImplementationCost: CostAmount;
  netBenefit: CostAmount;
  riskAssessment: OptimizationRiskAssessment;
  executionPlan: OptimizationExecutionPlan;
  createdAt: string;
  updatedAt: string;
  approvedAt?: string;
  approvedBy?: string;
}

// Prioritization Types
export interface OptimizationPrioritization {
  method: 'roi' | 'effort' | 'risk' | 'savings' | 'custom';
  criteria: PrioritizationCriteria[];
  weights: Record<string, number>;
  phases: OptimizationPhase[];
}

export interface PrioritizationCriteria {
  name: string;
  type: 'savings' | 'effort' | 'risk' | 'time' | 'impact';
  weight: number;
  direction: 'ascending' | 'descending';
}

export interface OptimizationPhase {
  id: string;
  name: string;
  description: string;
  opportunities: string[];
  estimatedDuration: string;
  estimatedSavings: CostAmount;
  prerequisites: string[];
  dependencies: string[];
}

// Timeline Types
export interface OptimizationTimeline {
  startDate: string;
  endDate: string;
  phases: PhaseTimeline[];
  milestones: Milestone[];
  dependencies: Dependency[];
  criticalPath: string[];
}

export interface PhaseTimeline {
  phaseId: string;
  name: string;
  startDate: string;
  endDate: string;
  duration: string;
  tasks: TaskTimeline[];
}

export interface TaskTimeline {
  id: string;
  name: string;
  startDate: string;
  endDate: string;
  duration: string;
  assignee: string;
  dependencies: string[];
}

export interface Milestone {
  id: string;
  name: string;
  date: string;
  type: 'phase_completion' | 'savings_target' | 'approval' | 'validation';
  criteria: string[];
}

export interface Dependency {
  id: string;
  type: 'start_to_start' | 'start_to_finish' | 'finish_to_start' | 'finish_to_finish';
  predecessor: string;
  successor: string;
  lag: string;
}

// Approval Types
export interface OptimizationApproval {
  id: string;
  type: 'plan' | 'execution' | 'budget' | 'change';
  status: 'pending' | 'approved' | 'rejected' | 'conditional';
  approver: string;
  requestedAt: string;
  approvedAt?: string;
  rejectedAt?: string;
  conditions?: string[];
  reason?: string;
}

// Rollback Types
export interface RollbackPlan {
  triggers: RollbackTrigger[];
  procedures: RollbackProcedure[];
  timeline: string;
  validationSteps: string[];
  communicationPlan: CommunicationPlan;
}

export interface RollbackTrigger {
  type: 'performance_degradation' | 'cost_increase' | 'availability_impact' | 'manual';
  threshold: ConfigurationValue;
  automated: boolean;
  description: string;
}

export interface RollbackProcedure {
  step: number;
  description: string;
  commands: string[];
  validation: string;
  rollbackTime: string;
}

export interface CommunicationPlan {
  stakeholders: string[];
  channels: string[];
  templates: string[];
  escalation: string[];
}

// Execution Planning Types
export interface OptimizationExecutionPlan {
  phases: ExecutionPhase[];
  tasks: ExecutionTask[];
  validations: ExecutionValidation[];
  monitoring: ExecutionMonitoring;
  rollback: ExecutionRollback;
}

export interface ExecutionPhase {
  id: string;
  name: string;
  tasks: string[];
  startConditions: string[];
  exitCriteria: string[];
  rollbackTriggers: string[];
}

export interface ExecutionTask {
  id: string;
  name: string;
  type: 'manual' | 'automated' | 'approval';
  description: string;
  commands: string[];
  validation: string[];
  rollback: string[];
  assignee: string;
  estimatedDuration: string;
}

export interface ExecutionValidation {
  id: string;
  name: string;
  type: 'pre_execution' | 'post_execution' | 'continuous';
  criteria: ValidationCriteria[];
  automated: boolean;
  frequency: string;
}

export interface ValidationCriteria {
  metric: string;
  operator: string;
  value: ConfigurationValue;
  tolerance: number;
  critical: boolean;
}

export interface ExecutionMonitoring {
  metrics: string[];
  dashboards: string[];
  alerts: MonitoringAlert[];
  reporting: MonitoringReporting;
}

export interface MonitoringAlert {
  metric: string;
  condition: string;
  threshold: ConfigurationValue;
  severity: 'info' | 'warning' | 'error' | 'critical';
  actions: string[];
}

export interface MonitoringReporting {
  frequency: string;
  recipients: string[];
  format: string;
  metrics: string[];
}

export interface ExecutionRollback {
  automaticTriggers: string[];
  manualTriggers: string[];
  procedures: string[];
  validation: string[];
  timeline: string;
}

// Risk Management Types
export interface RiskMitigationPlan {
  risks: IdentifiedRisk[];
  strategies: MitigationStrategy[];
  contingencies: ContingencyPlan[];
  monitoring: RiskMonitoring;
}

export interface IdentifiedRisk {
  id: string;
  type: string;
  description: string;
  likelihood: 'low' | 'medium' | 'high';
  impact: 'low' | 'medium' | 'high';
  mitigation: string;
  owner: string;
}

export interface ContingencyPlan {
  trigger: string;
  actions: string[];
  timeline: string;
  resources: string[];
}

export interface RiskMonitoring {
  indicators: string[];
  thresholds: BaseMetadata;
  frequency: string;
  escalation: string[];
}

// Approval Workflow Types
export interface ApprovalWorkflow {
  steps: ApprovalStep[];
  parallel: boolean;
  timeout: string;
  escalation: EscalationRule[];
}

export interface ApprovalStep {
  id: string;
  name: string;
  approvers: string[];
  required: number;
  timeout: string;
  criteria: string[];
}

export interface EscalationRule {
  trigger: string;
  escalateTo: string[];
  timeout: string;
  actions: string[];
}
