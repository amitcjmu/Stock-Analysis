/**
 * FinOps Cost Optimization Execution Types
 * 
 * Type definitions focused on cost optimization execution,
 * monitoring, results tracking, and validation.
 * 
 * Generated by CC (Claude Code) - Modularized from cost-optimization.ts
 */

import {
  BaseApiRequest,
  BaseApiResponse,
  GetRequest,
  GetResponse,
  MultiTenantContext
} from '../../shared';
import { CostAmount } from '../cost-analysis';
import {
  ExecutionStatus,
  ValidationResult,
  TimeRange
} from '../shared';

// Optimization Execution APIs
export interface ExecuteOptimizationRequest extends BaseApiRequest {
  planId: string;
  optimizationIds?: string[];
  executionMode: 'simulate' | 'implement' | 'rollback';
  approvalOverride?: boolean;
  monitoringEnabled?: boolean;
  context: MultiTenantContext;
}

export interface ExecuteOptimizationResponse extends BaseApiResponse<OptimizationExecution> {
  data: OptimizationExecution;
  executionId: string;
  status: OptimizationExecutionStatus;
  estimatedSavings: CostAmount;
  monitoringDashboard?: string;
}

export interface GetOptimizationResultsRequest extends GetRequest {
  executionId: string;
  includeMetrics?: boolean;
  includeSavings?: boolean;
  includeImpact?: boolean;
  includeValidation?: boolean;
  timeRange?: TimeRange;
}

export interface GetOptimizationResultsResponse extends GetResponse<OptimizationResults> {
  data: OptimizationResults;
  actualSavings: CostAmount;
  impactAnalysis: OptimizationImpactAnalysis;
  validation: OptimizationValidation;
  recommendations: PostOptimizationRecommendation[];
}

// Execution Status Types
export type OptimizationExecutionStatus = 
  | 'planned' | 'simulating' | 'approved' | 'implementing'
  | 'monitoring' | 'completed' | 'failed' | 'rolled_back';

// Execution Types
export interface OptimizationExecution {
  id: string;
  planId: string;
  status: OptimizationExecutionStatus;
  startedAt: string;
  completedAt?: string;
  progress: number;
  currentPhase: string;
  executedTasks: ExecutedTask[];
  validationResults: ValidationResult[];
  metrics: ExecutionMetrics;
  issues: ExecutionIssue[];
}

export interface ExecutedTask {
  taskId: string;
  status: 'pending' | 'running' | 'completed' | 'failed' | 'skipped';
  startedAt: string;
  completedAt?: string;
  output: string;
  errors: string[];
}

export interface ExecutionMetrics {
  tasksCompleted: number;
  totalTasks: number;
  successRate: number;
  averageTaskDuration: string;
  totalExecutionTime: string;
  resourcesModified: number;
}

export interface ExecutionIssue {
  id: string;
  type: 'error' | 'warning' | 'info';
  description: string;
  impact: 'low' | 'medium' | 'high';
  resolution: string;
  timestamp: string;
}

// Results and Impact Analysis
export interface OptimizationResults {
  executionId: string;
  status: 'success' | 'partial' | 'failed';
  actualSavings: CostAmount;
  projectedSavings: CostAmount;
  savingsRealization: number;
  optimizationsCompleted: number;
  optimizationsTotal: number;
  metrics: ResultMetrics;
  validation: OptimizationValidation;
  recommendations: PostOptimizationRecommendation[];
  generatedAt: string;
}

export interface ResultMetrics {
  costSavings: CostAmount;
  performanceImpact: Record<string, number>;
  utilizationImprovement: Record<string, number>;
  resourcesOptimized: number;
  timeToValue: string;
}

export interface OptimizationImpactAnalysis {
  costSavings: CostAmount;
  performanceChange: Record<string, number>;
  capacityChange: Record<string, number>;
  utilizationImprovement: Record<string, number>;
  riskAssessment: OptimizationRiskAssessmentSummary;
}

export interface OptimizationRiskAssessmentSummary {
  overallRisk: 'low' | 'medium' | 'high';
  risks: Risk[];
  mitigations: Mitigation[];
}

export interface Risk {
  type: 'performance' | 'availability' | 'cost' | 'operational';
  description: string;
  likelihood: 'low' | 'medium' | 'high';
  impact: 'low' | 'medium' | 'high';
}

export interface Mitigation {
  risk: string;
  strategy: string;
  cost: CostAmount;
  effectiveness: number;
}

// Validation Types
export interface OptimizationValidation {
  overallStatus: 'passed' | 'failed' | 'partial';
  validationResults: ValidationSummary[];
  performanceValidation: PerformanceValidation;
  costValidation: CostValidation;
  complianceValidation: ComplianceValidation;
}

export interface ValidationSummary {
  category: string;
  status: 'passed' | 'failed' | 'warning';
  score: number;
  details: string[];
}

export interface PerformanceValidation {
  baseline: Record<string, number>;
  current: Record<string, number>;
  delta: Record<string, number>;
  passed: boolean;
  issues: string[];
}

export interface CostValidation {
  expectedSavings: CostAmount;
  actualSavings: CostAmount;
  variance: CostAmount;
  realizationRate: number;
  passed: boolean;
}

export interface ComplianceValidation {
  policies: PolicyValidation[];
  overallCompliance: boolean;
  violations: string[];
  recommendations: string[];
}

export interface PolicyValidation {
  policyId: string;
  name: string;
  compliant: boolean;
  violations: string[];
}

// Post-Optimization Types
export interface PostOptimizationRecommendation {
  type: 'further_optimization' | 'monitoring' | 'rollback' | 'enhancement';
  priority: 'low' | 'medium' | 'high';
  title: string;
  description: string;
  estimatedValue: CostAmount;
  effort: 'low' | 'medium' | 'high';
  timeline: string;
}

// Monitoring and Tracking Types
export interface OptimizationMonitoring {
  enabled: boolean;
  metrics: MonitoringMetric[];
  alerts: MonitoringAlert[];
  dashboards: MonitoringDashboard[];
  reports: MonitoringReport[];
  duration: string;
}

export interface MonitoringMetric {
  name: string;
  type: 'cost' | 'performance' | 'utilization' | 'availability';
  target: number;
  actual: number;
  trend: 'improving' | 'stable' | 'degrading';
  threshold: MetricThreshold;
}

export interface MetricThreshold {
  warning: number;
  critical: number;
  operator: 'gt' | 'lt' | 'eq' | 'gte' | 'lte';
}

export interface MonitoringAlert {
  id: string;
  type: 'cost_increase' | 'performance_degradation' | 'utilization_change';
  severity: 'info' | 'warning' | 'error' | 'critical';
  message: string;
  timestamp: string;
  resolved: boolean;
  actions: AlertAction[];
}

export interface AlertAction {
  type: 'notification' | 'rollback' | 'escalation' | 'investigation';
  description: string;
  automated: boolean;
  executedAt?: string;
}

export interface MonitoringDashboard {
  id: string;
  name: string;
  url: string;
  widgets: DashboardWidget[];
  refreshRate: string;
}

export interface DashboardWidget {
  type: 'chart' | 'metric' | 'table' | 'alert';
  title: string;
  dataSource: string;
  configuration: Record<string, any>;
}

export interface MonitoringReport {
  id: string;
  type: 'daily' | 'weekly' | 'monthly' | 'on_demand';
  format: 'email' | 'pdf' | 'dashboard';
  recipients: string[];
  schedule: string;
  lastGenerated?: string;
}

// Rollback and Recovery Types
export interface OptimizationRollback {
  id: string;
  executionId: string;
  reason: string;
  triggeredBy: 'automatic' | 'manual' | 'policy';
  startedAt: string;
  completedAt?: string;
  status: 'in_progress' | 'completed' | 'failed' | 'cancelled';
  steps: RollbackStep[];
  validation: RollbackValidation;
}

export interface RollbackStep {
  id: string;
  name: string;
  description: string;
  status: 'pending' | 'running' | 'completed' | 'failed';
  startedAt?: string;
  completedAt?: string;
  output?: string;
  errors: string[];
}

export interface RollbackValidation {
  preRollback: ValidationResult[];
  postRollback: ValidationResult[];
  systemHealth: HealthCheck[];
  dataIntegrity: IntegrityCheck[];
}

export interface HealthCheck {
  component: string;
  status: 'healthy' | 'degraded' | 'unhealthy';
  metrics: Record<string, number>;
  issues: string[];
}

export interface IntegrityCheck {
  dataset: string;
  status: 'valid' | 'corrupted' | 'missing';
  checksumValidation: boolean;
  recordCount: number;
  issues: string[];
}

// Execution History and Audit
export interface ExecutionHistory {
  executionId: string;
  planId: string;
  status: OptimizationExecutionStatus;
  startedAt: string;
  completedAt?: string;
  duration?: string;
  actualSavings: CostAmount;
  projectedSavings: CostAmount;
  savingsRealization: number;
  issues: ExecutionIssuesSummary;
}

export interface ExecutionIssuesSummary {
  total: number;
  errors: number;
  warnings: number;
  resolved: number;
  critical: string[];
}

export interface ExecutionAuditLog {
  timestamp: string;
  executionId: string;
  action: string;
  user: string;
  details: Record<string, any>;
  impact: 'none' | 'low' | 'medium' | 'high';
  category: 'security' | 'data' | 'system' | 'business';
}