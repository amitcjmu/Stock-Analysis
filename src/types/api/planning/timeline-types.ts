/**
 * Timeline Planning Types
 * 
 * Type definitions for timeline planning, scheduling, and critical path analysis.
 * Covers timeline creation, dependency management, milestone tracking,
 * and timeline optimization functionality.
 * 
 * Generated by CC - Claude Code
 */

import {
  CreateRequest,
  CreateResponse,
  GetRequest,
  GetResponse,
  UpdateRequest,
  UpdateResponse
} from '../shared';

// Timeline Planning APIs
export interface CreateTimelinePlanRequest extends CreateRequest<TimelinePlanData> {
  flowId: string;
  strategyId: string;
  data: TimelinePlanData;
  planningHorizon: PlanningHorizon;
  dependencies: TimelineDependency[];
  resources: ResourceAvailability[];
  constraints: TimelineConstraint[];
  milestones: Milestone[];
  includeBuffers?: boolean;
  includeRiskMitigation?: boolean;
}

export interface CreateTimelinePlanResponse extends CreateResponse<TimelinePlanResult> {
  data: TimelinePlanResult;
  timelineId: string;
  criticalPath: CriticalPathAnalysis;
  resourceConflicts?: ResourceConflict[];
  riskMitigationTime?: number;
  feasibilityCheck: TimelineFeasibility;
}

export interface GetTimelinePlanRequest extends GetRequest {
  timelineId: string;
  viewType?: 'gantt' | 'calendar' | 'kanban' | 'milestone';
  granularity?: 'day' | 'week' | 'month' | 'quarter';
  includeDetails?: boolean;
  includeDependencies?: boolean;
  includeResources?: boolean;
  includeRisks?: boolean;
}

export interface GetTimelinePlanResponse extends GetResponse<TimelinePlanResult> {
  data: TimelinePlanResult;
  visualization: TimelineVisualization;
  criticalPath: CriticalPathAnalysis;
  slackAnalysis: SlackAnalysis;
  resourceUtilization: ResourceUtilization;
}

export interface UpdateTimelinePlanRequest extends UpdateRequest<Partial<TimelinePlanData>> {
  timelineId: string;
  data: Partial<TimelinePlanData>;
  recalculateCriticalPath?: boolean;
  validateConstraints?: boolean;
  updateResourceAllocation?: boolean;
  propagateChanges?: boolean;
}

export interface UpdateTimelinePlanResponse extends UpdateResponse<TimelinePlanResult> {
  data: TimelinePlanResult;
  impactAnalysis: TimelineImpactAnalysis;
  newCriticalPath?: CriticalPathAnalysis;
  resourceImpacts?: ResourceImpact[];
  constraintViolations?: ConstraintViolation[];
}

// Core Data Types
export interface TimelinePlanData {
  id: string;
  name: string;
  description: string;
  startDate: string;
  endDate: string;
  totalDuration: number;
  workingDays: number;
  phases: TimelinePhase[];
  tasks: TimelineTask[];
  milestones: Milestone[];
  dependencies: TimelineDependency[];
  resources: TimelineResource[];
  constraints: TimelineConstraint[];
  buffers: TimelineBuffer[];
  assumptions: TimelineAssumption[];
  metadata: Record<string, any>;
}

export interface TimelinePlanResult {
  id: string;
  timelineData: TimelinePlanData;
  criticalPath: string[];
  criticalPathDuration: number;
  totalSlack: number;
  resourceUtilization: ResourceUtilization;
  constraintViolations: ConstraintViolation[];
  riskFactors: TimelineRiskFactor[];
  optimization: TimelineOptimization;
  feasibility: TimelineFeasibility;
  alternatives: TimelineAlternative[];
}

export interface TimelinePhase {
  id: string;
  name: string;
  description: string;
  startDate: string;
  endDate: string;
  duration: number;
  progress: number;
  status: 'not_started' | 'in_progress' | 'completed' | 'delayed' | 'blocked';
  tasks: string[];
  milestones: string[];
  dependencies: string[];
  resources: PhaseResource[];
  deliverables: string[];
  approvals: string[];
  risks: PhaseRisk[];
}

export interface TimelineTask {
  id: string;
  name: string;
  description: string;
  phaseId: string;
  type: 'task' | 'milestone' | 'summary';
  startDate: string;
  endDate: string;
  duration: number;
  effort: number;
  progress: number;
  status: 'not_started' | 'in_progress' | 'completed' | 'delayed' | 'blocked';
  priority: 'low' | 'medium' | 'high' | 'critical';
  dependencies: TaskDependency[];
  resources: TaskResource[];
  constraints: TaskConstraint[];
  deliverables: string[];
  acceptanceCriteria: string[];
  risks: TaskRisk[];
  notes: string;
}

export interface Milestone {
  id: string;
  name: string;
  description: string;
  date: string;
  type: 'deliverable' | 'decision' | 'approval' | 'checkpoint' | 'go_live';
  status: 'pending' | 'achieved' | 'missed' | 'at_risk';
  criteria: MilestoneCriteria[];
  dependencies: string[];
  stakeholders: string[];
  deliverables: string[];
  approvals: string[];
  risks: MilestoneRisk[];
  impact: 'low' | 'medium' | 'high' | 'critical';
}

export interface TimelineDependency {
  id: string;
  type: 'finish_to_start' | 'start_to_start' | 'finish_to_finish' | 'start_to_finish';
  predecessorId: string;
  successorId: string;
  lag: number;
  leadTime: number;
  constraint: 'mandatory' | 'discretionary' | 'external';
  description: string;
  impact: DependencyImpact;
  risks: DependencyRisk[];
}

export interface TimelineResource {
  id: string;
  name: string;
  type: 'human' | 'equipment' | 'material' | 'facility' | 'external';
  capacity: number;
  availability: ResourceAvailabilityPeriod[];
  cost: ResourceCost;
  skills: string[];
  location: string;
  calendar: WorkingCalendar;
  constraints: ResourceConstraint[];
  assignments: ResourceAssignment[];
}

export interface TimelineConstraint {
  id: string;
  type: 'start_no_earlier' | 'start_no_later' | 'finish_no_earlier' | 'finish_no_later' | 'must_start_on' | 'must_finish_on';
  targetId: string;
  targetType: 'task' | 'phase' | 'milestone';
  date: string;
  description: string;
  flexibility: 'fixed' | 'flexible' | 'negotiable';
  priority: 'low' | 'medium' | 'high' | 'critical';
  impact: ConstraintImpact;
  violations: ConstraintViolation[];
}

export interface TimelineBuffer {
  id: string;
  type: 'project' | 'feeding' | 'resource' | 'capacity';
  targetId: string;
  targetType: 'task' | 'phase' | 'milestone' | 'resource';
  duration: number;
  bufferSize: number;
  consumption: number;
  status: 'safe' | 'caution' | 'danger' | 'exhausted';
  protection: BufferProtection;
}

// Planning and Analysis Types
export interface PlanningHorizon {
  startDate: string;
  endDate: string;
  duration: number;
  workingDays: number;
  holidays: Holiday[];
  workingCalendar: WorkingCalendar;
  timeZone: string;
  granularity: 'hour' | 'day' | 'week' | 'month';
}

export interface CriticalPathAnalysis {
  criticalPath: string[];
  totalDuration: number;
  criticalTasks: CriticalTask[];
  nearCriticalPaths: NearCriticalPath[];
  floatAnalysis: FloatAnalysis;
  bottlenecks: Bottleneck[];
  optimizationOpportunities: PathOptimization[];
}

export interface TimelineVisualization {
  viewType: 'gantt' | 'calendar' | 'kanban' | 'milestone';
  granularity: 'day' | 'week' | 'month' | 'quarter';
  data: VisualizationData;
  layout: VisualizationLayout;
  styling: VisualizationStyling;
  interactions: VisualizationInteraction[];
}

export interface SlackAnalysis {
  totalSlack: number;
  freeSlack: number;
  tasks: TaskSlack[];
  phases: PhaseSlack[];
  criticalPath: boolean;
  slackDistribution: SlackDistribution;
  riskAreas: SlackRiskArea[];
}

export interface ResourceUtilization {
  overallUtilization: number;
  byResource: ResourceUtilizationDetail[];
  byPeriod: PeriodUtilization[];
  conflicts: ResourceConflict[];
  optimization: UtilizationOptimization[];
  forecasts: UtilizationForecast[];
}

export interface TimelineImpactAnalysis {
  scope: 'task' | 'phase' | 'project';
  affectedItems: string[];
  durationImpact: number;
  costImpact: number;
  resourceImpact: ResourceImpactDetail[];
  milestoneImpact: MilestoneImpact[];
  riskImpact: RiskImpactDetail[];
  recommendations: ImpactRecommendation[];
}

export interface TimelineFeasibility {
  overallFeasibility: 'high' | 'medium' | 'low' | 'not_feasible';
  durationFeasibility: DurationFeasibility;
  resourceFeasibility: ResourceFeasibilityDetail;
  dependencyFeasibility: DependencyFeasibility;
  constraintFeasibility: ConstraintFeasibility;
  riskFeasibility: RiskFeasibility;
  recommendations: FeasibilityRecommendation[];
}

export interface TimelineOptimization {
  currentDuration: number;
  optimizedDuration: number;
  savings: number;
  optimizations: OptimizationAction[];
  tradeoffs: OptimizationTradeoff[];
  alternatives: TimelineAlternative[];
  recommendations: OptimizationRecommendation[];
}

// Supporting Detail Types
export interface ResourceAvailability {
  resourceId: string;
  resourceName: string;
  type: string;
  capacity: number;
  periods: AvailabilityPeriod[];
  constraints: string[];
  cost: number;
}

export interface AvailabilityPeriod {
  startDate: string;
  endDate: string;
  capacity: number;
  available: boolean;
  reason?: string;
}

export interface ResourceAvailabilityPeriod {
  startDate: string;
  endDate: string;
  capacity: number;
  allocated: number;
  available: number;
  constraints: string[];
}

export interface ResourceCost {
  hourlyRate: number;
  dailyRate: number;
  fixedCost: number;
  currency: string;
  billingModel: 'hourly' | 'daily' | 'fixed' | 'milestone';
}

export interface WorkingCalendar {
  name: string;
  workingDays: string[];
  workingHours: WorkingHours;
  holidays: Holiday[];
  exceptions: CalendarException[];
  timeZone: string;
}

export interface WorkingHours {
  monday: DaySchedule;
  tuesday: DaySchedule;
  wednesday: DaySchedule;
  thursday: DaySchedule;
  friday: DaySchedule;
  saturday: DaySchedule;
  sunday: DaySchedule;
}

export interface DaySchedule {
  working: boolean;
  startTime: string;
  endTime: string;
  breaks: Break[];
  totalHours: number;
}

export interface Break {
  startTime: string;
  endTime: string;
  duration: number;
  paid: boolean;
}

export interface Holiday {
  date: string;
  name: string;
  type: 'national' | 'regional' | 'company';
  recurring: boolean;
}

export interface CalendarException {
  date: string;
  type: 'working' | 'non_working' | 'half_day';
  hours?: DaySchedule;
  reason: string;
}

export interface ResourceConstraint {
  type: 'availability' | 'skill' | 'location' | 'cost' | 'capacity';
  description: string;
  impact: 'low' | 'medium' | 'high' | 'critical';
  startDate?: string;
  endDate?: string;
  value?: any;
}

export interface ResourceAssignment {
  taskId: string;
  startDate: string;
  endDate: string;
  allocation: number;
  role: string;
  responsibility: string;
}

export interface TaskDependency {
  predecessorId: string;
  type: 'finish_to_start' | 'start_to_start' | 'finish_to_finish' | 'start_to_finish';
  lag: number;
  description: string;
}

export interface TaskResource {
  resourceId: string;
  allocation: number;
  role: string;
  effort: number;
  cost: number;
}

export interface TaskConstraint {
  type: string;
  value: any;
  description: string;
  impact: string;
}

export interface TaskRisk {
  id: string;
  description: string;
  probability: number;
  impact: number;
  mitigation: string;
}

export interface PhaseResource {
  resourceId: string;
  allocation: number;
  role: string;
  startDate: string;
  endDate: string;
}

export interface PhaseRisk {
  id: string;
  description: string;
  probability: number;
  impact: number;
  mitigation: string;
}

export interface MilestoneCriteria {
  id: string;
  description: string;
  measurable: boolean;
  target: any;
  achieved?: any;
  status: 'pending' | 'met' | 'not_met';
}

export interface MilestoneRisk {
  id: string;
  description: string;
  probability: number;
  impact: number;
  mitigation: string;
}

export interface DependencyImpact {
  severity: 'low' | 'medium' | 'high' | 'critical';
  description: string;
  affectedTasks: string[];
  delayRisk: number;
}

export interface DependencyRisk {
  id: string;
  description: string;
  probability: number;
  impact: number;
  mitigation: string;
}

export interface ConstraintImpact {
  severity: 'low' | 'medium' | 'high' | 'critical';
  description: string;
  affectedTasks: string[];
  feasibilityRisk: number;
}

export interface ConstraintViolation {
  constraintId: string;
  violationType: string;
  severity: 'low' | 'medium' | 'high' | 'critical';
  description: string;
  impact: string;
  recommendation: string;
}

export interface BufferProtection {
  level: 'low' | 'medium' | 'high';
  triggers: BufferTrigger[];
  actions: BufferAction[];
  escalation: BufferEscalation[];
}

export interface BufferTrigger {
  threshold: number;
  condition: string;
  action: string;
}

export interface BufferAction {
  type: string;
  description: string;
  owner: string;
  timeline: string;
}

export interface BufferEscalation {
  level: number;
  threshold: number;
  stakeholder: string;
  action: string;
}

// Analysis Supporting Types
export interface CriticalTask {
  taskId: string;
  taskName: string;
  startDate: string;
  endDate: string;
  duration: number;
  totalFloat: number;
  freeFloat: number;
  criticality: number;
}

export interface NearCriticalPath {
  pathId: string;
  tasks: string[];
  totalFloat: number;
  duration: number;
  riskLevel: 'low' | 'medium' | 'high';
}

export interface FloatAnalysis {
  totalFloat: TaskFloat[];
  freeFloat: TaskFloat[];
  independentFloat: TaskFloat[];
  interfering: TaskFloat[];
}

export interface TaskFloat {
  taskId: string;
  float: number;
  type: 'total' | 'free' | 'independent' | 'interfering';
  impact: string;
}

export interface Bottleneck {
  type: 'resource' | 'dependency' | 'constraint';
  id: string;
  description: string;
  impact: number;
  duration: number;
  affectedTasks: string[];
  recommendations: string[];
}

export interface PathOptimization {
  type: 'fast_track' | 'crash' | 'parallel' | 'reschedule';
  description: string;
  savings: number;
  cost: number;
  risk: string;
  feasibility: string;
}

export interface VisualizationData {
  tasks: any[];
  phases: any[];
  milestones: any[];
  dependencies: any[];
  resources: any[];
}

export interface VisualizationLayout {
  orientation: 'horizontal' | 'vertical';
  scale: 'hours' | 'days' | 'weeks' | 'months';
  groupBy: string;
  sortBy: string;
}

export interface VisualizationStyling {
  colors: ColorScheme;
  fonts: FontScheme;
  spacing: SpacingScheme;
  legend: LegendConfig;
}

export interface VisualizationInteraction {
  type: 'zoom' | 'pan' | 'filter' | 'drill_down' | 'tooltip';
  enabled: boolean;
  config: any;
}

export interface ColorScheme {
  primary: string;
  secondary: string;
  critical: string;
  warning: string;
  success: string;
  info: string;
}

export interface FontScheme {
  family: string;
  size: number;
  weight: string;
}

export interface SpacingScheme {
  padding: number;
  margin: number;
  rowHeight: number;
}

export interface LegendConfig {
  show: boolean;
  position: 'top' | 'bottom' | 'left' | 'right';
  items: LegendItem[];
}

export interface LegendItem {
  label: string;
  color: string;
  symbol: string;
}

export interface TaskSlack {
  taskId: string;
  totalSlack: number;
  freeSlack: number;
  independentSlack: number;
  criticality: 'critical' | 'near_critical' | 'normal';
}

export interface PhaseSlack {
  phaseId: string;
  totalSlack: number;
  averageSlack: number;
  criticalTasks: number;
  totalTasks: number;
}

export interface SlackDistribution {
  ranges: SlackRange[];
  mean: number;
  median: number;
  standardDeviation: number;
}

export interface SlackRange {
  min: number;
  max: number;
  count: number;
  percentage: number;
}

export interface SlackRiskArea {
  area: string;
  riskLevel: 'low' | 'medium' | 'high' | 'critical';
  description: string;
  impact: string;
  mitigation: string;
}

export interface ResourceUtilizationDetail {
  resourceId: string;
  resourceName: string;
  utilization: number;
  capacity: number;
  allocated: number;
  available: number;
  overallocated: boolean;
  efficiency: number;
}

export interface PeriodUtilization {
  period: string;
  startDate: string;
  endDate: string;
  utilization: number;
  capacity: number;
  demand: number;
  variance: number;
}

export interface ResourceConflict {
  resourceId: string;
  conflictType: 'overallocation' | 'skill_mismatch' | 'availability' | 'location';
  severity: 'low' | 'medium' | 'high' | 'critical';
  affectedTasks: string[];
  startDate: string;
  endDate: string;
  resolution: ConflictResolution[];
}

export interface ConflictResolution {
  type: 'reschedule' | 'reallocate' | 'substitute' | 'split' | 'extend';
  description: string;
  impact: string;
  feasibility: string;
  cost: number;
}

export interface UtilizationOptimization {
  type: 'level' | 'smooth' | 'maximize' | 'balance';
  description: string;
  improvement: number;
  cost: number;
  feasibility: string;
  impact: string;
}

export interface UtilizationForecast {
  period: string;
  forecastUtilization: number;
  confidence: number;
  trend: 'increasing' | 'decreasing' | 'stable';
  factors: string[];
}

export interface ResourceImpact {
  resourceId: string;
  impactType: 'allocation' | 'utilization' | 'cost' | 'availability';
  currentValue: number;
  newValue: number;
  variance: number;
  description: string;
}

export interface ResourceImpactDetail {
  resourceId: string;
  resourceName: string;
  impactType: string;
  magnitude: number;
  duration: number;
  cost: number;
  mitigation: string;
}

export interface MilestoneImpact {
  milestoneId: string;
  milestoneName: string;
  currentDate: string;
  newDate: string;
  delay: number;
  impact: 'low' | 'medium' | 'high' | 'critical';
  stakeholders: string[];
}

export interface RiskImpactDetail {
  riskId: string;
  riskDescription: string;
  currentProbability: number;
  newProbability: number;
  currentImpact: number;
  newImpact: number;
  mitigation: string;
}

export interface ImpactRecommendation {
  type: string;
  description: string;
  priority: 'low' | 'medium' | 'high' | 'critical';
  effort: string;
  benefit: string;
  risk: string;
}

// Feasibility Supporting Types
export interface DurationFeasibility {
  score: number;
  baselineDuration: number;
  optimisticDuration: number;
  pessimisticDuration: number;
  mostLikelyDuration: number;
  confidence: number;
  factors: FeasibilityFactor[];
}

export interface ResourceFeasibilityDetail {
  score: number;
  availability: ResourceAvailabilityScore[];
  skills: SkillAvailabilityScore[];
  cost: CostFeasibilityScore;
  conflicts: number;
  alternatives: number;
}

export interface DependencyFeasibility {
  score: number;
  externalDependencies: number;
  criticalDependencies: number;
  riskDependencies: number;
  alternatives: number;
  mitigation: string[];
}

export interface ConstraintFeasibility {
  score: number;
  hardConstraints: number;
  softConstraints: number;
  violations: number;
  flexibility: number;
  alternatives: string[];
}

export interface RiskFeasibility {
  score: number;
  highRisks: number;
  mediumRisks: number;
  lowRisks: number;
  mitigation: number;
  contingency: number;
}

export interface FeasibilityRecommendation {
  type: string;
  description: string;
  impact: string;
  effort: string;
  priority: 'low' | 'medium' | 'high' | 'critical';
}

export interface FeasibilityFactor {
  name: string;
  weight: number;
  score: number;
  description: string;
  impact: string;
}

export interface ResourceAvailabilityScore {
  resourceType: string;
  required: number;
  available: number;
  score: number;
  alternatives: number;
}

export interface SkillAvailabilityScore {
  skill: string;
  level: string;
  required: number;
  available: number;
  score: number;
  gap: number;
}

export interface CostFeasibilityScore {
  budgetRequired: number;
  budgetAvailable: number;
  score: number;
  variance: number;
  risk: string;
}

// Optimization Supporting Types
export interface OptimizationAction {
  type: 'fast_track' | 'crash' | 'parallel' | 'reschedule' | 'resource_level';
  target: string;
  description: string;
  savings: number;
  cost: number;
  risk: string;
  feasibility: string;
  dependencies: string[];
}

export interface OptimizationTradeoff {
  aspect: 'time' | 'cost' | 'quality' | 'scope' | 'risk';
  currentValue: number;
  optimizedValue: number;
  tradeoffValue: number;
  impact: string;
  acceptability: string;
}

export interface TimelineAlternative {
  id: string;
  name: string;
  description: string;
  duration: number;
  cost: number;
  risk: string;
  feasibility: string;
  advantages: string[];
  disadvantages: string[];
  recommendation: 'recommended' | 'viable' | 'not_recommended';
}

export interface OptimizationRecommendation {
  type: string;
  description: string;
  benefit: string;
  effort: string;
  risk: string;
  priority: 'low' | 'medium' | 'high' | 'critical';
  timeline: string;
}

export interface TimelineRiskFactor {
  factor: string;
  impact: 'low' | 'medium' | 'high' | 'critical';
  probability: number;
  description: string;
  mitigation: string;
}

export interface TimelineAssumption {
  id: string;
  description: string;
  category: string;
  confidence: number;
  impact: string;
  validation: string;
}