/**
 * Timeline Core Types
 * 
 * Core timeline data structures, tasks, phases, milestones, and dependencies.
 * 
 * Generated by CC - Claude Code
 */

import type { AuditableMetadata } from '../../../shared/metadata-types';
import type {
  CreateRequest,
  CreateResponse,
  GetRequest,
  GetResponse,
  UpdateRequest,
  UpdateResponse
} from '../../shared';

// Timeline Planning APIs
export interface CreateTimelinePlanRequest extends CreateRequest<TimelinePlanData> {
  flowId: string;
  strategyId: string;
  data: TimelinePlanData;
  planningHorizon: PlanningHorizon;
  dependencies: TimelineDependency[];
  resources: ResourceAvailability[];
  constraints: TimelineConstraint[];
  milestones: Milestone[];
  includeBuffers?: boolean;
  includeRiskMitigation?: boolean;
}

export interface CreateTimelinePlanResponse extends CreateResponse<TimelinePlanResult> {
  data: TimelinePlanResult;
  timelineId: string;
  criticalPath: CriticalPathAnalysis;
  resourceConflicts?: ResourceConflict[];
  riskMitigationTime?: number;
  feasibilityCheck: TimelineFeasibility;
}

export interface GetTimelinePlanRequest extends GetRequest {
  timelineId: string;
  viewType?: 'gantt' | 'calendar' | 'kanban' | 'milestone';
  granularity?: 'day' | 'week' | 'month' | 'quarter';
  includeDetails?: boolean;
  includeDependencies?: boolean;
  includeResources?: boolean;
  includeRisks?: boolean;
}

export interface GetTimelinePlanResponse extends GetResponse<TimelinePlanResult> {
  data: TimelinePlanResult;
  visualization: TimelineVisualization;
  criticalPath: CriticalPathAnalysis;
  slackAnalysis: SlackAnalysis;
  resourceUtilization: ResourceUtilization;
}

export interface UpdateTimelinePlanRequest extends UpdateRequest<Partial<TimelinePlanData>> {
  timelineId: string;
  data: Partial<TimelinePlanData>;
  recalculateCriticalPath?: boolean;
  validateConstraints?: boolean;
  updateResourceAllocation?: boolean;
  propagateChanges?: boolean;
}

export interface UpdateTimelinePlanResponse extends UpdateResponse<TimelinePlanResult> {
  data: TimelinePlanResult;
  impactAnalysis: TimelineImpactAnalysis;
  newCriticalPath?: CriticalPathAnalysis;
  resourceImpacts?: ResourceImpact[];
  constraintViolations?: ConstraintViolation[];
}

// Core Data Types
export interface TimelinePlanData {
  id: string;
  name: string;
  description: string;
  startDate: string;
  endDate: string;
  totalDuration: number;
  workingDays: number;
  phases: TimelinePhase[];
  tasks: TimelineTask[];
  milestones: Milestone[];
  dependencies: TimelineDependency[];
  resources: TimelineResource[];
  constraints: TimelineConstraint[];
  buffers: TimelineBuffer[];
  assumptions: TimelineAssumption[];
  metadata: AuditableMetadata;
}

export interface TimelinePlanResult {
  id: string;
  timelineData: TimelinePlanData;
  criticalPath: string[];
  criticalPathDuration: number;
  totalSlack: number;
  resourceUtilization: ResourceUtilization;
  constraintViolations: ConstraintViolation[];
  riskFactors: TimelineRiskFactor[];
  optimization: TimelineOptimization;
  feasibility: TimelineFeasibility;
  alternatives: TimelineAlternative[];
}

export interface TimelinePhase {
  id: string;
  name: string;
  description: string;
  startDate: string;
  endDate: string;
  duration: number;
  progress: number;
  status: 'not_started' | 'in_progress' | 'completed' | 'delayed' | 'blocked';
  tasks: string[];
  milestones: string[];
  dependencies: string[];
  resources: PhaseResource[];
  deliverables: string[];
  approvals: string[];
  risks: PhaseRisk[];
}

export interface TimelineTask {
  id: string;
  name: string;
  description: string;
  phaseId: string;
  type: 'task' | 'milestone' | 'summary';
  startDate: string;
  endDate: string;
  duration: number;
  effort: number;
  progress: number;
  status: 'not_started' | 'in_progress' | 'completed' | 'delayed' | 'blocked';
  priority: 'low' | 'medium' | 'high' | 'critical';
  dependencies: TaskDependency[];
  resources: TaskResource[];
  constraints: TaskConstraint[];
  deliverables: string[];
  acceptanceCriteria: string[];
  risks: TaskRisk[];
  notes: string;
}

export interface Milestone {
  id: string;
  name: string;
  description: string;
  date: string;
  type: 'deliverable' | 'decision' | 'approval' | 'checkpoint' | 'go_live';
  status: 'pending' | 'achieved' | 'missed' | 'at_risk';
  criteria: MilestoneCriteria[];
  dependencies: string[];
  stakeholders: string[];
  deliverables: string[];
  approvals: string[];
  risks: MilestoneRisk[];
  impact: 'low' | 'medium' | 'high' | 'critical';
}

export interface TimelineDependency {
  id: string;
  type: 'finish_to_start' | 'start_to_start' | 'finish_to_finish' | 'start_to_finish';
  predecessorId: string;
  successorId: string;
  lag: number;
  leadTime: number;
  constraint: 'mandatory' | 'discretionary' | 'external';
  description: string;
  impact: DependencyImpact;
  risks: DependencyRisk[];
}

export interface TimelineConstraint {
  id: string;
  type: 'start_no_earlier' | 'start_no_later' | 'finish_no_earlier' | 'finish_no_later' | 'must_start_on' | 'must_finish_on';
  targetId: string;
  targetType: 'task' | 'phase' | 'milestone';
  date: string;
  description: string;
  flexibility: 'fixed' | 'flexible' | 'negotiable';
  priority: 'low' | 'medium' | 'high' | 'critical';
  impact: ConstraintImpact;
  violations: ConstraintViolation[];
}

export interface TimelineBuffer {
  id: string;
  type: 'project' | 'feeding' | 'resource' | 'capacity';
  targetId: string;
  targetType: 'task' | 'phase' | 'milestone' | 'resource';
  duration: number;
  bufferSize: number;
  consumption: number;
  status: 'safe' | 'caution' | 'danger' | 'exhausted';
  protection: BufferProtection;
}

// Supporting interfaces
export interface TaskDependency {
  predecessorId: string;
  type: 'finish_to_start' | 'start_to_start' | 'finish_to_finish' | 'start_to_finish';
  lag: number;
  description: string;
}

export interface TaskResource {
  resourceId: string;
  allocation: number;
  role: string;
  effort: number;
  cost: number;
}

export interface TaskConstraint extends TypedConstraint {
  targetDate?: string;
  flexibility?: 'fixed' | 'flexible' | 'negotiable';
}

export interface TaskRisk {
  id: string;
  description: string;
  probability: number;
  impact: number;
  mitigation: string;
}

export interface PhaseResource {
  resourceId: string;
  allocation: number;
  role: string;
  startDate: string;
  endDate: string;
}

export interface PhaseRisk {
  id: string;
  description: string;
  probability: number;
  impact: number;
  mitigation: string;
}

export interface MilestoneCriteria {
  id: string;
  description: string;
  measurable: boolean;
  target: ConfigurationValue;
  achieved?: ConfigurationValue;
  status: 'pending' | 'met' | 'not_met';
}

export interface MilestoneRisk {
  id: string;
  description: string;
  probability: number;
  impact: number;
  mitigation: string;
}

export interface DependencyImpact {
  severity: 'low' | 'medium' | 'high' | 'critical';
  description: string;
  affectedTasks: string[];
  delayRisk: number;
}

export interface DependencyRisk {
  id: string;
  description: string;
  probability: number;
  impact: number;
  mitigation: string;
}

export interface ConstraintImpact {
  severity: 'low' | 'medium' | 'high' | 'critical';
  description: string;
  affectedTasks: string[];
  feasibilityRisk: number;
}

export interface ConstraintViolation {
  constraintId: string;
  violationType: string;
  severity: 'low' | 'medium' | 'high' | 'critical';
  description: string;
  impact: string;
  recommendation: string;
}

export interface BufferProtection {
  level: 'low' | 'medium' | 'high';
  triggers: BufferTrigger[];
  actions: BufferAction[];
  escalation: BufferEscalation[];
}

export interface BufferTrigger {
  threshold: number;
  condition: string;
  action: string;
}

export interface BufferAction {
  type: string;
  description: string;
  owner: string;
  timeline: string;
}

export interface BufferEscalation {
  level: number;
  threshold: number;
  stakeholder: string;
  action: string;
}

export interface TimelineAssumption {
  id: string;
  description: string;
  category: string;
  confidence: number;
  impact: string;
  validation: string;
}

// Forward declarations for types defined in other modules
export interface PlanningHorizon {
  startDate: string;
  endDate: string;
  duration: number;
  workingDays: number;
  holidays: Holiday[];
  workingCalendar: WorkingCalendar;
  timeZone: string;
  granularity: 'hour' | 'day' | 'week' | 'month';
}

export interface Holiday {
  date: string;
  name: string;
  type: 'national' | 'regional' | 'company';
  recurring: boolean;
}

export interface WorkingCalendar {
  name: string;
  workingDays: string[];
  workingHours: WorkingHours;
  holidays: Holiday[];
  exceptions: CalendarException[];
  timeZone: string;
}

// These will be fully defined in other modules
export interface CriticalPathAnalysis extends TimelineAnalysis {
  criticalPath: string[];
  totalDuration: number;
  criticalTasks: CriticalTask[];
  nearCriticalPaths: NearCriticalPath[];
  floatAnalysis: FloatAnalysis;
  bottlenecks: Bottleneck[];
  optimizationOpportunities: OptimizationOpportunity[];
}

export interface TimelineVisualization {
  viewType: 'gantt' | 'calendar' | 'kanban' | 'milestone';
  granularity: 'day' | 'week' | 'month' | 'quarter';
  data: VisualizationData;
  layout: VisualizationLayout;
  styling: VisualizationStyling;
  interactions: VisualizationInteraction[];
}

export interface SlackAnalysis {
  totalSlack: number;
  freeSlack: number;
  tasks: TaskSlackInfo[];
  phases: PhaseSlackInfo[];
  criticalPath: boolean;
  slackDistribution: SlackDistribution;
  riskAreas: SlackRiskArea[];
}

export interface ResourceUtilization {
  overallUtilization: number;
  byResource: ResourceUtilizationDetail[];
  byPeriod: PeriodUtilization[];
  conflicts: ResourceConflict[];
  optimization: ResourceOptimization[];
  forecasts: ResourceForecast[];
}

export interface ResourceConflict {
  resourceId: string;
  conflictType: 'overallocation' | 'skill_mismatch' | 'availability' | 'location';
  severity: 'low' | 'medium' | 'high' | 'critical';
  affectedTasks: string[];
  startDate: string;
  endDate: string;
  resolution: ResolutionOption[];
}

export interface ResolutionOption {
  type: 'reschedule' | 'reallocate' | 'substitute' | 'extend' | 'split';
  description: string;
  impact: string;
  effort: 'low' | 'medium' | 'high';
  recommended: boolean;
}

export interface TimelineImpactAnalysis {
  scope: 'task' | 'phase' | 'project';
  affectedItems: string[];
  durationImpact: number;
  costImpact: number;
  resourceImpact: ResourceImpactDetail[];
  milestoneImpact: MilestoneImpactDetail[];
  riskImpact: RiskImpactDetail[];
  recommendations: ImpactRecommendation[];
}

export interface ResourceImpactDetail {
  resourceId: string;
  currentAllocation: number;
  newAllocation: number;
  conflict: boolean;
  resolution: string;
}

export interface MilestoneImpactDetail {
  milestoneId: string;
  originalDate: string;
  newDate: string;
  delay: number;
  affected: boolean;
}

export interface RiskImpactDetail {
  riskId: string;
  originalScore: number;
  newScore: number;
  change: 'increased' | 'decreased' | 'unchanged';
  mitigation: string;
}

export interface ImpactRecommendation {
  type: 'schedule' | 'resource' | 'scope' | 'risk';
  priority: 'low' | 'medium' | 'high' | 'critical';
  action: string;
  benefit: string;
  effort: string;
}

export interface TimelineFeasibility {
  overallFeasibility: 'high' | 'medium' | 'low' | 'not_feasible';
  durationFeasibility: FeasibilityAssessment;
  resourceFeasibility: FeasibilityAssessment;
  dependencyFeasibility: FeasibilityAssessment;
  constraintFeasibility: FeasibilityAssessment;
  riskFeasibility: FeasibilityAssessment;
  recommendations: FeasibilityRecommendation[];
}

export interface FeasibilityAssessment {
  score: number;
  level: 'high' | 'medium' | 'low' | 'not_feasible';
  issues: FeasibilityIssue[];
  confidence: number;
}

export interface FeasibilityIssue {
  type: string;
  severity: 'low' | 'medium' | 'high' | 'critical';
  description: string;
  impact: string;
  resolution: string;
}

export interface FeasibilityRecommendation {
  area: 'duration' | 'resource' | 'dependency' | 'constraint' | 'risk';
  action: string;
  benefit: string;
  effort: 'low' | 'medium' | 'high';
  priority: number;
}

export interface TimelineOptimization {
  currentDuration: number;
  optimizedDuration: number;
  savings: number;
  optimizations: OptimizationAction[];
  tradeoffs: OptimizationTradeoff[];
  alternatives: TimelineAlternative[];
  recommendations: OptimizationRecommendation[];
}

export interface OptimizationAction {
  type: 'fast_track' | 'crash' | 'resource_level' | 'scope_reduce' | 'parallel';
  tasks: string[];
  currentDuration: number;
  newDuration: number;
  savings: number;
  cost: number;
  risk: string;
}

export interface OptimizationTradeoff {
  factor: 'time' | 'cost' | 'quality' | 'scope' | 'risk';
  currentValue: number;
  optimizedValue: number;
  impact: string;
  acceptable: boolean;
}

export interface OptimizationRecommendation {
  action: string;
  impact: string;
  effort: 'low' | 'medium' | 'high';
  priority: number;
  prerequisites: string[];
}

export interface TimelineAlternative {
  id: string;
  name: string;
  description: string;
  duration: number;
  cost: number;
  risk: string;
  feasibility: string;
  advantages: string[];
  disadvantages: string[];
  recommendation: 'recommended' | 'viable' | 'not_recommended';
}

export interface TimelineRiskFactor {
  factor: string;
  impact: 'low' | 'medium' | 'high' | 'critical';
  probability: number;
  description: string;
  mitigation: string;
}

export interface ResourceAvailability {
  resourceId: string;
  resourceName: string;
  type: string;
  capacity: number;
  periods: AvailabilityPeriod[];
  constraints: string[];
  cost: number;
}

export interface AvailabilityPeriod {
  startDate: string;
  endDate: string;
  availability: number;
  capacity: number;
  allocated: number;
  remaining: number;
}

export interface TimelineResource {
  id: string;
  name: string;
  type: 'human' | 'equipment' | 'material' | 'facility' | 'external';
  capacity: number;
  availability: ResourceAvailabilitySlot[];
  cost: ResourceCost;
  skills: string[];
  location: string;
  calendar: WorkingCalendar;
  constraints: ResourceConstraint[];
  assignments: ResourceTaskAssignment[];
}

export interface ResourceAvailabilitySlot {
  startDate: string;
  endDate: string;
  percentAvailable: number;
  hoursAvailable: number;
  reason?: string;
}

export interface ResourceCost {
  rate: number;
  unit: 'hour' | 'day' | 'week' | 'month' | 'fixed';
  currency: string;
  overtime?: number;
  minimumCharge?: number;
}

export interface ResourceConstraint {
  type: 'skill' | 'location' | 'certification' | 'availability' | 'preference';
  value: ConfigurationValue;
  required: boolean;
  description: string;
}

export interface ResourceTaskAssignment {
  taskId: string;
  startDate: string;
  endDate: string;
  allocation: number;
  effort: number;
  role: string;
}

// Additional supporting interfaces for replaced any types

export interface WorkingHours {
  monday?: DayHours;
  tuesday?: DayHours;
  wednesday?: DayHours;
  thursday?: DayHours;
  friday?: DayHours;
  saturday?: DayHours;
  sunday?: DayHours;
}

export interface DayHours {
  start: string;
  end: string;
  breaks?: TimeRange[];
}

export interface TimeRange {
  start: string;
  end: string;
}

export interface CalendarException {
  date: string;
  type: 'working' | 'non_working' | 'half_day';
  hours?: DayHours;
  reason: string;
}

export interface CriticalTask {
  taskId: string;
  name: string;
  duration: number;
  dependencies: string[];
  slack: number;
  earlyStart: string;
  earlyFinish: string;
  lateStart: string;
  lateFinish: string;
}

export interface NearCriticalPath {
  path: string[];
  totalFloat: number;
  criticalityPercentage: number;
  tasks: string[];
}

export interface FloatAnalysis {
  totalFloat: number;
  freeFloat: number;
  interfering: number;
  independent: number;
  byTask: Record<string, TaskFloat>;
}

export interface TaskFloat {
  taskId: string;
  totalFloat: number;
  freeFloat: number;
  interfering: number;
  independent: number;
}

export interface Bottleneck {
  taskId: string;
  type: 'resource' | 'dependency' | 'constraint' | 'approval';
  severity: 'low' | 'medium' | 'high' | 'critical';
  impact: string;
  recommendation: string;
}

export interface OptimizationOpportunity {
  type: 'parallel' | 'duration' | 'resource' | 'dependency';
  tasks: string[];
  potentialSaving: number;
  effort: 'low' | 'medium' | 'high';
  description: string;
  risks: string[];
}

export interface VisualizationData {
  items: VisualizationItem[];
  groups?: VisualizationGroup[];
  markers?: VisualizationMarker[];
  links?: VisualizationLink[];
}

export interface VisualizationItem {
  id: string;
  type: 'task' | 'phase' | 'milestone' | 'buffer';
  startDate: string;
  endDate: string;
  label: string;
  progress?: number;
  color?: string;
  groupId?: string;
}

export interface VisualizationGroup {
  id: string;
  label: string;
  collapsed?: boolean;
  order?: number;
}

export interface VisualizationMarker {
  date: string;
  label: string;
  type: 'today' | 'deadline' | 'milestone' | 'custom';
  color?: string;
}

export interface VisualizationLink {
  source: string;
  target: string;
  type: string;
  style?: string;
}

export interface VisualizationLayout {
  width?: number;
  height?: number;
  zoom?: number;
  offset?: { x: number; y: number };
  grouping?: 'none' | 'phase' | 'resource' | 'custom';
  sorting?: 'start_date' | 'end_date' | 'name' | 'priority';
}

export interface VisualizationStyling {
  theme?: 'light' | 'dark' | 'custom';
  colors?: Record<string, string>;
  fonts?: Record<string, string>;
  borders?: Record<string, string>;
}

export interface VisualizationInteraction {
  type: 'click' | 'hover' | 'drag' | 'zoom' | 'pan';
  enabled: boolean;
  callback?: string;
  config?: Record<string, ConfigurationValue>;
}

export interface TaskSlackInfo {
  taskId: string;
  name: string;
  totalSlack: number;
  freeSlack: number;
  isCritical: boolean;
  dependencies: string[];
}

export interface PhaseSlackInfo {
  phaseId: string;
  name: string;
  totalSlack: number;
  criticalTasks: number;
  totalTasks: number;
}

export interface SlackDistribution {
  distribution: SlackRange[];
  average: number;
  median: number;
  standardDeviation: number;
}

export interface SlackRange {
  range: string;
  count: number;
  percentage: number;
  tasks: string[];
}

export interface SlackRiskArea {
  area: string;
  riskLevel: 'low' | 'medium' | 'high';
  tasks: string[];
  recommendation: string;
}

export interface ResourceUtilizationDetail {
  resourceId: string;
  resourceName: string;
  utilization: number;
  allocatedHours: number;
  availableHours: number;
  assignments: ResourceAssignment[];
}

export interface PeriodUtilization {
  period: string;
  startDate: string;
  endDate: string;
  utilization: number;
  peakUtilization: number;
  underUtilized: string[];
  overUtilized: string[];
}

export interface ResourceOptimization {
  type: 'leveling' | 'smoothing' | 'allocation' | 'substitution';
  resources: string[];
  currentCost: number;
  optimizedCost: number;
  savings: number;
  recommendation: string;
}

export interface ResourceForecast {
  period: string;
  demandForecast: number;
  supplyForecast: number;
  gap: number;
  recommendations: string[];
}

export interface ResourceAssignment {
  taskId: string;
  allocation: number;
  startDate: string;
  endDate: string;
  effort: number;
}

export interface ResourceImpact {
  resourceId: string;
  impactType: 'allocation' | 'utilization' | 'cost' | 'availability';
  currentValue: number;
  newValue: number;
  variance: number;
  description: string;
}