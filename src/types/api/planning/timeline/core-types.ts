/**
 * Timeline Core Types
 * 
 * Core timeline data structures, tasks, phases, milestones, and dependencies.
 * 
 * Generated by CC - Claude Code
 */

import {
  CreateRequest,
  CreateResponse,
  GetRequest,
  GetResponse,
  UpdateRequest,
  UpdateResponse
} from '../../shared';

// Timeline Planning APIs
export interface CreateTimelinePlanRequest extends CreateRequest<TimelinePlanData> {
  flowId: string;
  strategyId: string;
  data: TimelinePlanData;
  planningHorizon: PlanningHorizon;
  dependencies: TimelineDependency[];
  resources: ResourceAvailability[];
  constraints: TimelineConstraint[];
  milestones: Milestone[];
  includeBuffers?: boolean;
  includeRiskMitigation?: boolean;
}

export interface CreateTimelinePlanResponse extends CreateResponse<TimelinePlanResult> {
  data: TimelinePlanResult;
  timelineId: string;
  criticalPath: CriticalPathAnalysis;
  resourceConflicts?: ResourceConflict[];
  riskMitigationTime?: number;
  feasibilityCheck: TimelineFeasibility;
}

export interface GetTimelinePlanRequest extends GetRequest {
  timelineId: string;
  viewType?: 'gantt' | 'calendar' | 'kanban' | 'milestone';
  granularity?: 'day' | 'week' | 'month' | 'quarter';
  includeDetails?: boolean;
  includeDependencies?: boolean;
  includeResources?: boolean;
  includeRisks?: boolean;
}

export interface GetTimelinePlanResponse extends GetResponse<TimelinePlanResult> {
  data: TimelinePlanResult;
  visualization: TimelineVisualization;
  criticalPath: CriticalPathAnalysis;
  slackAnalysis: SlackAnalysis;
  resourceUtilization: ResourceUtilization;
}

export interface UpdateTimelinePlanRequest extends UpdateRequest<Partial<TimelinePlanData>> {
  timelineId: string;
  data: Partial<TimelinePlanData>;
  recalculateCriticalPath?: boolean;
  validateConstraints?: boolean;
  updateResourceAllocation?: boolean;
  propagateChanges?: boolean;
}

export interface UpdateTimelinePlanResponse extends UpdateResponse<TimelinePlanResult> {
  data: TimelinePlanResult;
  impactAnalysis: TimelineImpactAnalysis;
  newCriticalPath?: CriticalPathAnalysis;
  resourceImpacts?: ResourceImpact[];
  constraintViolations?: ConstraintViolation[];
}

// Core Data Types
export interface TimelinePlanData {
  id: string;
  name: string;
  description: string;
  startDate: string;
  endDate: string;
  totalDuration: number;
  workingDays: number;
  phases: TimelinePhase[];
  tasks: TimelineTask[];
  milestones: Milestone[];
  dependencies: TimelineDependency[];
  resources: TimelineResource[];
  constraints: TimelineConstraint[];
  buffers: TimelineBuffer[];
  assumptions: TimelineAssumption[];
  metadata: Record<string, any>;
}

export interface TimelinePlanResult {
  id: string;
  timelineData: TimelinePlanData;
  criticalPath: string[];
  criticalPathDuration: number;
  totalSlack: number;
  resourceUtilization: ResourceUtilization;
  constraintViolations: ConstraintViolation[];
  riskFactors: TimelineRiskFactor[];
  optimization: TimelineOptimization;
  feasibility: TimelineFeasibility;
  alternatives: TimelineAlternative[];
}

export interface TimelinePhase {
  id: string;
  name: string;
  description: string;
  startDate: string;
  endDate: string;
  duration: number;
  progress: number;
  status: 'not_started' | 'in_progress' | 'completed' | 'delayed' | 'blocked';
  tasks: string[];
  milestones: string[];
  dependencies: string[];
  resources: PhaseResource[];
  deliverables: string[];
  approvals: string[];
  risks: PhaseRisk[];
}

export interface TimelineTask {
  id: string;
  name: string;
  description: string;
  phaseId: string;
  type: 'task' | 'milestone' | 'summary';
  startDate: string;
  endDate: string;
  duration: number;
  effort: number;
  progress: number;
  status: 'not_started' | 'in_progress' | 'completed' | 'delayed' | 'blocked';
  priority: 'low' | 'medium' | 'high' | 'critical';
  dependencies: TaskDependency[];
  resources: TaskResource[];
  constraints: TaskConstraint[];
  deliverables: string[];
  acceptanceCriteria: string[];
  risks: TaskRisk[];
  notes: string;
}

export interface Milestone {
  id: string;
  name: string;
  description: string;
  date: string;
  type: 'deliverable' | 'decision' | 'approval' | 'checkpoint' | 'go_live';
  status: 'pending' | 'achieved' | 'missed' | 'at_risk';
  criteria: MilestoneCriteria[];
  dependencies: string[];
  stakeholders: string[];
  deliverables: string[];
  approvals: string[];
  risks: MilestoneRisk[];
  impact: 'low' | 'medium' | 'high' | 'critical';
}

export interface TimelineDependency {
  id: string;
  type: 'finish_to_start' | 'start_to_start' | 'finish_to_finish' | 'start_to_finish';
  predecessorId: string;
  successorId: string;
  lag: number;
  leadTime: number;
  constraint: 'mandatory' | 'discretionary' | 'external';
  description: string;
  impact: DependencyImpact;
  risks: DependencyRisk[];
}

export interface TimelineConstraint {
  id: string;
  type: 'start_no_earlier' | 'start_no_later' | 'finish_no_earlier' | 'finish_no_later' | 'must_start_on' | 'must_finish_on';
  targetId: string;
  targetType: 'task' | 'phase' | 'milestone';
  date: string;
  description: string;
  flexibility: 'fixed' | 'flexible' | 'negotiable';
  priority: 'low' | 'medium' | 'high' | 'critical';
  impact: ConstraintImpact;
  violations: ConstraintViolation[];
}

export interface TimelineBuffer {
  id: string;
  type: 'project' | 'feeding' | 'resource' | 'capacity';
  targetId: string;
  targetType: 'task' | 'phase' | 'milestone' | 'resource';
  duration: number;
  bufferSize: number;
  consumption: number;
  status: 'safe' | 'caution' | 'danger' | 'exhausted';
  protection: BufferProtection;
}

// Supporting interfaces
export interface TaskDependency {
  predecessorId: string;
  type: 'finish_to_start' | 'start_to_start' | 'finish_to_finish' | 'start_to_finish';
  lag: number;
  description: string;
}

export interface TaskResource {
  resourceId: string;
  allocation: number;
  role: string;
  effort: number;
  cost: number;
}

export interface TaskConstraint {
  type: string;
  value: unknown;
  description: string;
  impact: string;
}

export interface TaskRisk {
  id: string;
  description: string;
  probability: number;
  impact: number;
  mitigation: string;
}

export interface PhaseResource {
  resourceId: string;
  allocation: number;
  role: string;
  startDate: string;
  endDate: string;
}

export interface PhaseRisk {
  id: string;
  description: string;
  probability: number;
  impact: number;
  mitigation: string;
}

export interface MilestoneCriteria {
  id: string;
  description: string;
  measurable: boolean;
  target: unknown;
  achieved?: unknown;
  status: 'pending' | 'met' | 'not_met';
}

export interface MilestoneRisk {
  id: string;
  description: string;
  probability: number;
  impact: number;
  mitigation: string;
}

export interface DependencyImpact {
  severity: 'low' | 'medium' | 'high' | 'critical';
  description: string;
  affectedTasks: string[];
  delayRisk: number;
}

export interface DependencyRisk {
  id: string;
  description: string;
  probability: number;
  impact: number;
  mitigation: string;
}

export interface ConstraintImpact {
  severity: 'low' | 'medium' | 'high' | 'critical';
  description: string;
  affectedTasks: string[];
  feasibilityRisk: number;
}

export interface ConstraintViolation {
  constraintId: string;
  violationType: string;
  severity: 'low' | 'medium' | 'high' | 'critical';
  description: string;
  impact: string;
  recommendation: string;
}

export interface BufferProtection {
  level: 'low' | 'medium' | 'high';
  triggers: BufferTrigger[];
  actions: BufferAction[];
  escalation: BufferEscalation[];
}

export interface BufferTrigger {
  threshold: number;
  condition: string;
  action: string;
}

export interface BufferAction {
  type: string;
  description: string;
  owner: string;
  timeline: string;
}

export interface BufferEscalation {
  level: number;
  threshold: number;
  stakeholder: string;
  action: string;
}

export interface TimelineAssumption {
  id: string;
  description: string;
  category: string;
  confidence: number;
  impact: string;
  validation: string;
}

// Forward declarations for types defined in other modules
export interface PlanningHorizon {
  startDate: string;
  endDate: string;
  duration: number;
  workingDays: number;
  holidays: Holiday[];
  workingCalendar: WorkingCalendar;
  timeZone: string;
  granularity: 'hour' | 'day' | 'week' | 'month';
}

export interface Holiday {
  date: string;
  name: string;
  type: 'national' | 'regional' | 'company';
  recurring: boolean;
}

export interface WorkingCalendar {
  name: string;
  workingDays: string[];
  workingHours: unknown;
  holidays: Holiday[];
  exceptions: unknown[];
  timeZone: string;
}

// These will be fully defined in other modules
export interface CriticalPathAnalysis {
  criticalPath: string[];
  totalDuration: number;
  criticalTasks: unknown[];
  nearCriticalPaths: unknown[];
  floatAnalysis: unknown;
  bottlenecks: unknown[];
  optimizationOpportunities: unknown[];
}

export interface TimelineVisualization {
  viewType: 'gantt' | 'calendar' | 'kanban' | 'milestone';
  granularity: 'day' | 'week' | 'month' | 'quarter';
  data: unknown;
  layout: unknown;
  styling: unknown;
  interactions: unknown[];
}

export interface SlackAnalysis {
  totalSlack: number;
  freeSlack: number;
  tasks: unknown[];
  phases: unknown[];
  criticalPath: boolean;
  slackDistribution: unknown;
  riskAreas: unknown[];
}

export interface ResourceUtilization {
  overallUtilization: number;
  byResource: unknown[];
  byPeriod: unknown[];
  conflicts: ResourceConflict[];
  optimization: unknown[];
  forecasts: unknown[];
}

export interface ResourceConflict {
  resourceId: string;
  conflictType: 'overallocation' | 'skill_mismatch' | 'availability' | 'location';
  severity: 'low' | 'medium' | 'high' | 'critical';
  affectedTasks: string[];
  startDate: string;
  endDate: string;
  resolution: unknown[];
}

export interface TimelineImpactAnalysis {
  scope: 'task' | 'phase' | 'project';
  affectedItems: string[];
  durationImpact: number;
  costImpact: number;
  resourceImpact: unknown[];
  milestoneImpact: unknown[];
  riskImpact: unknown[];
  recommendations: unknown[];
}

export interface TimelineFeasibility {
  overallFeasibility: 'high' | 'medium' | 'low' | 'not_feasible';
  durationFeasibility: unknown;
  resourceFeasibility: unknown;
  dependencyFeasibility: unknown;
  constraintFeasibility: unknown;
  riskFeasibility: unknown;
  recommendations: unknown[];
}

export interface TimelineOptimization {
  currentDuration: number;
  optimizedDuration: number;
  savings: number;
  optimizations: unknown[];
  tradeoffs: unknown[];
  alternatives: TimelineAlternative[];
  recommendations: unknown[];
}

export interface TimelineAlternative {
  id: string;
  name: string;
  description: string;
  duration: number;
  cost: number;
  risk: string;
  feasibility: string;
  advantages: string[];
  disadvantages: string[];
  recommendation: 'recommended' | 'viable' | 'not_recommended';
}

export interface TimelineRiskFactor {
  factor: string;
  impact: 'low' | 'medium' | 'high' | 'critical';
  probability: number;
  description: string;
  mitigation: string;
}

export interface ResourceAvailability {
  resourceId: string;
  resourceName: string;
  type: string;
  capacity: number;
  periods: unknown[];
  constraints: string[];
  cost: number;
}

export interface TimelineResource {
  id: string;
  name: string;
  type: 'human' | 'equipment' | 'material' | 'facility' | 'external';
  capacity: number;
  availability: unknown[];
  cost: unknown;
  skills: string[];
  location: string;
  calendar: WorkingCalendar;
  constraints: unknown[];
  assignments: unknown[];
}

export interface ResourceImpact {
  resourceId: string;
  impactType: 'allocation' | 'utilization' | 'cost' | 'availability';
  currentValue: number;
  newValue: number;
  variance: number;
  description: string;
}