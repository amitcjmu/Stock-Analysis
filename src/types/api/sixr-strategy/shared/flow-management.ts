/**
 * 6R Strategy Flow Management Types
 * 
 * Common flow management types for all 6R strategy implementations.
 * Provides standardized interfaces for flow initialization, status tracking,
 * progress monitoring, and lifecycle management.
 * 
 * Generated by CC (Claude Code) - 6R Strategy Type Modularization
 */

import type {
  BaseApiRequest,
  BaseApiResponse,
  ListRequest,
  ListResponse,
  GetRequest,
  GetResponse,
  UpdateRequest,
  UpdateResponse,
  MultiTenantContext
} from '../../shared';

import type { StrategyFlowData, StrategyType, StrategyFlowStatus, StrategyScope, StrategyPhases, PhaseDefinition, PhaseStatus, TimeRange, Stakeholder, Dependency, ApprovalRequirement, RiskAssessment, ExecutionPlan } from './base-types'
import { PriorityLevel } from './base-types'

// Base Flow Initialization Types
export interface InitializeStrategyFlowRequest extends BaseApiRequest {
  flowName: string;
  flowDescription?: string;
  strategyType: StrategyType;
  context: MultiTenantContext;
  scope: StrategyScope;
  configuration?: StrategyFlowConfiguration;
  parentFlowId?: string;
  metadata?: Record<string, unknown>;
}

export interface InitializeStrategyFlowResponse extends BaseApiResponse<StrategyFlowData> {
  data: StrategyFlowData;
  flowId: string;
  initialState: StrategyFlowState;
  nextSteps: string[];
  recommendations?: string[];
}

export interface StrategyFlowConfiguration {
  automated: boolean;
  parallelExecution: boolean;
  continuousMonitoring: boolean;
  riskTolerance: 'low' | 'medium' | 'high';
  complianceRequired: boolean;
  reportingFrequency: 'real_time' | 'daily' | 'weekly' | 'monthly';
  notificationSettings: NotificationSettings;
  integrations: IntegrationConfig[];
  customRules: CustomRule[];
}

export interface NotificationSettings {
  enabled: boolean;
  channels: NotificationChannel[];
  recipients: NotificationRecipient[];
  events: NotificationEvent[];
  templates: NotificationTemplate[];
}

export interface NotificationChannel {
  type: 'email' | 'slack' | 'teams' | 'webhook' | 'sms';
  configuration: Record<string, unknown>;
  enabled: boolean;
  fallback?: string;
}

export interface NotificationRecipient {
  type: 'user' | 'role' | 'group' | 'external';
  identifier: string;
  channels: string[];
  preferences: NotificationPreferences;
}

export interface NotificationPreferences {
  frequency: 'immediate' | 'digest' | 'weekly';
  events: string[];
  quietHours?: QuietHours;
  timezone: string;
}

export interface QuietHours {
  enabled: boolean;
  start: string;
  end: string;
  days: string[];
}

export interface NotificationEvent {
  type: string;
  enabled: boolean;
  channels: string[];
  recipients: string[];
  template?: string;
}

export interface NotificationTemplate {
  id: string;
  name: string;
  type: string;
  format: 'text' | 'html' | 'markdown';
  subject: string;
  content: string;
  variables: string[];
}

export interface IntegrationConfig {
  type: 'ci_cd' | 'monitoring' | 'ticketing' | 'approval' | 'reporting';
  name: string;
  configuration: Record<string, unknown>;
  enabled: boolean;
  endpoints: IntegrationEndpoint[];
}

export interface IntegrationEndpoint {
  name: string;
  url: string;
  method: 'GET' | 'POST' | 'PUT' | 'DELETE';
  authentication: EndpointAuth;
  headers?: Record<string, string>;
}

export interface EndpointAuth {
  type: 'none' | 'basic' | 'bearer' | 'api_key' | 'oauth';
  credentials: Record<string, unknown>;
}

export interface CustomRule {
  id: string;
  name: string;
  type: 'validation' | 'approval' | 'routing' | 'escalation';
  condition: string;
  action: string;
  parameters: Record<string, unknown>;
  enabled: boolean;
}

// Flow State Management
export interface StrategyFlowState {
  flowId: string;
  currentPhase: string;
  nextPhase?: string;
  phaseCompletion: Record<string, boolean>;
  phaseResults: Record<string, unknown>;
  strategyResults: Record<string, unknown>;
  riskProfile: RiskAssessment;
  approvalStatus: ApprovalStatus;
  blockers: StrategyBlocker[];
  warnings: StrategyWarning[];
  recommendations: StrategyRecommendation[];
  metrics: StrategyMetrics;
  createdAt: string;
  updatedAt: string;
}

export interface ApprovalStatus {
  overall: 'not_required' | 'pending' | 'approved' | 'rejected' | 'conditional';
  approvals: ApprovalStatusDetail[];
  blockers: string[];
  conditions: string[];
}

export interface ApprovalStatusDetail {
  approvalId: string;
  type: string;
  status: string;
  approver: string;
  requestedAt: string;
  respondedAt?: string;
  comments?: string;
}

export interface StrategyBlocker {
  id: string;
  type: 'dependency' | 'approval' | 'resource' | 'technical' | 'business';
  description: string;
  severity: 'low' | 'medium' | 'high' | 'critical';
  impact: string;
  owner: string;
  resolution: BlockerResolution;
  createdAt: string;
}

export interface BlockerResolution {
  approach: string;
  estimatedResolution: string;
  resources: string[];
  alternatives: string[];
  escalation: string[];
}

export interface StrategyWarning {
  id: string;
  type: 'risk' | 'quality' | 'timeline' | 'budget' | 'dependency';
  message: string;
  severity: 'low' | 'medium' | 'high';
  impact: string;
  recommendation: string;
  acknowledged: boolean;
  createdAt: string;
}

export interface StrategyRecommendation {
  id: string;
  type: 'optimization' | 'risk_mitigation' | 'process_improvement' | 'cost_saving';
  title: string;
  description: string;
  rationale: string;
  effort: 'low' | 'medium' | 'high';
  impact: 'low' | 'medium' | 'high';
  priority: PriorityLevel;
  category: string;
  implementation: RecommendationImplementation;
  status: 'new' | 'considered' | 'accepted' | 'rejected' | 'implemented';
}

export interface RecommendationImplementation {
  approach: string;
  timeline: string;
  resources: string[];
  dependencies: string[];
  risks: string[];
  success_criteria: string[];
}

export interface StrategyMetrics {
  progress: ProgressMetrics;
  quality: QualityMetrics;
  performance: PerformanceMetrics;
  cost: CostMetrics;
  risk: RiskMetrics;
}

export interface ProgressMetrics {
  overall: number;
  byPhase: Record<string, number>;
  tasksCompleted: number;
  tasksTotal: number;
  milestonesAchieved: number;
  milestonesTotal: number;
  onTrack: boolean;
  daysRemaining: number;
}

export interface QualityMetrics {
  overallScore: number;
  gatesPassed: number;
  gatesTotal: number;
  defectCount: number;
  reworkRate: number;
  complianceScore: number;
  testCoverage: number;
}

export interface PerformanceMetrics {
  throughput: number;
  efficiency: number;
  resourceUtilization: number;
  cycleTime: string;
  leadTime: string;
  velocity: number;
}

export interface CostMetrics {
  budgeted: number;
  actual: number;
  forecast: number;
  variance: number;
  utilizationRate: number;
  costPerDeliverable: number;
  roi: number;
}

export interface RiskMetrics {
  overallScore: number;
  openRisks: number;
  criticalRisks: number;
  mitigatedRisks: number;
  newRisksThisPeriod: number;
  riskVelocity: number;
}

// Flow Status and Progress Types
export interface GetStrategyFlowStatusRequest extends GetRequest {
  flowId: string;
  includeDetails?: boolean;
  includeAnalytics?: boolean;
  includeRecommendations?: boolean;
  includeRisks?: boolean;
  includeApprovals?: boolean;
  includeMetrics?: boolean;
}

export interface GetStrategyFlowStatusResponse extends BaseApiResponse<StrategyStatusDetail> {
  data: StrategyStatusDetail;
  realTimeUpdates?: boolean;
  nextRefresh?: string;
  analytics?: StrategyAnalytics;
}

export interface StrategyStatusDetail {
  flowId: string;
  strategyType: StrategyType;
  status: StrategyFlowStatus;
  progress: StrategyProgress;
  currentPhase: string;
  phaseDetails: PhaseStatusDetail[];
  blockers: StrategyBlocker[];
  warnings: StrategyWarning[];
  recommendations: StrategyRecommendation[];
  approvals: ApprovalStatusDetail[];
  metrics: StrategyMetrics;
  nextActions: NextAction[];
  lastUpdated: string;
}

export interface StrategyProgress {
  overall: number;
  phases: PhaseProgress[];
  milestones: MilestoneProgress[];
  timeline: TimelineProgress;
  quality: QualityProgress;
}

export interface PhaseProgress {
  phaseId: string;
  name: string;
  status: PhaseStatus;
  progress: number;
  startDate?: string;
  endDate?: string;
  estimatedCompletion?: string;
  tasks: TaskProgress[];
}

export interface TaskProgress {
  taskId: string;
  name: string;
  status: 'not_started' | 'in_progress' | 'completed' | 'blocked' | 'cancelled';
  progress: number;
  assignee: string;
  estimatedCompletion?: string;
}

export interface MilestoneProgress {
  milestoneId: string;
  name: string;
  date: string;
  status: 'upcoming' | 'at_risk' | 'achieved' | 'missed';
  criteria: MilestoneCriteria[];
}

export interface MilestoneCriteria {
  criterion: string;
  status: 'pending' | 'met' | 'failed';
  evidence?: string;
}

export interface TimelineProgress {
  startDate: string;
  endDate: string;
  currentDate: string;
  percentageComplete: number;
  onTrack: boolean;
  variance: string;
  critical_path: string[];
}

export interface QualityProgress {
  overallScore: number;
  gates: QualityGateProgress[];
  metrics: QualityMetricProgress[];
  issues: QualityIssue[];
}

export interface QualityGateProgress {
  gateId: string;
  name: string;
  status: 'pending' | 'passed' | 'failed' | 'conditional';
  score: number;
  criteria: QualityCriteriaProgress[];
}

export interface QualityCriteriaProgress {
  criterion: string;
  target: number;
  actual: number;
  status: 'met' | 'failed' | 'at_risk';
}

export interface QualityMetricProgress {
  metric: string;
  target: number;
  actual: number;
  trend: 'improving' | 'stable' | 'degrading';
  status: 'on_target' | 'at_risk' | 'off_target';
}

export interface QualityIssue {
  id: string;
  type: 'defect' | 'non_compliance' | 'standard_violation' | 'process_deviation';
  description: string;
  severity: 'low' | 'medium' | 'high' | 'critical';
  impact: string;
  resolution: string;
  status: 'open' | 'in_progress' | 'resolved' | 'deferred';
}

export interface PhaseStatusDetail {
  phaseId: string;
  name: string;
  status: PhaseStatus;
  progress: number;
  startDate?: string;
  endDate?: string;
  duration: string;
  deliverables: DeliverableStatus[];
  approvals: ApprovalStatusDetail[];
  risks: string[];
  issues: string[];
}

export interface DeliverableStatus {
  name: string;
  type: string;
  status: 'not_started' | 'in_progress' | 'under_review' | 'completed' | 'approved';
  dueDate: string;
  owner: string;
  quality: number;
}

export interface NextAction {
  id: string;
  type: 'task' | 'approval' | 'decision' | 'review' | 'escalation';
  description: string;
  priority: PriorityLevel;
  dueDate?: string;
  assignee: string;
  dependencies: string[];
}

// Flow Listing and Analytics
export interface ListStrategyFlowsRequest extends ListRequest {
  strategyTypes?: StrategyType[];
  status?: StrategyFlowStatus[];
  priorities?: PriorityLevel[];
  phases?: string[];
  clientAccountIds?: string[];
  engagementIds?: string[];
  dateRange?: {
    start: string;
    end: string;
    field: 'created' | 'updated' | 'completed' | 'started';
  };
  includeArchived?: boolean;
  includeMetrics?: boolean;
}

export interface ListStrategyFlowsResponse extends ListResponse<StrategyFlowSummary> {
  data: StrategyFlowSummary[];
  aggregations?: StrategyAggregation[];
  trends?: StrategyTrend[];
  portfolioMetrics?: StrategyPortfolioMetrics;
}

export interface StrategyFlowSummary {
  id: string;
  flowId: string;
  flowName: string;
  strategyType: StrategyType;
  status: StrategyFlowStatus;
  progress: number;
  priority: PriorityLevel;
  currentPhase: string;
  riskLevel: string;
  estimatedCompletion?: string;
  createdAt: string;
  updatedAt: string;
}

export interface StrategyAggregation {
  dimension: string;
  values: AggregationValue[];
  total: number;
}

export interface AggregationValue {
  key: string;
  count: number;
  percentage: number;
  metrics?: Record<string, number>;
}

export interface StrategyTrend {
  metric: string;
  period: string;
  values: TrendDataPoint[];
  trend: 'increasing' | 'decreasing' | 'stable';
  forecast?: TrendDataPoint[];
}

export interface TrendDataPoint {
  period: string;
  value: number;
  change?: number;
  changePercentage?: number;
}

export interface StrategyPortfolioMetrics {
  totalFlows: number;
  activeFlows: number;
  completedFlows: number;
  averageProgress: number;
  onTrackPercentage: number;
  riskDistribution: Record<string, number>;
  costMetrics: PortfolioCostMetrics;
  performanceMetrics: PortfolioPerformanceMetrics;
}

export interface PortfolioCostMetrics {
  totalBudget: number;
  totalActual: number;
  totalForecast: number;
  averageVariance: number;
  costByStrategy: Record<string, number>;
}

export interface PortfolioPerformanceMetrics {
  averageCycleTime: string;
  throughput: number;
  successRate: number;
  qualityScore: number;
  riskScore: number;
}

// Flow Update Operations
export interface UpdateStrategyFlowRequest extends UpdateRequest<Partial<StrategyFlowData>> {
  flowId: string;
  data: Partial<StrategyFlowData>;
  validateTransition?: boolean;
  skipValidation?: boolean;
  updateMetrics?: boolean;
  triggerNotifications?: boolean;
}

export interface UpdateStrategyFlowResponse extends UpdateResponse<StrategyFlowData> {
  data: StrategyFlowData;
  transitionResult?: StrategyTransitionResult;
  validationResults?: StrategyValidationResult[];
  notifications?: NotificationResult[];
}

export interface StrategyTransitionResult {
  fromPhase: string;
  toPhase: string;
  success: boolean;
  validationsPassed: string[];
  validationsFailed: string[];
  warnings: string[];
  nextActions: string[];
}

export interface StrategyValidationResult {
  rule: string;
  status: 'passed' | 'failed' | 'warning';
  message: string;
  data?: unknown;
}

export interface NotificationResult {
  channel: string;
  recipient: string;
  status: 'sent' | 'failed' | 'queued';
  message?: string;
}

// Analytics and Insights
export interface StrategyAnalytics {
  summary: AnalyticsSummary;
  trends: AnalyticsTrend[];
  benchmarks: AnalyticsBenchmark[];
  insights: AnalyticsInsight[];
  predictions: AnalyticsPrediction[];
  correlations: AnalyticsCorrelation[];
}

export interface AnalyticsSummary {
  totalFlows: number;
  avgDuration: string;
  successRate: number;
  commonBlockers: string[];
  topRisks: string[];
  costEfficiency: number;
}

export interface AnalyticsTrend {
  metric: string;
  direction: 'up' | 'down' | 'stable';
  magnitude: number;
  significance: 'low' | 'medium' | 'high';
  timeframe: string;
}

export interface AnalyticsBenchmark {
  metric: string;
  current: number;
  benchmark: number;
  percentile: number;
  industry: string;
  comparison: 'above' | 'at' | 'below';
}

export interface AnalyticsInsight {
  type: 'opportunity' | 'risk' | 'trend' | 'anomaly';
  title: string;
  description: string;
  impact: 'low' | 'medium' | 'high';
  confidence: number;
  actionable: boolean;
  recommendations: string[];
}

export interface AnalyticsPrediction {
  metric: string;
  horizon: string;
  prediction: number;
  confidence: number;
  factors: string[];
  scenarios: PredictionScenario[];
}

export interface PredictionScenario {
  name: string;
  probability: number;
  outcome: number;
  factors: string[];
}

export interface AnalyticsCorrelation {
  metricA: string;
  metricB: string;
  correlation: number;
  strength: 'weak' | 'moderate' | 'strong';
  significance: number;
}