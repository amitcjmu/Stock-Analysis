/**
 * Observability Logging Search and Analytics Types
 * 
 * Type definitions for log search, analytics, pattern detection,
 * anomaly detection, and insights generation.
 * 
 * Generated by CC (Claude Code) - Modularized from logging-types.ts
 */

import type {
  BaseApiRequest,
  BaseApiResponse,
  MultiTenantContext
} from '../../shared';

// Log Search APIs
export interface SearchLogsRequest extends BaseApiRequest {
  flowId?: string;
  query: string;
  timeRange: {
    start: string;
    end: string;
  };
  logLevel?: LogLevel[];
  sources?: string[];
  limit?: number;
  offset?: number;
  highlight?: boolean;
  context: MultiTenantContext;
}

export interface SearchLogsResponse extends BaseApiResponse<LogSearchResult> {
  data: LogSearchResult;
  searchId: string;
  totalHits: number;
  logs: LogEntry[];
  aggregations: LogAggregation[];
  highlights: LogHighlight[];
}

// Log Analytics APIs
export interface GetLogAnalyticsRequest extends BaseApiRequest {
  flowId?: string;
  timeRange: {
    start: string;
    end: string;
  };
  analysisType: 'patterns' | 'anomalies' | 'trends' | 'errors' | 'performance';
  logLevel?: LogLevel[];
  sources?: string[];
  groupBy?: string[];
  context: MultiTenantContext;
}

export interface GetLogAnalyticsResponse extends BaseApiResponse<LogAnalytics> {
  data: LogAnalytics;
  patterns: LogPattern[];
  anomalies: LogAnomaly[];
  trends: LogTrend[];
  insights: LogInsight[];
}

// Core Types
export type LogLevel = 'trace' | 'debug' | 'info' | 'warn' | 'error' | 'fatal';

// Search Result Types
export interface LogSearchResult {
  query: string;
  totalHits: number;
  took: number;
  timedOut: boolean;
  maxScore: number;
  searchAfter?: Array<string | number>;
}

export interface LogEntry {
  id: string;
  timestamp: string;
  level: LogLevel;
  message: string;
  source: string;
  fields: Record<string, string | number | boolean | null>;
  tags: Record<string, string>;
  score?: number;
  highlight?: Record<string, string[]>;
}

export interface LogAggregation {
  name: string;
  type: 'terms' | 'date_histogram' | 'range' | 'stats' | 'cardinality';
  buckets: AggregationBucket[];
  value?: number;
}

export interface AggregationBucket {
  key: string;
  docCount: number;
  subAggregations?: Record<string, LogAggregation>;
}

export interface LogHighlight {
  field: string;
  fragments: string[];
}

// Analytics Types
export interface LogAnalytics {
  summary: LogSummary;
  distribution: LogDistribution;
  topSources: TopSource[];
  errorAnalysis: ErrorAnalysis;
  performanceMetrics: LogPerformanceMetrics;
}

export interface LogSummary {
  totalLogs: number;
  logsByLevel: Record<LogLevel, number>;
  logsBySource: Record<string, number>;
  timeRange: string;
  averageLogsPerSecond: number;
  errorRate: number;
}

export interface LogDistribution {
  temporal: TemporalDistribution[];
  levelDistribution: LevelDistribution[];
  sourceDistribution: SourceDistribution[];
}

export interface TemporalDistribution {
  timestamp: string;
  count: number;
  levels: Record<LogLevel, number>;
}

export interface LevelDistribution {
  level: LogLevel;
  count: number;
  percentage: number;
}

export interface SourceDistribution {
  source: string;
  count: number;
  percentage: number;
}

export interface TopSource {
  source: string;
  count: number;
  percentage: number;
  errorRate: number;
  averageSize: number;
}

export interface ErrorAnalysis {
  totalErrors: number;
  errorRate: number;
  topErrors: TopError[];
  errorTrends: ErrorTrend[];
  errorPatterns: ErrorPattern[];
}

export interface TopError {
  message: string;
  count: number;
  sources: string[];
  firstSeen: string;
  lastSeen: string;
}

export interface ErrorTrend {
  period: string;
  count: number;
  rate: number;
  change: number;
}

export interface ErrorPattern {
  pattern: string;
  count: number;
  sources: string[];
  example: string;
}

export interface LogPerformanceMetrics {
  ingestionRate: number;
  processingLatency: number;
  indexingRate: number;
  queryLatency: number;
  storageUtilization: number;
}

// Pattern Detection Types
export interface LogPattern {
  id: string;
  pattern: string;
  template: string;
  frequency: number;
  examples: string[];
  fields: PatternField[];
  confidence: number;
  firstSeen: string;
  lastSeen: string;
}

export interface PatternField {
  name: string;
  type: 'string' | 'number' | 'date' | 'ip' | 'email' | 'url';
  examples: string[];
  cardinality: number;
}

// Anomaly Detection Types
export interface LogAnomaly {
  id: string;
  type: 'volume' | 'pattern' | 'field' | 'timing' | 'sequence';
  description: string;
  severity: 'low' | 'medium' | 'high' | 'critical';
  confidence: number;
  startTime: string;
  endTime?: string;
  affectedLogs: number;
  baseline: AnomalyBaseline;
  deviation: AnomalyDeviation;
  context: AnomalyContext;
}

export interface AnomalyBaseline {
  metric: string;
  value: number;
  period: string;
  confidence: number;
}

export interface AnomalyDeviation {
  actual: number;
  expected: number;
  standardDeviations: number;
  percentage: number;
}

export interface AnomalyContext {
  relatedEvents: string[];
  systemMetrics: Record<string, number>;
  correlations: AnomalyCorrelation[];
}

export interface AnomalyCorrelation {
  metric: string;
  correlation: number;
  pValue: number;
}

// Trend Analysis Types
export interface LogTrend {
  metric: string;
  period: string;
  direction: 'increasing' | 'decreasing' | 'stable' | 'volatile';
  rate: number;
  significance: 'low' | 'medium' | 'high';
  forecast: TrendForecast;
}

export interface TrendForecast {
  nextPeriod: number;
  confidence: number;
  bounds: {
    upper: number;
    lower: number;
  };
}

// Insights Types
export interface LogInsight {
  id: string;
  type: 'optimization' | 'anomaly' | 'pattern' | 'correlation' | 'recommendation';
  title: string;
  description: string;
  impact: 'low' | 'medium' | 'high';
  confidence: number;
  actionable: boolean;
  suggestions: string[];
  evidence: InsightEvidence[];
}

export interface InsightEvidence {
  type: 'metric' | 'pattern' | 'correlation' | 'threshold';
  description: string;
  value: string | number | boolean | Record<string, unknown>;
  confidence: number;
}

// Advanced Analytics Types
export interface LogCorrelationAnalysis {
  correlations: LogCorrelation[];
  timeWindows: string[];
  confidenceLevel: number;
  method: 'pearson' | 'spearman' | 'kendall';
}

export interface LogCorrelation {
  sourceA: string;
  sourceB: string;
  correlation: number;
  pValue: number;
  timelag: string;
  significance: 'low' | 'medium' | 'high';
}

export interface LogSequenceAnalysis {
  sequences: LogSequence[];
  patterns: SequencePattern[];
  transitions: SequenceTransition[];
}

export interface LogSequence {
  id: string;
  events: SequenceEvent[];
  duration: string;
  frequency: number;
  variance: number;
}

export interface SequenceEvent {
  order: number;
  timestamp: string;
  event: string;
  source: string;
  properties: Record<string, string | number | boolean | null>;
}

export interface SequencePattern {
  pattern: string;
  frequency: number;
  averageDuration: string;
  variance: number;
  examples: string[];
}

export interface SequenceTransition {
  from: string;
  to: string;
  probability: number;
  averageDelay: string;
  frequency: number;
}

// Machine Learning Types
export interface LogMLModel {
  id: string;
  name: string;
  type: 'classification' | 'clustering' | 'anomaly_detection' | 'forecasting';
  status: 'training' | 'ready' | 'deployed' | 'retired';
  algorithm: string;
  features: string[];
  accuracy: number;
  precision: number;
  recall: number;
  f1Score: number;
  trainingData: MLTrainingData;
  hyperparameters: Record<string, string | number | boolean | null>;
  lastTrained: string;
  version: string;
}

export interface MLTrainingData {
  timeRange: {
    start: string;
    end: string;
  };
  sources: string[];
  sampleSize: number;
  features: MLFeature[];
  labels?: MLLabel[];
}

export interface MLFeature {
  name: string;
  type: 'categorical' | 'numerical' | 'text' | 'timestamp';
  importance: number;
  distribution: FeatureDistribution;
}

export interface FeatureDistribution {
  min?: number;
  max?: number;
  mean?: number;
  median?: number;
  stdDev?: number;
  categories?: CategoryCount[];
}

export interface CategoryCount {
  category: string;
  count: number;
  percentage: number;
}

export interface MLLabel {
  name: string;
  type: string;
  distribution: Record<string, number>;
}

export interface LogMLPrediction {
  id: string;
  modelId: string;
  input: Record<string, unknown>;
  prediction: string | number | boolean | Record<string, unknown>;
  confidence: number;
  probability?: number;
  timestamp: string;
  features: PredictionFeature[];
}

export interface PredictionFeature {
  name: string;
  value: string | number | boolean;
  importance: number;
  contribution: number;
}

// Alerting Types
export interface LogAlert {
  id: string;
  name: string;
  type: 'threshold' | 'anomaly' | 'pattern' | 'trend';
  condition: AlertCondition;
  severity: 'info' | 'warning' | 'error' | 'critical';
  status: 'active' | 'suppressed' | 'resolved';
  triggeredAt: string;
  resolvedAt?: string;
  count: number;
  lastTriggered: string;
  acknowledgments: AlertAcknowledgment[];
}

export interface AlertCondition {
  query: string;
  threshold?: number;
  operator?: string;
  timeWindow: string;
  frequency: string;
  groupBy?: string[];
}

export interface AlertAcknowledgment {
  user: string;
  timestamp: string;
  comment?: string;
  duration?: string;
}