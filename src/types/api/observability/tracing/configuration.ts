/**
 * Tracing Configuration Types
 * 
 * Distributed tracing configuration including instrumentation, sampling,
 * collection, storage, and analysis settings.
 * 
 * Generated by CC - Claude Code
 */

import type { BaseMetadata, AuditableMetadata } from '../../../shared/metadata-types';
import {
  BaseApiRequest,
  CreateRequest,
  CreateResponse
} from '../../shared';

// Tracing Configuration API
export interface ConfigureTracingRequest extends CreateRequest<TracingConfigurationData> {
  flowId: string;
  data: TracingConfigurationData;
  tracingType: 'distributed' | 'application' | 'infrastructure' | 'business';
  instrumentation: InstrumentationConfig;
  sampling: SamplingConfig;
  collection: TraceCollectionConfig;
  storage: TraceStorageConfig;
  analysis: TraceAnalysisConfig;
}

export interface ConfigureTracingResponse extends CreateResponse<TracingConfiguration> {
  data: TracingConfiguration;
  configurationId: string;
  instrumentationPlan: InstrumentationPlan;
  estimatedOverhead: PerformanceOverhead;
  estimatedVolume: TraceVolumeEstimate;
}

// Core Configuration
export interface TracingConfigurationData {
  name: string;
  description?: string;
  environment: string;
  version: string;
  settings: TracingSettings;
  tags: Record<string, string>;
  metadata: AuditableMetadata;
}

export interface TracingConfiguration {
  id: string;
  configurationId: string;
  name: string;
  description?: string;
  type: 'distributed' | 'application' | 'infrastructure' | 'business';
  environment: string;
  version: string;
  instrumentation: InstrumentationConfig;
  sampling: SamplingConfig;
  collection: TraceCollectionConfig;
  storage: TraceStorageConfig;
  analysis: TraceAnalysisConfig;
  status: 'draft' | 'validated' | 'deployed' | 'active' | 'inactive';
  createdAt: string;
  updatedAt: string;
  deployedAt?: string;
}

export interface TracingSettings {
  enableProfiling: boolean;
  enableMetrics: boolean;
  enableLogging: boolean;
  resourceDetection: boolean;
  propagators: string[];
  maxAttributeLength: number;
  maxEventCount: number;
  maxLinkCount: number;
}

// Instrumentation Configuration
export interface InstrumentationConfig {
  automatic: AutoInstrumentationConfig;
  manual: ManualInstrumentationConfig;
  libraries: InstrumentationLibrary[];
  frameworks: FrameworkConfig[];
  customInstrumentation: CustomInstrumentation[];
}

export interface AutoInstrumentationConfig {
  enabled: boolean;
  languages: string[];
  frameworks: string[];
  libraries: string[];
  configuration: BaseMetadata;
}

export interface ManualInstrumentationConfig {
  enabled: boolean;
  sdks: SDKConfig[];
  customSpans: CustomSpanConfig[];
  propagation: PropagationConfig;
}

export interface InstrumentationLibrary {
  name: string;
  version: string;
  language: string;
  framework?: string;
  configuration: BaseMetadata;
  enabled: boolean;
}

export interface FrameworkConfig {
  name: string;
  version: string;
  instrumentation: BaseMetadata;
  filters: InstrumentationFilter[];
  customization: FrameworkCustomization;
}

export interface CustomInstrumentation {
  id: string;
  name: string;
  type: 'span' | 'metric' | 'log' | 'event';
  trigger: InstrumentationTrigger;
  configuration: BaseMetadata;
  enabled: boolean;
}

// Sampling Configuration
export interface SamplingConfig {
  strategy: 'head' | 'tail' | 'probabilistic' | 'rate_limiting' | 'adaptive';
  rate: number;
  maxTracesPerSecond?: number;
  rules: SamplingRule[];
  configuration: SamplingConfiguration;
}

export interface SamplingRule {
  id: string;
  name: string;
  priority: number;
  conditions: SamplingCondition[];
  action: SamplingAction;
  enabled: boolean;
}

export interface SamplingConfiguration {
  parentBased: boolean;
  traceIdRatioBasedRate?: number;
  maxTracesPerSecond?: number;
  adaptiveConfig?: AdaptiveSamplingConfig;
}

// Collection Configuration
export interface TraceCollectionConfig {
  receivers: TraceReceiver[];
  processors: TraceProcessor[];
  exporters: TraceExporter[];
  pipelines: TracePipeline[];
  reliability: TraceReliabilityConfig;
}

export interface TraceReceiver {
  type: 'jaeger' | 'zipkin' | 'otlp' | 'opencensus' | 'custom';
  protocol: string;
  endpoint: string;
  configuration: ReceiverConfiguration;
  authentication?: ReceiverAuthentication;
}

export interface TraceProcessor {
  type: 'batch' | 'memory_limiter' | 'resource' | 'span' | 'probabilistic_sampler';
  configuration: ProcessorConfiguration;
  order: number;
}

export interface TraceExporter {
  type: 'jaeger' | 'zipkin' | 'otlp' | 'logging' | 'file' | 'prometheus';
  configuration: ExporterConfiguration;
  authentication?: ExporterAuthentication;
  batching?: ExporterBatching;
}

export interface TracePipeline {
  name: string;
  receivers: string[];
  processors: string[];
  exporters: string[];
  configuration: PipelineConfiguration;
}

export interface TraceReliabilityConfig {
  retries: number;
  timeout: string;
  backoff: BackoffConfiguration;
  circuitBreaker: CircuitBreakerConfig;
  deadLetterQueue: boolean;
}

// Storage Configuration
export interface TraceStorageConfig {
  backend: 'jaeger' | 'zipkin' | 'tempo' | 'elasticsearch' | 'clickhouse' | 'bigquery';
  configuration: TraceStorageConfiguration;
  retention: TraceRetentionPolicy;
  indexing: TraceIndexingConfig;
  compression: TraceCompressionConfig;
}

export interface TraceStorageConfiguration {
  hosts: string[];
  authentication?: StorageAuthentication;
  connection: StorageConnectionConfig;
  performance: StoragePerformanceConfig;
  backup: StorageBackupConfig;
}

export interface TraceRetentionPolicy {
  hotStorage: string;
  warmStorage: string;
  coldStorage: string;
  deletion: string;
  archival?: TraceArchivalConfig;
}

export interface TraceIndexingConfig {
  strategy: 'service' | 'operation' | 'tag' | 'time' | 'composite';
  fields: IndexedField[];
  optimization: IndexOptimization;
  maintenance: IndexMaintenance;
}

export interface TraceCompressionConfig {
  enabled: boolean;
  algorithm: 'gzip' | 'lz4' | 'snappy' | 'zstd';
  level: number;
  threshold: number;
}

// Analysis Configuration
export interface TraceAnalysisConfig {
  enabled: boolean;
  realtime: boolean;
  batchProcessing: BatchProcessingConfig;
  anomalyDetection: AnomalyDetectionConfig;
  performance: PerformanceAnalysisConfig;
  dependencies: DependencyAnalysisConfig;
}

export interface BatchProcessingConfig {
  enabled: boolean;
  batchSize: number;
  interval: string;
  parallelism: number;
  timeout: string;
}

export interface AnomalyDetectionConfig {
  enabled: boolean;
  algorithms: string[];
  sensitivity: 'low' | 'medium' | 'high';
  baseline: BaselineConfig;
  alerting: AnomalyAlertingConfig;
}

export interface PerformanceAnalysisConfig {
  enabled: boolean;
  metrics: string[];
  thresholds: PerformanceThreshold[];
  trending: TrendingConfig;
  benchmarking: BenchmarkingConfig;
}

export interface DependencyAnalysisConfig {
  enabled: boolean;
  mapping: DependencyMappingConfig;
  health: DependencyHealthConfig;
  impact: ImpactAnalysisConfig;
}

// Supporting Types
export interface InstrumentationPlan {
  phases: InstrumentationPhase[];
  dependencies: string[];
  rollout: RolloutStrategy;
  validation: ValidationStrategy;
  monitoring: InstrumentationMonitoring;
}

export interface PerformanceOverhead {
  cpu: number;
  memory: number;
  network: number;
  latency: number;
  throughputImpact: number;
  storageOverhead: number;
}

export interface TraceVolumeEstimate {
  tracesPerSecond: number;
  spansPerTrace: number;
  averageTraceSize: number;
  dailyVolume: number;
  monthlyVolume: number;
  storageRequirements: TraceStorageRequirements;
}

export interface TraceStorageRequirements {
  dailyStorage: number;
  monthlyStorage: number;
  retentionStorage: number;
  indexStorage: number;
  totalStorage: number;
  unit: string;
}

// Placeholder types (would be fully defined in implementation)
export interface SDKConfig {
  name: string;
  configuration: BaseMetadata;
}

export interface CustomSpanConfig {
  name: string;
  configuration: BaseMetadata;
}

export interface PropagationConfig {
  propagators: string[];
  configuration: BaseMetadata;
}

export interface InstrumentationFilter {
  type: string;
  criteria: BaseMetadata;
}

export interface FrameworkCustomization {
  excludes: string[];
  includes: string[];
  configuration: BaseMetadata;
}

export interface InstrumentationTrigger {
  event: string;
  conditions: BaseMetadata;
}

export interface SamplingCondition {
  field: string;
  operator: string;
  value: unknown;
}

export interface SamplingAction {
  type: 'sample' | 'drop' | 'modify';
  rate?: number;
  modifications?: BaseMetadata;
}

export interface AdaptiveSamplingConfig {
  strategy: string;
  targetTPS: number;
  lookbackDuration: string;
}

export interface ReceiverConfiguration {
  port?: number;
  maxMessageSize?: number;
  timeout?: string;
}

export interface ReceiverAuthentication {
  type: string;
  configuration: BaseMetadata;
}

export interface ProcessorConfiguration {
  batchSize?: number;
  timeout?: string;
  configuration: BaseMetadata;
}

export interface ExporterConfiguration {
  endpoint?: string;
  timeout?: string;
  compression?: string;
}

export interface ExporterAuthentication {
  type: string;
  configuration: BaseMetadata;
}

export interface ExporterBatching {
  batchSize: number;
  timeout: string;
}

export interface PipelineConfiguration {
  enabled: boolean;
  configuration: BaseMetadata;
}

export interface BackoffConfiguration {
  initialInterval: string;
  maxInterval: string;
  multiplier: number;
}

export interface CircuitBreakerConfig {
  enabled: boolean;
  failureThreshold: number;
  timeout: string;
}

export interface StorageAuthentication {
  type: string;
  configuration: BaseMetadata;
}

export interface StorageConnectionConfig {
  timeout: string;
  poolSize: number;
  retries: number;
}

export interface StoragePerformanceConfig {
  batchSize: number;
  flushInterval: string;
  compression: boolean;
}

export interface StorageBackupConfig {
  enabled: boolean;
  schedule: string;
  retention: string;
}

export interface TraceArchivalConfig {
  enabled: boolean;
  destination: string;
  schedule: string;
}

export interface IndexedField {
  name: string;
  type: string;
  searchable: boolean;
}

export interface IndexOptimization {
  strategy: string;
  schedule: string;
  configuration: BaseMetadata;
}

export interface IndexMaintenance {
  enabled: boolean;
  schedule: string;
  optimization: boolean;
}

export interface BaselineConfig {
  duration: string;
  updateFrequency: string;
  algorithm: string;
}

export interface AnomalyAlertingConfig {
  enabled: boolean;
  channels: string[];
  thresholds: BaseMetadata;
}

export interface PerformanceThreshold {
  metric: string;
  value: number;
  operator: string;
}

export interface TrendingConfig {
  enabled: boolean;
  windowSize: string;
  algorithm: string;
}

export interface BenchmarkingConfig {
  enabled: boolean;
  baseline: string;
  comparison: string[];
}

export interface DependencyMappingConfig {
  enabled: boolean;
  updateFrequency: string;
  discovery: string[];
}

export interface DependencyHealthConfig {
  enabled: boolean;
  metrics: string[];
  thresholds: BaseMetadata;
}

export interface ImpactAnalysisConfig {
  enabled: boolean;
  algorithms: string[];
  weighting: BaseMetadata;
}

export interface InstrumentationPhase {
  name: string;
  components: string[];
  timeline: string;
  dependencies: string[];
}

export interface RolloutStrategy {
  type: string;
  phases: string[];
  validation: string[];
}

export interface ValidationStrategy {
  automated: boolean;
  manual: boolean;
  criteria: string[];
}

export interface InstrumentationMonitoring {
  metrics: string[];
  alerts: string[];
  dashboards: string[];
}