/**
 * Service Mapping Types
 *
 * Service topology, dependencies, and service map visualization.
 *
 * Generated by CC - Claude Code
 */

import type {
  BaseApiRequest,
  BaseApiResponse,
  MultiTenantContext
} from '../../shared';

// Service Map API
export interface GetServiceMapRequest extends BaseApiRequest {
  flowId?: string;
  timeRange: {
    start: string;
    end: string;
  };
  services?: string[];
  includeMetrics?: boolean;
  includeHealth?: boolean;
  includeDependencies?: boolean;
  context: MultiTenantContext;
}

export interface GetServiceMapResponse extends BaseApiResponse<ServiceMap> {
  data: ServiceMap;
  services: ServiceNode[];
  dependencies: ServiceDependency[];
  metrics: ServiceMetrics[];
  healthStatus: ServiceHealth[];
}

// Service Map Types
export interface ServiceMap {
  services: ServiceNode[];
  dependencies: ServiceDependency[];
  metadata: ServiceMapMetadata;
}

export interface ServiceNode {
  id: string;
  name: string;
  type: 'service' | 'database' | 'cache' | 'queue' | 'external';
  version?: string;
  environment: string;
  namespace?: string;
  cluster?: string;
  tags: Record<string, string>;
  metadata: ServiceNodeMetadata;
}

export interface ServiceDependency {
  from: string;
  to: string;
  type: 'http' | 'grpc' | 'database' | 'message_queue' | 'cache' | 'file_system';
  protocol?: string;
  weight: number;
  metrics: DependencyMetrics;
  health: DependencyHealth;
}

export interface ServiceMetrics {
  serviceId: string;
  requestRate: number;
  errorRate: number;
  averageDuration: number;
  p50Duration: number;
  p95Duration: number;
  p99Duration: number;
  throughput: number;
  availability: number;
}

export interface ServiceHealth {
  serviceId: string;
  status: 'healthy' | 'warning' | 'critical' | 'unknown';
  score: number;
  issues: HealthIssue[];
  lastCheck: string;
  uptime: number;
}

export interface ServiceMapMetadata {
  totalServices: number;
  totalDependencies: number;
  lastUpdated: string;
  coverage: number;
  healthScore: number;
}

export interface ServiceNodeMetadata {
  instances: number;
  version: string;
  deployment: string;
  lastSeen: string;
  metrics: ServiceNodeMetrics;
}

export interface ServiceNodeMetrics {
  requestRate: number;
  errorRate: number;
  responseTime: number;
  throughput: number;
  cpuUsage: number;
  memoryUsage: number;
}

export interface DependencyMetrics {
  requestRate: number;
  errorRate: number;
  averageLatency: number;
  p99Latency: number;
  availability: number;
}

export interface DependencyHealth {
  status: 'healthy' | 'warning' | 'critical' | 'unknown';
  score: number;
  issues: DependencyIssue[];
  lastCheck: string;
}

export interface HealthIssue {
  type: 'latency' | 'errors' | 'availability' | 'throughput';
  severity: 'low' | 'medium' | 'high';
  description: string;
  threshold: number;
  actual: number;
}

export interface DependencyIssue {
  type: string;
  description: string;
  severity: 'low' | 'medium' | 'high';
  firstDetected: string;
  lastDetected: string;
}
