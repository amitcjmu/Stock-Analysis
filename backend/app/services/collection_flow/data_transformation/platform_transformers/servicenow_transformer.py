"""
ServiceNow-specific data transformation logic.

Generated by CC (Claude Code)
"""

import logging
from datetime import datetime
from typing import Any, Dict

logger = logging.getLogger(__name__)


class ServiceNowTransformer:
    """Transformer for ServiceNow-specific data formats."""

    def transform(self, data: Dict[str, Any]) -> Dict[str, Any]:
        """Transform ServiceNow specific data formats."""
        transformed = {}

        for key, value in data.items():
            # Handle ServiceNow reference fields
            if (
                isinstance(value, dict)
                and "value" in value
                and "display_value" in value
            ):
                # Use display value for human-readable fields
                transformed[key] = value.get("display_value", value.get("value"))
            # Handle ServiceNow datetime format
            elif key in ["sys_created_on", "sys_updated_on"] and isinstance(value, str):
                transformed[key] = self._parse_servicenow_datetime(value)
            else:
                transformed[key] = value

        return transformed

    def _parse_servicenow_datetime(self, datetime_str: str) -> str:
        """Parse ServiceNow datetime format to ISO format."""
        try:
            # ServiceNow format: YYYY-MM-DD HH:MM:SS
            dt = datetime.strptime(datetime_str, "%Y-%m-%d %H:%M:%S")
            return dt.isoformat()
        except ValueError:
            return datetime_str
