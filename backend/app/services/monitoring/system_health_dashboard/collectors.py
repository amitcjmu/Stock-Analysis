"""
Data collection methods for System Health Dashboard

This module contains methods for collecting system statistics and metrics
from various monitoring components.

Generated by CC (Claude Code)
"""

from typing import Any, Dict

from app.core.logging import get_logger

# Make psutil optional - not critical for core functionality
try:
    import psutil

    PSUTIL_AVAILABLE = True
except ImportError:
    PSUTIL_AVAILABLE = False

logger = get_logger(__name__)


class SystemStatsCollector:
    """Collector for system resource statistics"""

    @staticmethod
    def collect_system_stats() -> Dict[str, Any]:
        """Collect system resource statistics"""
        if not PSUTIL_AVAILABLE:
            # Return mock data when psutil is not available
            return {
                "cpu": {"usage_percent": 0.0, "core_count": 1},
                "memory": {
                    "total_bytes": 0,
                    "used_bytes": 0,
                    "available_bytes": 0,
                    "usage_percent": 0.0,
                },
                "disk_io": {
                    "read_bytes": 0,
                    "write_bytes": 0,
                    "read_count": 0,
                    "write_count": 0,
                },
                "network_io": {
                    "bytes_sent": 0,
                    "bytes_recv": 0,
                    "packets_sent": 0,
                    "packets_recv": 0,
                },
                "processes": {"count": 0},
            }

        try:
            # CPU usage
            cpu_percent = psutil.cpu_percent(interval=1)

            # Memory usage
            memory = psutil.virtual_memory()

            # Disk I/O
            disk_io = psutil.disk_io_counters()

            # Network I/O
            network_io = psutil.net_io_counters()

            # Process count
            process_count = len(psutil.pids())

            return {
                "cpu": {"usage_percent": cpu_percent, "core_count": psutil.cpu_count()},
                "memory": {
                    "total_bytes": memory.total,
                    "used_bytes": memory.used,
                    "available_bytes": memory.available,
                    "usage_percent": memory.percent,
                },
                "disk_io": {
                    "read_bytes": disk_io.read_bytes if disk_io else 0,
                    "write_bytes": disk_io.write_bytes if disk_io else 0,
                    "read_count": disk_io.read_count if disk_io else 0,
                    "write_count": disk_io.write_count if disk_io else 0,
                },
                "network_io": {
                    "bytes_sent": network_io.bytes_sent if network_io else 0,
                    "bytes_recv": network_io.bytes_recv if network_io else 0,
                    "packets_sent": network_io.packets_sent if network_io else 0,
                    "packets_recv": network_io.packets_recv if network_io else 0,
                },
                "processes": {"count": process_count},
            }
        except Exception as e:
            logger.error("Error collecting system stats: %s", e)
            return {"error": "Failed to collect system statistics"}
