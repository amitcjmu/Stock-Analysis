"""
Cache Key Generation Patterns

This module contains the main CacheKeys class with all cache key generation methods
organized by functional domains (user, flow, client, etc.).

Generated by CC (Claude Code)
"""

from .base import CACHE_VERSION


class CacheKeys:
    """
    Centralized cache key generation with versioning, tenant isolation, and coherence support.

    Design Principles:
    - All keys include CACHE_VERSION for schema evolution
    - Multi-tenant isolation via client_account_id where applicable
    - Hierarchical structure for cascade invalidation
    - Consistent naming patterns for monitoring
    - Memory-efficient key lengths
    """

    # ========================================
    # USER CONTEXT CACHING
    # ========================================

    @staticmethod
    def user_context(user_id: str) -> str:
        """
        Cache key for complete user context (client, engagement, permissions).
        TTL: 1 hour (context rarely changes)
        Invalidation: on user role changes, client/engagement assignments
        """
        return f"{CACHE_VERSION}:user:context:{user_id}"

    @staticmethod
    def user_clients(user_id: str) -> str:
        """
        Cache key for user's accessible client accounts.
        TTL: 30 minutes
        Invalidation: on user-client association changes
        """
        return f"{CACHE_VERSION}:user:{user_id}:clients"

    @staticmethod
    def user_engagements(user_id: str, client_id: str) -> str:
        """
        Cache key for user's accessible engagements within a client.
        TTL: 30 minutes
        Invalidation: on engagement creation/deletion, user permissions
        """
        return f"{CACHE_VERSION}:user:{user_id}:client:{client_id}:engagements"

    @staticmethod
    def user_active_flows(user_id: str, client_id: str, engagement_id: str) -> str:
        """
        Cache key for user's active flows in an engagement.
        TTL: 5 minutes (flows change frequently)
        Invalidation: on flow state changes
        """
        return f"{CACHE_VERSION}:user:{user_id}:client:{client_id}:engagement:{engagement_id}:active_flows"

    @staticmethod
    def user_defaults(user_id: str) -> str:
        """
        Cache key for user's default client/engagement settings.
        TTL: 2 hours
        Invalidation: on user defaults update
        """
        return f"{CACHE_VERSION}:user:{user_id}:defaults"

    # ========================================
    # FIELD MAPPING CACHING
    # ========================================

    @staticmethod
    def field_mappings(import_id: str, client_id: str) -> str:
        """
        Cache key for field mappings of a data import.
        TTL: 2 minutes (changes during review process)
        Invalidation: on mapping approval/rejection, bulk operations
        """
        return f"{CACHE_VERSION}:client:{client_id}:field_mappings:{import_id}"

    @staticmethod
    def field_mapping_stats(import_id: str, client_id: str) -> str:
        """
        Cache key for field mapping statistics (approved/pending/rejected counts).
        TTL: 1 minute
        Invalidation: on any mapping status change
        """
        return f"{CACHE_VERSION}:client:{client_id}:mapping_stats:{import_id}"

    @staticmethod
    def field_mapping_suggestions(import_id: str, client_id: str) -> str:
        """
        Cache key for AI-generated field mapping suggestions.
        TTL: 1 hour (expensive to regenerate)
        Invalidation: on schema changes, manual mapping updates
        """
        return f"{CACHE_VERSION}:client:{client_id}:mapping_suggestions:{import_id}"

    # ========================================
    # FLOW STATE CACHING
    # ========================================

    @staticmethod
    def flow_complete(flow_id: str, client_id: str, engagement_id: str) -> str:
        """
        Cache key for complete flow data with all relations.
        TTL: 5 minutes
        Invalidation: on flow state changes, phase transitions
        """
        return f"{CACHE_VERSION}:client:{client_id}:engagement:{engagement_id}:flow:complete:{flow_id}"

    @staticmethod
    def flow_metadata(flow_id: str, client_id: str, engagement_id: str) -> str:
        """
        Cache key for flow metadata (status, phase, progress).
        TTL: 2 minutes
        Invalidation: on any flow updates
        """
        return f"{CACHE_VERSION}:client:{client_id}:engagement:{engagement_id}:flow:metadata:{flow_id}"

    @staticmethod
    def flow_agent_results(flow_id: str, agent_type: str, client_id: str) -> str:
        """
        Cache key for agent execution results within a flow.
        TTL: varies by agent type (see AgentCacheStrategy)
        Invalidation: on agent re-execution, flow reset
        """
        return f"{CACHE_VERSION}:client:{client_id}:agent:{agent_type}:flow:{flow_id}:results"

    @staticmethod
    def flow_phase_data(
        flow_id: str, phase: str, client_id: str, engagement_id: str
    ) -> str:
        """
        Cache key for phase-specific data within a flow.
        TTL: 10 minutes
        Invalidation: on phase completion, data updates
        """
        return f"{CACHE_VERSION}:client:{client_id}:engagement:{engagement_id}:flow:{flow_id}:phase:{phase}"

    # ========================================
    # CLIENT AND ENGAGEMENT CACHING
    # ========================================

    @staticmethod
    def client_engagements(client_id: str) -> str:
        """
        Cache key for all engagements within a client account.
        TTL: 30 minutes
        Invalidation: on engagement creation/deletion/updates
        """
        return f"{CACHE_VERSION}:client:{client_id}:engagements"

    @staticmethod
    def client_users(client_id: str) -> str:
        """
        Cache key for all users with access to a client account.
        TTL: 15 minutes
        Invalidation: on user association changes
        """
        return f"{CACHE_VERSION}:client:{client_id}:users"

    @staticmethod
    def client_flows(client_id: str, engagement_id: str) -> str:
        """
        Cache key for all flows within an engagement.
        TTL: 10 minutes
        Invalidation: on flow creation/deletion
        """
        return f"{CACHE_VERSION}:client:{client_id}:engagement:{engagement_id}:flows"

    @staticmethod
    def client_settings(client_id: str) -> str:
        """
        Cache key for client account settings and preferences.
        TTL: 1 hour
        Invalidation: on settings updates
        """
        return f"{CACHE_VERSION}:client:{client_id}:settings"

    # ========================================
    # DATA IMPORT CACHING
    # ========================================

    @staticmethod
    def import_metadata(import_id: str, client_id: str, engagement_id: str) -> str:
        """
        Cache key for data import metadata and status.
        TTL: 5 minutes
        Invalidation: on import status changes
        """
        return f"{CACHE_VERSION}:client:{client_id}:engagement:{engagement_id}:import:{import_id}:metadata"

    @staticmethod
    def import_validation_results(import_id: str, client_id: str) -> str:
        """
        Cache key for data import validation results.
        TTL: 30 minutes (expensive to regenerate)
        Invalidation: on data changes, re-validation
        """
        return f"{CACHE_VERSION}:client:{client_id}:import:{import_id}:validation"

    @staticmethod
    def import_schema(import_id: str, client_id: str) -> str:
        """
        Cache key for detected import data schema.
        TTL: 1 hour (rarely changes after detection)
        Invalidation: on schema re-detection
        """
        return f"{CACHE_VERSION}:client:{client_id}:import:{import_id}:schema"

    # ========================================
    # ASSET INVENTORY CACHING
    # ========================================

    @staticmethod
    def asset_inventory(client_id: str, engagement_id: str) -> str:
        """
        Cache key for complete asset inventory within an engagement.
        TTL: 15 minutes
        Invalidation: on asset creation/updates/deletion
        """
        return f"{CACHE_VERSION}:client:{client_id}:engagement:{engagement_id}:assets"

    @staticmethod
    def asset_dependencies(asset_id: str, client_id: str, engagement_id: str) -> str:
        """
        Cache key for asset dependency relationships.
        TTL: 30 minutes
        Invalidation: on dependency analysis updates
        """
        return f"{CACHE_VERSION}:client:{client_id}:engagement:{engagement_id}:asset:{asset_id}:dependencies"

    @staticmethod
    def asset_recommendations(asset_id: str, client_id: str, engagement_id: str) -> str:
        """
        Cache key for SIXR recommendations for an asset.
        TTL: 4 hours (expensive analysis)
        Invalidation: on asset updates, new analysis
        """
        return f"{CACHE_VERSION}:client:{client_id}:engagement:{engagement_id}:asset:{asset_id}:recommendations"

    # ========================================
    # ADMIN AND ANALYTICS CACHING
    # ========================================

    @staticmethod
    def admin_active_users() -> str:
        """
        Cache key for admin view of all active users across platform.
        TTL: 5 minutes
        Invalidation: on user status changes
        """
        return f"{CACHE_VERSION}:admin:active_users"

    @staticmethod
    def admin_pending_approvals() -> str:
        """
        Cache key for admin view of pending user/client approvals.
        TTL: 2 minutes
        Invalidation: on approval status changes
        """
        return f"{CACHE_VERSION}:admin:pending_approvals"

    @staticmethod
    def client_analytics(client_id: str, metric: str, period: str) -> str:
        """
        Cache key for client analytics and metrics.
        TTL: 30 minutes for hourly, 6 hours for daily
        Invalidation: on metric recalculation
        """
        return f"{CACHE_VERSION}:client:{client_id}:analytics:{metric}:{period}"

    @staticmethod
    def platform_stats(metric: str, period: str) -> str:
        """
        Cache key for platform-wide statistics.
        TTL: 1 hour
        Invalidation: on stats recalculation
        """
        return f"{CACHE_VERSION}:platform:stats:{metric}:{period}"

    # ========================================
    # AGENT EXECUTION CACHING
    # ========================================

    @staticmethod
    def agent_analysis_results(agent_type: str, entity_id: str, client_id: str) -> str:
        """
        Cache key for agent analysis results on entities.
        TTL: varies by agent type and data volatility
        Invalidation: on entity changes, re-analysis
        """
        return f"{CACHE_VERSION}:client:{client_id}:agent:{agent_type}:analysis:{entity_id}"

    @staticmethod
    def agent_learning_patterns(agent_type: str, client_id: str) -> str:
        """
        Cache key for agent learning patterns specific to a client.
        TTL: 24 hours
        Invalidation: on learning model updates
        """
        return (
            f"{CACHE_VERSION}:client:{client_id}:agent:{agent_type}:learning_patterns"
        )

    @staticmethod
    def crew_execution_state(crew_id: str, flow_id: str, client_id: str) -> str:
        """
        Cache key for CrewAI execution state and progress.
        TTL: 1 minute (highly dynamic)
        Invalidation: on crew state changes
        """
        return f"{CACHE_VERSION}:client:{client_id}:crew:{crew_id}:flow:{flow_id}:state"

    # ========================================
    # CREWAI SECURITY-SENSITIVE CACHING
    # ========================================

    @staticmethod
    def agent_configuration(agent_id: str, agent_type: str, client_id: str) -> str:
        """
        Cache key for agent configuration (REQUIRES ENCRYPTION).
        Contains sensitive tool configurations and API keys.
        TTL: 1 hour
        Invalidation: on agent config updates
        """
        return (
            f"{CACHE_VERSION}:client:{client_id}:agent:{agent_type}:config:{agent_id}"
        )

    @staticmethod
    def agent_tool_config(agent_id: str, tool_name: str, client_id: str) -> str:
        """
        Cache key for agent tool configuration (REQUIRES ENCRYPTION).
        Contains API keys, credentials, and sensitive parameters.
        TTL: 30 minutes
        Invalidation: on tool config updates
        """
        return f"{CACHE_VERSION}:client:{client_id}:agent:{agent_id}:tool:{tool_name}:config"

    @staticmethod
    def flow_checkpoint(
        flow_id: str, checkpoint_id: str, client_id: str, engagement_id: str
    ) -> str:
        """
        Cache key for flow checkpoints (REQUIRES ENCRYPTION).
        TTL: 2 hours, Invalidation: on checkpoint updates
        """
        return (
            f"{CACHE_VERSION}:client:{client_id}:engagement:{engagement_id}:"
            f"flow:{flow_id}:checkpoint:{checkpoint_id}"
        )

    @staticmethod
    def agent_memory_context(agent_id: str, context_key: str, client_id: str) -> str:
        """
        Cache key for agent memory and context (REQUIRES ENCRYPTION).
        Contains learned patterns and sensitive analysis data.
        TTL: 4 hours
        Invalidation: on memory updates
        """
        return (
            f"{CACHE_VERSION}:client:{client_id}:agent:{agent_id}:memory:{context_key}"
        )

    @staticmethod
    def crewai_flow_state(
        flow_id: str, phase: str, client_id: str, engagement_id: str
    ) -> str:
        """
        Cache key for complete CrewAI flow state (REQUIRES ENCRYPTION).
        Contains all flow data including sensitive tenant information.
        TTL: 5 minutes
        Invalidation: on flow state changes
        """
        return f"{CACHE_VERSION}:client:{client_id}:engagement:{engagement_id}:crewai:flow:{flow_id}:state:{phase}"

    @staticmethod
    def agent_result(
        agent_id: str,
        agent_name: str,
        flow_id: str,
        client_account_id: str,
        engagement_id: str,
    ) -> str:
        """
        Cache key for agent execution results.
        TTL: varies by agent type (see AgentCacheStrategy)
        Invalidation: on agent re-execution, flow reset
        """
        return f"{CACHE_VERSION}:client:{client_account_id}:engagement:{engagement_id}:agent:{agent_name}:flow:{flow_id}:result:{agent_id}"
