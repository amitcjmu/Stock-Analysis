"""
Base Constants and Enums for Cache Key Generation

This module contains the foundational constants, enums, and relationship mappings
used throughout the cache key generation system.

Generated by CC (Claude Code)
"""

from enum import Enum
from typing import Dict, Set

# Cache version for schema evolution and invalidation
CACHE_VERSION = "v1"


class CacheKeyType(Enum):
    """
    Enum for different cache key types to support monitoring and metrics.
    """

    USER_CONTEXT = "user_context"
    FIELD_MAPPINGS = "field_mappings"
    FLOW_STATE = "flow_state"
    CLIENT_DATA = "client_data"
    ENGAGEMENT_DATA = "engagement_data"
    ASSET_DATA = "asset_data"
    IMPORT_DATA = "import_data"
    ADMIN_DATA = "admin_data"
    AGENT_RESULTS = "agent_results"
    AGENT_CONFIG = "agent_config"
    CREWAI_STATE = "crewai_state"
    AGENT_TOOLS = "agent_tools"
    FLOW_CHECKPOINTS = "flow_checkpoints"
    STATS = "stats"


# Structured cascade invalidation relationships
CASCADE_RELATIONSHIPS: Dict[str, Set[str]] = {
    # When user context changes, invalidate these patterns
    "user:{user_id}:context": {
        "user:{user_id}:*",
        "*:user:{user_id}:*",
        "admin:active_users",
        "admin:pending_approvals",
    },
    # When client data changes, invalidate these patterns
    "client:{client_id}": {
        "client:{client_id}:*",
        "*:client:{client_id}:*",
        "user:*:clients",
    },
    # When engagement changes, invalidate these patterns
    "engagement:{engagement_id}": {
        "*:engagement:{engagement_id}:*",
        "client:{client_id}:engagements",
        "user:*:client:{client_id}:engagement:{engagement_id}:*",
    },
    # When flow changes, invalidate these patterns
    "flow:{flow_id}": {
        "*:flow:{flow_id}:*",
        "*:engagement:{engagement_id}:flows",
        "user:*:*:active_flows",
    },
    # When field mappings change, invalidate these patterns
    "field_mappings:{import_id}": {
        "*:import:{import_id}:*",
        "field_mapping_stats:{import_id}",
        "field_mapping_suggestions:{import_id}",
    },
    # When assets change, invalidate these patterns
    "asset:{asset_id}": {
        "*:asset:{asset_id}:*",
        "asset_inventory:*",
        "asset_dependencies:{asset_id}",
        "asset_recommendations:{asset_id}",
    },
}

# Cache type mapping for simplified type detection
CACHE_TYPE_PATTERNS: Dict[str, CacheKeyType] = {
    "user:*:context": CacheKeyType.USER_CONTEXT,
    "field_mappings:*": CacheKeyType.FIELD_MAPPINGS,
    "flow:*": CacheKeyType.FLOW_STATE,
    "client:*:engagements": CacheKeyType.CLIENT_DATA,
    "client:*:users": CacheKeyType.CLIENT_DATA,
    "client:*:settings": CacheKeyType.CLIENT_DATA,
    "engagement:*": CacheKeyType.ENGAGEMENT_DATA,
    "asset:*": CacheKeyType.ASSET_DATA,
    "import:*": CacheKeyType.IMPORT_DATA,
    "admin:*": CacheKeyType.ADMIN_DATA,
    "agent:*:results": CacheKeyType.AGENT_RESULTS,
    "agent:*:config": CacheKeyType.AGENT_CONFIG,
    "agent:*:tools": CacheKeyType.AGENT_TOOLS,
    "crewai:*:state": CacheKeyType.CREWAI_STATE,
    "crewai:*:checkpoint": CacheKeyType.FLOW_CHECKPOINTS,
    "crew:*:state": CacheKeyType.CREWAI_STATE,
    "stats:*": CacheKeyType.STATS,
    "analytics:*": CacheKeyType.STATS,
}
