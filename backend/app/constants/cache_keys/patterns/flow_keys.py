"""
Flow State Cache Key Patterns

Cache key generation for flow state management including complete flow data,
metadata, agent results, and phase-specific data.

Generated by CC (Claude Code)
"""

from .base import BaseCacheKeys, CACHE_VERSION


class FlowCacheKeys(BaseCacheKeys):
    """
    Cache key patterns for flow state management.

    Handles flow data, metadata, agent execution results, and
    phase-specific data within the migration workflow system.
    """

    @staticmethod
    def flow_complete(flow_id: str, client_id: str, engagement_id: str) -> str:
        """
        Cache key for complete flow data with all relations.
        TTL: 5 minutes
        Invalidation: on flow state changes, phase transitions
        """
        return f"{CACHE_VERSION}:client:{client_id}:engagement:{engagement_id}:flow:complete:{flow_id}"

    @staticmethod
    def flow_metadata(flow_id: str, client_id: str, engagement_id: str) -> str:
        """
        Cache key for flow metadata (status, phase, progress).
        TTL: 2 minutes
        Invalidation: on any flow updates
        """
        return f"{CACHE_VERSION}:client:{client_id}:engagement:{engagement_id}:flow:metadata:{flow_id}"

    @staticmethod
    def flow_agent_results(flow_id: str, agent_type: str, client_id: str) -> str:
        """
        Cache key for agent execution results within a flow.
        TTL: varies by agent type (see AgentCacheStrategy)
        Invalidation: on agent re-execution, flow reset
        """
        return f"{CACHE_VERSION}:client:{client_id}:agent:{agent_type}:flow:{flow_id}:results"

    @staticmethod
    def flow_phase_data(
        flow_id: str, phase: str, client_id: str, engagement_id: str
    ) -> str:
        """
        Cache key for phase-specific data within a flow.
        TTL: 10 minutes
        Invalidation: on phase completion, data updates
        """
        return f"{CACHE_VERSION}:client:{client_id}:engagement:{engagement_id}:flow:{flow_id}:phase:{phase}"
