"""
Security-Sensitive Cache Key Patterns

Cache key generation for security-sensitive CrewAI operations including
agent configurations, tool configs, memory contexts, and encrypted flow state.

All cache keys in this module REQUIRE ENCRYPTION when storing sensitive data.

Generated by CC (Claude Code)
"""

from .base import BaseCacheKeys, CACHE_VERSION


class SecurityCacheKeys(BaseCacheKeys):
    """
    Cache key patterns for security-sensitive CrewAI operations.

    ALL KEYS IN THIS MODULE REQUIRE ENCRYPTION when caching sensitive data
    including agent configurations, tool credentials, memory contexts,
    and complete flow states containing tenant information.
    """

    @staticmethod
    def agent_configuration(agent_id: str, agent_type: str, client_id: str) -> str:
        """
        Cache key for agent configuration (REQUIRES ENCRYPTION).
        Contains sensitive tool configurations and API keys.
        TTL: 1 hour
        Invalidation: on agent config updates
        """
        return (
            f"{CACHE_VERSION}:client:{client_id}:agent:{agent_type}:config:{agent_id}"
        )

    @staticmethod
    def agent_tool_config(agent_id: str, tool_name: str, client_id: str) -> str:
        """
        Cache key for agent tool configuration (REQUIRES ENCRYPTION).
        Contains API keys, credentials, and sensitive parameters.
        TTL: 30 minutes
        Invalidation: on tool config updates
        """
        return f"{CACHE_VERSION}:client:{client_id}:agent:{agent_id}:tool:{tool_name}:config"

    @staticmethod
    def flow_checkpoint(
        flow_id: str, checkpoint_id: str, client_id: str, engagement_id: str
    ) -> str:
        """
        Cache key for flow checkpoints (REQUIRES ENCRYPTION).
        TTL: 2 hours, Invalidation: on checkpoint updates
        """
        return (
            f"{CACHE_VERSION}:client:{client_id}:engagement:{engagement_id}:"
            f"flow:{flow_id}:checkpoint:{checkpoint_id}"
        )

    @staticmethod
    def agent_memory_context(agent_id: str, context_key: str, client_id: str) -> str:
        """
        Cache key for agent memory and context (REQUIRES ENCRYPTION).
        Contains learned patterns and sensitive analysis data.
        TTL: 4 hours
        Invalidation: on memory updates
        """
        return (
            f"{CACHE_VERSION}:client:{client_id}:agent:{agent_id}:memory:{context_key}"
        )

    @staticmethod
    def crewai_flow_state(
        flow_id: str, phase: str, client_id: str, engagement_id: str
    ) -> str:
        """
        Cache key for complete CrewAI flow state (REQUIRES ENCRYPTION).
        Contains all flow data including sensitive tenant information.
        TTL: 5 minutes
        Invalidation: on flow state changes
        """
        return f"{CACHE_VERSION}:client:{client_id}:engagement:{engagement_id}:crewai:flow:{flow_id}:state:{phase}"
