#!/usr/bin/env python3
"""
Asset Data Seeding Module - Assets and Dependencies
Generated by CC for comprehensive seed script modularization
"""

import random
import uuid

from sqlalchemy import text
from sqlalchemy.ext.asyncio import AsyncSession

from .base import TENANT_CONFIG


async def seed_assets_and_dependencies(session: AsyncSession):
    """Seed assets and their dependencies"""
    print("ðŸŒ± Seeding assets and dependencies...")

    asset_types = ["SERVER", "APPLICATION", "DATABASE", "NETWORK_DEVICE"]
    environments = ["PRODUCTION", "STAGING", "DEVELOPMENT", "QA"]

    for tenant_id, config in TENANT_CONFIG.items():
        assets = []

        # Create assets
        for i in range(50):  # 50 assets per tenant
            asset_id = uuid.uuid4()
            asset_type = random.choice(asset_types)

            await session.execute(
                text(
                    """
                    INSERT INTO migration.assets (
                        id, client_account_id, engagement_id,
                        asset_name, asset_type, environment,
                        business_criticality, technical_details,
                        discovery_source, created_at, updated_at
                    ) VALUES (
                        :id, :client_id, :engagement_id,
                        :name, :type, :env,
                        :criticality, :details,
                        'AUTOMATED_DISCOVERY', NOW(), NOW()
                    )
                """
                ),
                {
                    "id": str(asset_id),
                    "client_id": str(tenant_id),
                    "engagement_id": str(config["engagement_id"]),
                    "name": f"{asset_type}-{i:03d}",
                    "type": asset_type,
                    "env": random.choice(environments),
                    "criticality": random.choice(["CRITICAL", "HIGH", "MEDIUM", "LOW"]),
                    "details": {
                        "os": "Linux" if asset_type == "SERVER" else None,
                        "version": f"v{random.randint(1, 10)}.{random.randint(0, 9)}",
                        "location": random.choice(
                            ["datacenter-1", "cloud-aws", "cloud-azure"]
                        ),
                    },
                },
            )
            assets.append(asset_id)

        # Create dependencies between assets
        for i, asset_id in enumerate(assets[:20]):  # Create dependencies for first 20
            if i > 0:  # Can't depend on nothing
                num_deps = random.randint(1, 3)
                for _ in range(num_deps):
                    depends_on = random.choice(assets[:i])  # Depend on earlier assets

                    await session.execute(
                        text(
                            """
                            INSERT INTO migration.asset_dependencies (
                                id, asset_id, depends_on_asset_id,
                                dependency_type, description,
                                created_at, updated_at
                            ) VALUES (
                                :id, :asset_id, :depends_on,
                                :type, :description,
                                NOW(), NOW()
                            )
                            ON CONFLICT DO NOTHING
                        """
                        ),
                        {
                            "id": str(uuid.uuid4()),
                            "asset_id": str(asset_id),
                            "depends_on": str(depends_on),
                            "type": random.choice(
                                ["RUNTIME", "DATABASE", "API", "NETWORK"]
                            ),
                            "description": "Auto-discovered dependency",
                        },
                    )

    await session.commit()
    print("âœ… Assets and dependencies seeded\n")
