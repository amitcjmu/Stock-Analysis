"""Initial schema

Revision ID: 001_initial_schema
Revises: 
Create Date: 2025-07-15 03:11:12.018841

"""
from alembic import op
import sqlalchemy as sa
from sqlalchemy.dialects import postgresql


# revision identifiers, used by Alembic.
revision = '001_initial_schema'
down_revision = None
branch_labels = None
depends_on = None


def upgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table('client_accounts',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('name', sa.VARCHAR(length=255), nullable=False),
    sa.Column('slug', sa.VARCHAR(length=100), nullable=False),
    sa.Column('description', sa.TEXT(), nullable=True),
    sa.Column('industry', sa.VARCHAR(length=100), nullable=True),
    sa.Column('company_size', sa.VARCHAR(length=50), nullable=True),
    sa.Column('headquarters_location', sa.VARCHAR(length=255), nullable=True),
    sa.Column('primary_contact_name', sa.VARCHAR(length=255), nullable=True),
    sa.Column('primary_contact_email', sa.VARCHAR(length=255), nullable=True),
    sa.Column('primary_contact_phone', sa.VARCHAR(length=50), nullable=True),
    sa.Column('contact_email', sa.VARCHAR(length=255), nullable=True),
    sa.Column('contact_phone', sa.VARCHAR(length=50), nullable=True),
    sa.Column('address', sa.TEXT(), nullable=True),
    sa.Column('timezone', sa.VARCHAR(length=50), nullable=True),
    sa.Column('subscription_tier', sa.VARCHAR(length=50), server_default='standard', nullable=True),
    sa.Column('billing_contact_email', sa.VARCHAR(length=255), nullable=True),
    sa.Column('subscription_start_date', sa.TIMESTAMP(timezone=True), nullable=True),
    sa.Column('subscription_end_date', sa.TIMESTAMP(timezone=True), nullable=True),
    sa.Column('max_users', sa.INTEGER(), nullable=True),
    sa.Column('max_engagements', sa.INTEGER(), nullable=True),
    sa.Column('features_enabled', postgresql.JSON(astext_type=sa.Text()), server_default=sa.text("'{}'::json"), nullable=True),
    sa.Column('agent_configuration', postgresql.JSON(astext_type=sa.Text()), server_default=sa.text("'{}'::json"), nullable=True),
    sa.Column('storage_quota_gb', sa.INTEGER(), nullable=True),
    sa.Column('api_quota_monthly', sa.INTEGER(), nullable=True),
    sa.Column('settings', postgresql.JSON(astext_type=sa.Text()), server_default=sa.text("'{}'::json"), nullable=True),
    sa.Column('branding', postgresql.JSON(astext_type=sa.Text()), server_default=sa.text("'{}'::json"), nullable=True),
    sa.Column('business_objectives', postgresql.JSON(astext_type=sa.Text()), server_default=sa.text('\'{"primary_goals": [], "timeframe": "", "success_metrics": [], "constraints": []}\'::json'), nullable=True),
    sa.Column('it_guidelines', postgresql.JSON(astext_type=sa.Text()), nullable=True),
    sa.Column('decision_criteria', postgresql.JSON(astext_type=sa.Text()), nullable=True),
    sa.Column('agent_preferences', postgresql.JSON(astext_type=sa.Text()), server_default=sa.text('\'{"discovery_depth": "comprehensive", "automation_level": "assisted", "risk_tolerance": "moderate", "preferred_clouds": [], "compliance_requirements": [], "custom_rules": []}\'::json'), nullable=True),
    sa.Column('created_at', sa.TIMESTAMP(timezone=True), server_default=sa.text('now()'), nullable=True),
    sa.Column('updated_at', sa.TIMESTAMP(timezone=True), nullable=True),
    sa.Column('created_by', sa.UUID(), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), server_default=sa.text('true'), nullable=False),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_client_accounts')),
    sa.UniqueConstraint('slug', name=op.f('uq_client_accounts_slug'))
    )
    op.create_table('users',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('email', sa.VARCHAR(length=255), nullable=False),
    sa.Column('password_hash', sa.VARCHAR(length=255), nullable=True),
    sa.Column('first_name', sa.VARCHAR(length=100), nullable=True),
    sa.Column('last_name', sa.VARCHAR(length=100), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), server_default=sa.text('true'), nullable=True),
    sa.Column('is_verified', sa.BOOLEAN(), server_default=sa.text('false'), nullable=True),
    sa.Column('default_client_id', sa.UUID(), nullable=True),
    sa.Column('default_engagement_id', sa.UUID(), nullable=True),
    sa.Column('created_at', sa.TIMESTAMP(timezone=True), server_default=sa.text('now()'), nullable=True),
    sa.Column('updated_at', sa.TIMESTAMP(timezone=True), server_default=sa.text('now()'), nullable=True),
    sa.Column('last_login', sa.TIMESTAMP(timezone=True), nullable=True),
    sa.ForeignKeyConstraint(['default_client_id'], ['client_accounts.id'], name=op.f('fk_users_default_client_id_client_accounts')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_users')),
    sa.UniqueConstraint('email', name=op.f('uq_users_email'))
    )
    op.create_table('engagements',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('client_account_id', sa.UUID(), nullable=False),
    sa.Column('name', sa.VARCHAR(length=255), nullable=False),
    sa.Column('slug', sa.VARCHAR(length=100), nullable=False),
    sa.Column('description', sa.TEXT(), nullable=True),
    sa.Column('engagement_type', sa.VARCHAR(length=50), server_default='migration', nullable=True),
    sa.Column('status', sa.VARCHAR(length=50), server_default='active', nullable=True),
    sa.Column('priority', sa.VARCHAR(length=20), server_default='medium', nullable=True),
    sa.Column('start_date', sa.TIMESTAMP(timezone=True), nullable=True),
    sa.Column('target_completion_date', sa.TIMESTAMP(timezone=True), nullable=True),
    sa.Column('actual_completion_date', sa.TIMESTAMP(timezone=True), nullable=True),
    sa.Column('engagement_lead_id', sa.UUID(), nullable=True),
    sa.Column('client_contact_name', sa.VARCHAR(length=255), nullable=True),
    sa.Column('client_contact_email', sa.VARCHAR(length=255), nullable=True),
    sa.Column('settings', postgresql.JSON(astext_type=sa.Text()), server_default=sa.text("'{}'::json"), nullable=True),
    sa.Column('migration_scope', postgresql.JSON(astext_type=sa.Text()), server_default=sa.text('\'{"target_clouds": [], "migration_strategies": [], "excluded_systems": [], "included_environments": [], "business_units": [], "geographic_scope": [], "timeline_constraints": {}}\'::json'), nullable=True),
    sa.Column('team_preferences', postgresql.JSON(astext_type=sa.Text()), server_default=sa.text('\'{"stakeholders": [], "decision_makers": [], "technical_leads": [], "communication_style": "formal", "reporting_frequency": "weekly", "preferred_meeting_times": [], "escalation_contacts": [], "project_methodology": "agile"}\'::json'), nullable=True),
    sa.Column('created_at', sa.TIMESTAMP(timezone=True), server_default=sa.text('now()'), nullable=True),
    sa.Column('updated_at', sa.TIMESTAMP(timezone=True), nullable=True),
    sa.Column('created_by', sa.UUID(), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), server_default=sa.text('true'), nullable=True),
    sa.ForeignKeyConstraint(['client_account_id'], ['client_accounts.id'], name=op.f('fk_engagements_client_account_id_client_accounts')),
    sa.ForeignKeyConstraint(['engagement_lead_id'], ['users.id'], name=op.f('fk_engagements_engagement_lead_id_users')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_engagements'))
    )
    op.create_table('user_profiles',
    sa.Column('user_id', sa.UUID(), nullable=False),
    sa.Column('status', sa.VARCHAR(length=20), server_default='PENDING_APPROVAL', nullable=False),
    sa.Column('approval_requested_at', sa.TIMESTAMP(timezone=True), server_default=sa.text('now()'), nullable=True),
    sa.Column('approved_at', sa.TIMESTAMP(timezone=True), nullable=True),
    sa.Column('approved_by', sa.UUID(), nullable=True),
    sa.Column('registration_reason', sa.TEXT(), nullable=True),
    sa.Column('organization', sa.VARCHAR(length=255), nullable=True),
    sa.Column('role_description', sa.VARCHAR(length=255), nullable=True),
    sa.Column('requested_access_level', sa.VARCHAR(length=20), server_default='READ_ONLY', nullable=True),
    sa.Column('phone_number', sa.VARCHAR(length=20), nullable=True),
    sa.Column('manager_email', sa.VARCHAR(length=255), nullable=True),
    sa.Column('linkedin_profile', sa.VARCHAR(length=255), nullable=True),
    sa.Column('last_login_at', sa.TIMESTAMP(timezone=True), nullable=True),
    sa.Column('login_count', sa.INTEGER(), server_default=sa.text('0'), nullable=True),
    sa.Column('failed_login_attempts', sa.INTEGER(), server_default=sa.text('0'), nullable=True),
    sa.Column('last_failed_login', sa.TIMESTAMP(timezone=True), nullable=True),
    sa.Column('notification_preferences', postgresql.JSON(astext_type=sa.Text()), server_default=sa.text('\'{"email_notifications": true, "system_alerts": true, "learning_updates": false, "weekly_reports": true}\'::json'), nullable=True),
    sa.Column('created_at', sa.TIMESTAMP(timezone=True), server_default=sa.text('now()'), nullable=True),
    sa.Column('updated_at', sa.TIMESTAMP(timezone=True), server_default=sa.text('now()'), nullable=True),
    sa.ForeignKeyConstraint(['approved_by'], ['users.id'], name=op.f('fk_user_profiles_approved_by_users')),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], name=op.f('fk_user_profiles_user_id_users')),
    sa.PrimaryKeyConstraint('user_id', name=op.f('pk_user_profiles'))
    )
    op.create_table('client_access',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('user_profile_id', sa.UUID(), nullable=False),
    sa.Column('client_account_id', sa.UUID(), nullable=False),
    sa.Column('access_level', sa.VARCHAR(length=20), nullable=False),
    sa.Column('permissions', postgresql.JSON(astext_type=sa.Text()), server_default=sa.text('\'{"can_view_data": true, "can_import_data": false, "can_export_data": false, "can_manage_engagements": false, "can_configure_client_settings": false, "can_manage_client_users": false}\'::json'), nullable=True),
    sa.Column('restricted_environments', postgresql.JSON(astext_type=sa.Text()), server_default=sa.text("'[]'::json"), nullable=True),
    sa.Column('restricted_data_types', postgresql.JSON(astext_type=sa.Text()), server_default=sa.text("'[]'::json"), nullable=True),
    sa.Column('granted_at', sa.TIMESTAMP(timezone=True), server_default=sa.text('now()'), nullable=True),
    sa.Column('granted_by', sa.UUID(), nullable=False),
    sa.Column('expires_at', sa.TIMESTAMP(timezone=True), nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), server_default=sa.text('true'), nullable=True),
    sa.Column('last_accessed_at', sa.TIMESTAMP(timezone=True), nullable=True),
    sa.Column('access_count', sa.INTEGER(), server_default=sa.text('0'), nullable=True),
    sa.Column('created_at', sa.TIMESTAMP(timezone=True), server_default=sa.text('now()'), nullable=True),
    sa.Column('updated_at', sa.TIMESTAMP(timezone=True), server_default=sa.text('now()'), nullable=True),
    sa.ForeignKeyConstraint(['client_account_id'], ['client_accounts.id'], name=op.f('fk_client_access_client_account_id_client_accounts')),
    sa.ForeignKeyConstraint(['granted_by'], ['users.id'], name=op.f('fk_client_access_granted_by_users')),
    sa.ForeignKeyConstraint(['user_profile_id'], ['user_profiles.user_id'], name=op.f('fk_client_access_user_profile_id_user_profiles')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_client_access'))
    )
    op.create_table('crewai_flow_state_extensions',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('flow_id', sa.UUID(), nullable=False),
    sa.Column('client_account_id', sa.UUID(), nullable=False),
    sa.Column('engagement_id', sa.UUID(), nullable=False),
    sa.Column('user_id', sa.VARCHAR(length=255), nullable=False),
    sa.Column('flow_type', sa.VARCHAR(length=50), nullable=False),
    sa.Column('flow_name', sa.VARCHAR(length=255), nullable=True),
    sa.Column('flow_status', sa.VARCHAR(length=50), server_default='initialized', nullable=False),
    sa.Column('flow_configuration', postgresql.JSONB(astext_type=sa.Text()), server_default=sa.text("'{}'::jsonb"), nullable=False),
    sa.Column('flow_persistence_data', postgresql.JSONB(astext_type=sa.Text()), server_default=sa.text("'{}'::jsonb"), nullable=False),
    sa.Column('agent_collaboration_log', postgresql.JSONB(astext_type=sa.Text()), server_default=sa.text("'[]'::jsonb"), nullable=True),
    sa.Column('memory_usage_metrics', postgresql.JSONB(astext_type=sa.Text()), server_default=sa.text("'{}'::jsonb"), nullable=True),
    sa.Column('knowledge_base_analytics', postgresql.JSONB(astext_type=sa.Text()), server_default=sa.text("'{}'::jsonb"), nullable=True),
    sa.Column('phase_execution_times', postgresql.JSONB(astext_type=sa.Text()), server_default=sa.text("'{}'::jsonb"), nullable=True),
    sa.Column('agent_performance_metrics', postgresql.JSONB(astext_type=sa.Text()), server_default=sa.text("'{}'::jsonb"), nullable=True),
    sa.Column('crew_coordination_analytics', postgresql.JSONB(astext_type=sa.Text()), server_default=sa.text("'{}'::jsonb"), nullable=True),
    sa.Column('learning_patterns', postgresql.JSONB(astext_type=sa.Text()), server_default=sa.text("'[]'::jsonb"), nullable=True),
    sa.Column('user_feedback_history', postgresql.JSONB(astext_type=sa.Text()), server_default=sa.text("'[]'::jsonb"), nullable=True),
    sa.Column('adaptation_metrics', postgresql.JSONB(astext_type=sa.Text()), server_default=sa.text("'{}'::jsonb"), nullable=True),
    sa.Column('phase_transitions', postgresql.JSONB(astext_type=sa.Text()), server_default=sa.text("'[]'::jsonb"), nullable=True),
    sa.Column('error_history', postgresql.JSONB(astext_type=sa.Text()), server_default=sa.text("'[]'::jsonb"), nullable=True),
    sa.Column('retry_count', sa.INTEGER(), server_default=sa.text('0'), nullable=False),
    sa.Column('parent_flow_id', sa.UUID(), nullable=True),
    sa.Column('child_flow_ids', postgresql.JSONB(astext_type=sa.Text()), server_default=sa.text("'[]'::jsonb"), nullable=True),
    sa.Column('flow_metadata', postgresql.JSONB(astext_type=sa.Text()), server_default=sa.text("'{}'::jsonb"), nullable=True),
    sa.Column('created_at', sa.TIMESTAMP(timezone=True), server_default=sa.text('now()'), nullable=True),
    sa.Column('updated_at', sa.TIMESTAMP(timezone=True), server_default=sa.text('now()'), nullable=True),
    sa.ForeignKeyConstraint(['client_account_id'], ['client_accounts.id'], name=op.f('fk_crewai_flow_state_extensions_client_account_id_client_accounts')),
    sa.ForeignKeyConstraint(['engagement_id'], ['engagements.id'], name=op.f('fk_crewai_flow_state_extensions_engagement_id_engagements')),
    sa.ForeignKeyConstraint(['parent_flow_id'], ['crewai_flow_state_extensions.flow_id'], name='fk_crewai_flow_state_parent'),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_crewai_flow_state_extensions')),
    sa.UniqueConstraint('flow_id', name=op.f('uq_crewai_flow_state_extensions_flow_id'))
    )
    op.create_table('data_imports',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('client_account_id', sa.UUID(), nullable=True),
    sa.Column('engagement_id', sa.UUID(), nullable=True),
    sa.Column('master_flow_id', sa.UUID(), nullable=True),
    sa.Column('import_name', sa.VARCHAR(length=255), nullable=False),
    sa.Column('import_type', sa.VARCHAR(length=50), nullable=False),
    sa.Column('description', sa.TEXT(), nullable=True),
    sa.Column('filename', sa.VARCHAR(length=255), nullable=False),
    sa.Column('file_size', sa.INTEGER(), nullable=True),
    sa.Column('mime_type', sa.VARCHAR(length=100), nullable=True),
    sa.Column('source_system', sa.VARCHAR(length=100), nullable=True),
    sa.Column('status', sa.VARCHAR(length=20), server_default='pending', nullable=False),
    sa.Column('progress_percentage', sa.DOUBLE_PRECISION(precision=53), server_default=sa.text("'0'::double precision"), nullable=True),
    sa.Column('total_records', sa.INTEGER(), nullable=True),
    sa.Column('processed_records', sa.INTEGER(), server_default=sa.text('0'), nullable=True),
    sa.Column('failed_records', sa.INTEGER(), server_default=sa.text('0'), nullable=True),
    sa.Column('imported_by', sa.UUID(), nullable=False),
    sa.Column('error_message', sa.TEXT(), nullable=True),
    sa.Column('error_details', postgresql.JSON(astext_type=sa.Text()), nullable=True),
    sa.Column('started_at', sa.TIMESTAMP(timezone=True), server_default=sa.text('now()'), nullable=True),
    sa.Column('completed_at', sa.TIMESTAMP(timezone=True), nullable=True),
    sa.Column('created_at', sa.TIMESTAMP(timezone=True), server_default=sa.text('now()'), nullable=True),
    sa.Column('updated_at', sa.TIMESTAMP(timezone=True), nullable=True),
    sa.ForeignKeyConstraint(['client_account_id'], ['client_accounts.id'], name=op.f('fk_data_imports_client_account_id_client_accounts')),
    sa.ForeignKeyConstraint(['engagement_id'], ['engagements.id'], name=op.f('fk_data_imports_engagement_id_engagements')),
    sa.ForeignKeyConstraint(['imported_by'], ['users.id'], name=op.f('fk_data_imports_imported_by_users')),
    sa.ForeignKeyConstraint(['master_flow_id'], ['crewai_flow_state_extensions.flow_id'], name=op.f('fk_data_imports_master_flow_id_crewai_flow_state_extensions')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_data_imports'))
    )
    op.create_table('import_field_mappings',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('data_import_id', sa.UUID(), nullable=False),
    sa.Column('client_account_id', sa.UUID(), nullable=False),
    sa.Column('master_flow_id', sa.UUID(), nullable=True),
    sa.Column('source_field', sa.VARCHAR(length=255), nullable=False),
    sa.Column('target_field', sa.VARCHAR(length=255), nullable=False),
    sa.Column('match_type', sa.VARCHAR(length=50), server_default='direct', nullable=False),
    sa.Column('confidence_score', sa.DOUBLE_PRECISION(precision=53), nullable=True),
    sa.Column('status', sa.VARCHAR(length=20), server_default='suggested', nullable=True),
    sa.Column('suggested_by', sa.VARCHAR(length=50), server_default='ai_mapper', nullable=True),
    sa.Column('approved_by', sa.VARCHAR(length=255), nullable=True),
    sa.Column('approved_at', sa.TIMESTAMP(timezone=True), nullable=True),
    sa.Column('transformation_rules', postgresql.JSON(astext_type=sa.Text()), nullable=True),
    sa.Column('created_at', sa.TIMESTAMP(timezone=True), server_default=sa.text('now()'), nullable=True),
    sa.Column('updated_at', sa.TIMESTAMP(timezone=True), server_default=sa.text('now()'), nullable=True),
    sa.ForeignKeyConstraint(['client_account_id'], ['client_accounts.id'], name=op.f('fk_import_field_mappings_client_account_id_client_accounts')),
    sa.ForeignKeyConstraint(['data_import_id'], ['data_imports.id'], name=op.f('fk_import_field_mappings_data_import_id_data_imports')),
    sa.ForeignKeyConstraint(['master_flow_id'], ['crewai_flow_state_extensions.flow_id'], name=op.f('fk_import_field_mappings_master_flow_id_crewai_flow_state_extensions')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_import_field_mappings'))
    )
    sa.Enum('TECHNICAL', 'BUSINESS', 'SECURITY', 'COMPLIANCE', 'PERFORMANCE', name='assessmenttype').create(op.get_bind())
    sa.Enum('PENDING', 'IN_PROGRESS', 'COMPLETED', 'REVIEWED', 'APPROVED', 'REJECTED', name='assessmentstatus').create(op.get_bind())
    sa.Enum('LOW', 'MEDIUM', 'HIGH', 'CRITICAL', name='risklevel').create(op.get_bind())
    op.create_table('assessments',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('client_account_id', sa.UUID(), nullable=False),
    sa.Column('engagement_id', sa.UUID(), nullable=False),
    sa.Column('assessment_type', postgresql.ENUM('TECHNICAL', 'BUSINESS', 'SECURITY', 'COMPLIANCE', 'PERFORMANCE', name='assessmenttype', create_type=False), nullable=False),
    sa.Column('status', postgresql.ENUM('PENDING', 'IN_PROGRESS', 'COMPLETED', 'REVIEWED', 'APPROVED', 'REJECTED', name='assessmentstatus', create_type=False), server_default='PENDING', nullable=True),
    sa.Column('risk_level', postgresql.ENUM('LOW', 'MEDIUM', 'HIGH', 'CRITICAL', name='risklevel', create_type=False), nullable=True),
    sa.Column('summary', sa.TEXT(), nullable=True),
    sa.Column('recommendations', sa.TEXT(), nullable=True),
    sa.Column('report_url', sa.VARCHAR(length=255), nullable=True),
    sa.Column('master_flow_id', sa.UUID(), nullable=True),
    sa.ForeignKeyConstraint(['client_account_id'], ['client_accounts.id'], name=op.f('fk_assessments_client_account_id_client_accounts')),
    sa.ForeignKeyConstraint(['engagement_id'], ['engagements.id'], name=op.f('fk_assessments_engagement_id_engagements')),
    sa.ForeignKeyConstraint(['master_flow_id'], ['crewai_flow_state_extensions.flow_id'], name=op.f('fk_assessments_master_flow_id_crewai_flow_state_extensions')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_assessments'))
    )
    op.create_table('raw_import_records',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('data_import_id', sa.UUID(), nullable=False),
    sa.Column('client_account_id', sa.UUID(), nullable=True),
    sa.Column('engagement_id', sa.UUID(), nullable=True),
    sa.Column('master_flow_id', sa.UUID(), nullable=True),
    sa.Column('row_number', sa.INTEGER(), nullable=False),
    sa.Column('raw_data', postgresql.JSON(astext_type=sa.Text()), nullable=False),
    sa.Column('cleansed_data', postgresql.JSON(astext_type=sa.Text()), nullable=True),
    sa.Column('validation_errors', postgresql.JSON(astext_type=sa.Text()), nullable=True),
    sa.Column('processing_notes', sa.TEXT(), nullable=True),
    sa.Column('is_processed', sa.BOOLEAN(), server_default=sa.text('false'), nullable=True),
    sa.Column('is_valid', sa.BOOLEAN(), server_default=sa.text('true'), nullable=True),
    sa.Column('asset_id', sa.UUID(), nullable=True),
    sa.Column('created_at', sa.TIMESTAMP(timezone=True), server_default=sa.text('now()'), nullable=True),
    sa.Column('processed_at', sa.TIMESTAMP(timezone=True), nullable=True),
    sa.ForeignKeyConstraint(['client_account_id'], ['client_accounts.id'], name=op.f('fk_raw_import_records_client_account_id_client_accounts')),
    sa.ForeignKeyConstraint(['data_import_id'], ['data_imports.id'], name=op.f('fk_raw_import_records_data_import_id_data_imports')),
    sa.ForeignKeyConstraint(['engagement_id'], ['engagements.id'], name=op.f('fk_raw_import_records_engagement_id_engagements')),
    sa.ForeignKeyConstraint(['master_flow_id'], ['crewai_flow_state_extensions.flow_id'], name=op.f('fk_raw_import_records_master_flow_id_crewai_flow_state_extensions')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_raw_import_records'))
    )
    op.create_table('assets',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('client_account_id', sa.UUID(), nullable=False),
    sa.Column('engagement_id', sa.UUID(), nullable=False),
    sa.Column('flow_id', sa.UUID(), nullable=True),
    sa.Column('migration_id', sa.UUID(), nullable=True),
    sa.Column('master_flow_id', sa.UUID(), nullable=True),
    sa.Column('discovery_flow_id', sa.UUID(), nullable=True),
    sa.Column('assessment_flow_id', sa.UUID(), nullable=True),
    sa.Column('planning_flow_id', sa.UUID(), nullable=True),
    sa.Column('execution_flow_id', sa.UUID(), nullable=True),
    sa.Column('source_phase', sa.VARCHAR(length=50), nullable=True),
    sa.Column('current_phase', sa.VARCHAR(length=50), nullable=True),
    sa.Column('phase_context', postgresql.JSON(astext_type=sa.Text()), nullable=True),
    sa.Column('name', sa.VARCHAR(length=255), nullable=False),
    sa.Column('asset_name', sa.VARCHAR(length=255), nullable=True),
    sa.Column('hostname', sa.VARCHAR(length=255), nullable=True),
    sa.Column('asset_type', sa.VARCHAR(length=50), nullable=False),
    sa.Column('description', sa.TEXT(), nullable=True),
    sa.Column('ip_address', sa.VARCHAR(length=45), nullable=True),
    sa.Column('fqdn', sa.VARCHAR(length=255), nullable=True),
    sa.Column('mac_address', sa.VARCHAR(length=17), nullable=True),
    sa.Column('environment', sa.VARCHAR(length=50), nullable=True),
    sa.Column('location', sa.VARCHAR(length=100), nullable=True),
    sa.Column('datacenter', sa.VARCHAR(length=100), nullable=True),
    sa.Column('rack_location', sa.VARCHAR(length=50), nullable=True),
    sa.Column('availability_zone', sa.VARCHAR(length=50), nullable=True),
    sa.Column('operating_system', sa.VARCHAR(length=100), nullable=True),
    sa.Column('os_version', sa.VARCHAR(length=50), nullable=True),
    sa.Column('cpu_cores', sa.INTEGER(), nullable=True),
    sa.Column('memory_gb', sa.DOUBLE_PRECISION(precision=53), nullable=True),
    sa.Column('storage_gb', sa.DOUBLE_PRECISION(precision=53), nullable=True),
    sa.Column('business_owner', sa.VARCHAR(length=255), nullable=True),
    sa.Column('technical_owner', sa.VARCHAR(length=255), nullable=True),
    sa.Column('department', sa.VARCHAR(length=100), nullable=True),
    sa.Column('application_name', sa.VARCHAR(length=255), nullable=True),
    sa.Column('technology_stack', sa.VARCHAR(length=255), nullable=True),
    sa.Column('criticality', sa.VARCHAR(length=20), nullable=True),
    sa.Column('business_criticality', sa.VARCHAR(length=20), nullable=True),
    sa.Column('custom_attributes', postgresql.JSON(astext_type=sa.Text()), nullable=True),
    sa.Column('six_r_strategy', sa.VARCHAR(length=50), nullable=True),
    sa.Column('mapping_status', sa.VARCHAR(length=20), nullable=True),
    sa.Column('migration_priority', sa.INTEGER(), nullable=True),
    sa.Column('migration_complexity', sa.VARCHAR(length=20), nullable=True),
    sa.Column('migration_wave', sa.INTEGER(), nullable=True),
    sa.Column('sixr_ready', sa.VARCHAR(length=50), nullable=True),
    sa.Column('status', sa.VARCHAR(length=50), nullable=True),
    sa.Column('migration_status', sa.VARCHAR(length=50), nullable=True),
    sa.Column('dependencies', postgresql.JSON(astext_type=sa.Text()), nullable=True),
    sa.Column('related_assets', postgresql.JSON(astext_type=sa.Text()), nullable=True),
    sa.Column('discovery_method', sa.VARCHAR(length=50), nullable=True),
    sa.Column('discovery_source', sa.VARCHAR(length=100), nullable=True),
    sa.Column('discovery_timestamp', sa.TIMESTAMP(timezone=True), nullable=True),
    sa.Column('cpu_utilization_percent', sa.DOUBLE_PRECISION(precision=53), nullable=True),
    sa.Column('memory_utilization_percent', sa.DOUBLE_PRECISION(precision=53), nullable=True),
    sa.Column('disk_iops', sa.DOUBLE_PRECISION(precision=53), nullable=True),
    sa.Column('network_throughput_mbps', sa.DOUBLE_PRECISION(precision=53), nullable=True),
    sa.Column('completeness_score', sa.DOUBLE_PRECISION(precision=53), nullable=True),
    sa.Column('quality_score', sa.DOUBLE_PRECISION(precision=53), nullable=True),
    sa.Column('current_monthly_cost', sa.DOUBLE_PRECISION(precision=53), nullable=True),
    sa.Column('estimated_cloud_cost', sa.DOUBLE_PRECISION(precision=53), nullable=True),
    sa.Column('imported_by', sa.UUID(), nullable=True),
    sa.Column('imported_at', sa.TIMESTAMP(timezone=True), nullable=True),
    sa.Column('source_filename', sa.VARCHAR(length=255), nullable=True),
    sa.Column('raw_data', sa.TEXT(), nullable=True),
    sa.Column('field_mappings_used', postgresql.JSON(astext_type=sa.Text()), nullable=True),
    sa.Column('created_at', sa.TIMESTAMP(timezone=True), server_default=sa.text('now()'), nullable=True),
    sa.Column('updated_at', sa.TIMESTAMP(timezone=True), nullable=True),
    sa.Column('created_by', sa.UUID(), nullable=True),
    sa.Column('updated_by', sa.UUID(), nullable=True),
    sa.ForeignKeyConstraint(['client_account_id'], ['client_accounts.id'], name=op.f('fk_assets_client_account_id_client_accounts')),
    sa.ForeignKeyConstraint(['engagement_id'], ['engagements.id'], name=op.f('fk_assets_engagement_id_engagements')),
    sa.ForeignKeyConstraint(['raw_import_records_id'], ['raw_import_records.id'], name=op.f('fk_assets_raw_import_records_id_raw_import_records')),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_assets'))
    )
    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_table('assets')
    op.drop_table('raw_import_records')
    op.drop_table('assessments')
    op.drop_table('import_field_mappings')
    op.drop_table('data_imports')
    op.drop_table('crewai_flow_state_extensions')
    op.drop_table('client_access')
    op.drop_table('user_profiles')
    op.drop_table('engagements')
    op.drop_table('users')
    op.drop_table('client_accounts')
    sa.Enum(name='risklevel').drop(op.get_bind())
    sa.Enum(name='assessmentstatus').drop(op.get_bind())
    sa.Enum(name='assessmenttype').drop(op.get_bind())
    # ### end Alembic commands ### 