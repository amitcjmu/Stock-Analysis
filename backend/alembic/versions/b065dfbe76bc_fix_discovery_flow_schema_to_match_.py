"""fix_discovery_flow_schema_to_match_implementation_plan

Revision ID: b065dfbe76bc
Revises: c547c104e9b1
Create Date: 2025-06-23 18:13:54.834593

"""
from alembic import op
import sqlalchemy as sa


# revision identifiers, used by Alembic.
revision = 'b065dfbe76bc'
down_revision = 'c547c104e9b1'
branch_labels = None
depends_on = None


def upgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_foreign_key(None, 'crewai_flow_state_extensions', 'workflow_states', ['session_id'], ['session_id'], ondelete='CASCADE')
    op.create_index(op.f('ix_discovery_assets_id'), 'discovery_assets', ['id'], unique=False)
    op.drop_constraint(op.f('discovery_flows_flow_id_key'), 'discovery_flows', type_='unique')
    op.drop_index(op.f('ix_discovery_flows_flow_id'), table_name='discovery_flows')
    op.create_index(op.f('ix_discovery_flows_flow_id'), 'discovery_flows', ['flow_id'], unique=True)
    op.create_index(op.f('ix_discovery_flows_data_import_id'), 'discovery_flows', ['data_import_id'], unique=False)
    op.create_index(op.f('ix_discovery_flows_id'), 'discovery_flows', ['id'], unique=False)
    op.create_index(op.f('ix_discovery_flows_import_session_id'), 'discovery_flows', ['import_session_id'], unique=False)
    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_index(op.f('ix_discovery_flows_import_session_id'), table_name='discovery_flows')
    op.drop_index(op.f('ix_discovery_flows_id'), table_name='discovery_flows')
    op.drop_index(op.f('ix_discovery_flows_data_import_id'), table_name='discovery_flows')
    op.drop_index(op.f('ix_discovery_flows_flow_id'), table_name='discovery_flows')
    op.create_index(op.f('ix_discovery_flows_flow_id'), 'discovery_flows', ['flow_id'], unique=False)
    op.create_unique_constraint(op.f('discovery_flows_flow_id_key'), 'discovery_flows', ['flow_id'], postgresql_nulls_not_distinct=False)
    op.drop_index(op.f('ix_discovery_assets_id'), table_name='discovery_assets')
    op.drop_constraint(None, 'crewai_flow_state_extensions', type_='foreignkey')
    # ### end Alembic commands ### 