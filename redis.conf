# Redis Configuration for Migration Platform

# Persistence Configuration
# Enable AOF (Append Only File) persistence
appendonly yes
appendfilename "appendonly.aof"
appendfsync everysec
no-appendfsync-on-rewrite no
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb
aof-load-truncated yes

# RDB (Snapshotting) Configuration
save 900 1      # Save after 900 sec (15 min) if at least 1 key changed
save 300 10     # Save after 300 sec (5 min) if at least 10 keys changed
save 60 10000   # Save after 60 sec if at least 10000 keys changed

# Disable stopping writes on RDB save errors to prevent blocking
stop-writes-on-bgsave-error no

# Enable RDB compression
rdbcompression yes
rdbchecksum yes

# The filename for RDB
dbfilename dump.rdb

# Working directory - data will be saved here
dir /data

# Logging
loglevel notice
logfile ""

# Network
bind 0.0.0.0
protected-mode no
port 6379
tcp-backlog 511
timeout 0
tcp-keepalive 300

# Memory Management
maxmemory 512mb
maxmemory-policy allkeys-lru

# Performance
hz 10
dynamic-hz yes

# Replication (for future scaling)
repl-diskless-sync no
repl-diskless-sync-delay 5

# Security
# requirepass your_redis_password_here

# Clients
maxclients 10000

# Memory optimization
activerehashing yes
